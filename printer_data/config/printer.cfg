[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 300
max_accel: 10000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: zv
#shaper_type_x: 56
#shaper_type_y: mzv
#shaper_freq_y: 40.4

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.150
#*#
#*# [scanner model default]
#*# model_coef = 1.6515713098967568,
#*# 	1.9885357572322888,
#*# 	0.7187313893945685,
#*# 	0.19164399108706373,
#*# 	0.3659472061943571,
#*# 	0.7017235797535931,
#*# 	-0.3481099719192544,
#*# 	-0.8804481383950366,
#*# 	0.2631193459639314,
#*# 	0.45218815282783953
#*# model_domain = 3.3020111401827494e-07,3.3508802221553266e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 25.042367
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.040261, -0.041860, -0.040026, -0.037981, -0.036120, -0.035471, -0.037837, -0.035986, -0.035234, -0.036162, -0.035608, -0.032436, -0.022359, -0.035157, -0.031393, -0.038501, -0.040178, -0.012866, 0.004584, -0.003239, -0.040663, -0.044499, -0.044157, -0.044582, -0.044632, -0.044098, -0.039118, -0.031405, -0.023720, -0.031112
#*# 	  -0.040766, -0.042532, -0.039991, -0.038551, -0.040188, -0.035461, -0.035388, -0.035862, -0.035474, -0.036401, -0.034295, -0.031268, -0.023725, -0.017777, -0.023006, -0.034136, -0.035035, 0.002325, 0.004145, 0.007087, -0.030405, -0.040221, -0.041303, -0.038852, -0.042136, -0.038499, -0.031230, -0.027028, -0.024689, -0.027652
#*# 	  -0.045143, -0.042394, -0.044239, -0.043053, -0.045065, -0.040038, -0.033744, -0.042095, -0.037410, -0.035457, -0.036086, -0.031870, -0.029145, -0.021054, -0.020715, -0.040196, -0.029605, 0.006498, 0.001277, 0.007252, -0.024144, -0.041405, -0.038280, -0.040621, -0.040703, -0.038257, -0.033602, -0.027536, -0.022861, -0.027101
#*# 	  -0.048865, -0.048514, -0.048945, -0.046814, -0.040185, -0.039776, -0.040345, -0.039793, -0.040682, -0.039816, -0.038363, -0.037984, -0.033503, -0.031576, -0.033609, -0.039279, -0.031775, 0.010228, 0.006409, 0.006724, -0.018223, -0.039955, -0.041441, -0.040092, -0.040068, -0.031387, -0.031450, -0.028119, -0.019749, -0.025235
#*# 	  -0.053589, -0.050848, -0.043630, -0.044988, -0.041973, -0.039151, -0.036149, -0.037452, -0.046665, -0.042953, -0.035811, -0.038528, -0.039970, -0.044613, -0.042327, -0.040193, -0.028567, 0.011364, 0.005222, 0.005171, -0.013360, -0.044610, -0.041309, -0.037985, -0.038495, -0.036107, -0.030724, -0.024485, -0.020178, -0.027051
#*# 	  -0.045193, -0.048827, -0.046797, -0.044246, -0.040923, -0.037942, -0.036444, -0.036345, -0.039433, -0.040738, -0.044608, -0.039911, -0.040765, -0.042537, -0.044875, -0.045434, -0.020148, 0.015396, -0.005447, -0.001227, -0.010164, -0.035002, -0.038882, -0.044568, -0.035810, -0.033466, -0.026935, -0.018762, -0.011819, -0.014097
#*# 	  -0.044818, -0.050945, -0.044649, -0.035782, -0.039972, -0.036200, -0.037436, -0.039645, -0.039446, -0.045262, -0.040204, -0.031406, -0.041273, -0.043526, -0.044857, -0.046186, -0.020273, 0.012044, -0.010345, -0.009721, -0.010474, -0.034766, -0.037132, -0.037456, -0.030581, -0.031939, -0.022301, -0.009812, -0.003123, -0.004616
#*# 	  -0.047163, -0.049033, -0.045138, -0.044049, -0.040565, -0.039296, -0.040501, -0.039698, -0.040482, -0.041289, -0.038172, -0.035101, -0.039120, -0.042649, -0.045493, -0.044048, -0.016439, 0.017665, -0.010540, -0.014529, -0.008570, -0.029774, -0.039093, -0.034264, -0.029727, -0.024696, -0.012362, -0.005106, 0.003562, -0.004209
#*# 	  -0.049282, -0.049157, -0.047540, -0.044761, -0.044322, -0.049002, -0.043149, -0.035718, -0.041568, -0.040667, -0.044693, -0.038554, -0.035881, -0.045434, -0.042805, -0.039726, -0.009733, 0.016963, -0.014569, -0.016240, -0.000152, -0.021165, -0.026747, -0.028170, -0.025865, -0.024461, -0.024689, -0.016362, -0.005844, 0.000151
#*# 	  -0.044552, -0.044870, -0.043466, -0.043294, -0.041187, -0.042377, -0.039910, -0.039116, -0.039604, -0.036361, -0.035690, -0.034682, -0.037045, -0.040283, -0.037985, -0.031031, 0.004658, 0.018943, -0.018342, -0.010074, 0.008910, -0.014126, -0.024119, -0.025850, -0.013876, -0.011742, -0.011713, -0.006471, -0.003088, -0.001824
#*# 	  -0.041696, -0.040618, -0.039153, -0.037608, -0.036761, -0.035907, -0.040189, -0.034221, -0.030867, -0.031342, -0.031174, -0.030674, -0.033614, -0.034541, -0.033727, -0.022822, 0.013597, 0.022645, -0.017955, 0.007586, 0.013824, -0.001253, -0.010579, -0.010686, -0.005179, -0.005223, -0.000358, 0.001931, 0.003524, 0.000778
#*# 	  -0.035814, -0.036248, -0.035780, -0.034616, -0.032635, -0.031388, -0.031427, -0.029771, -0.029945, -0.027604, -0.027165, -0.027080, -0.031257, -0.030348, -0.020350, -0.009384, 0.018823, 0.037517, 0.019844, 0.016691, 0.003653, 0.001259, -0.002891, -0.000986, 0.000949, 0.002444, 0.003783, 0.006624, 0.010813, 0.000084
#*# 	  -0.036640, -0.036791, -0.040091, -0.031600, -0.026349, -0.027289, -0.028220, -0.028264, -0.027158, -0.027012, -0.029446, -0.026149, -0.026213, -0.024538, -0.015043, -0.005057, 0.020717, 0.043415, 0.018180, 0.010238, 0.003800, 0.001409, 0.000296, 0.000409, 0.001483, 0.001198, -0.000937, 0.001107, 0.001884, -0.006902
#*# 	  -0.034614, -0.035363, -0.033371, -0.031374, -0.028781, -0.026178, -0.025210, -0.025555, -0.026273, -0.023215, -0.021292, -0.018507, -0.025655, -0.018939, -0.004750, 0.008365, 0.031271, 0.046610, 0.028625, 0.021100, 0.012854, 0.003294, -0.003437, -0.009001, -0.012460, -0.016045, -0.014004, -0.005028, 0.000124, -0.006163
#*# 	  -0.025647, -0.030051, -0.028388, -0.026097, -0.022068, -0.021219, -0.023082, -0.020058, -0.016058, -0.016929, -0.010412, -0.010934, -0.014965, -0.007244, 0.005962, 0.017085, 0.045217, 0.050682, 0.040869, 0.024288, -0.001952, -0.011176, -0.013881, -0.009390, -0.004740, 0.000687, 0.005501, 0.008249, 0.010632, -0.000210
#*# 	  -0.026947, -0.024828, -0.024782, -0.022218, -0.018770, -0.017833, -0.015084, -0.015874, -0.014512, -0.011786, -0.007925, 0.011759, -0.000359, 0.007817, 0.012346, 0.012484, 0.048617, 0.048702, 0.052200, 0.021622, 0.014565, 0.016117, 0.016104, 0.017564, 0.019734, 0.017498, 0.017749, 0.019993, 0.016180, 0.004838
#*# 	  -0.025322, -0.027163, -0.023948, -0.021226, -0.018184, -0.018344, -0.014970, -0.011702, -0.014329, -0.011818, -0.000795, 0.005747, 0.009733, 0.007865, 0.010630, 0.017043, 0.031873, 0.041883, 0.050297, 0.035532, 0.027343, 0.024664, 0.022986, 0.023002, 0.022818, 0.018759, 0.016115, 0.011984, 0.012935, 0.004038
#*# 	  -0.027065, -0.024809, -0.023023, -0.019774, -0.017685, -0.012860, -0.011992, -0.013465, -0.014270, -0.009363, -0.001424, 0.005657, 0.011144, 0.011430, 0.015759, 0.040128, 0.048794, 0.055080, 0.047824, 0.050928, 0.036929, 0.025154, 0.019199, 0.019813, 0.018820, 0.016916, 0.016342, 0.012325, 0.011399, 0.005941
#*# 	  -0.024448, -0.024268, -0.020325, -0.013738, -0.011931, -0.010606, -0.008432, -0.011148, -0.011692, -0.014036, 0.003978, 0.031548, -0.000423, -0.000655, 0.045322, 0.003011, 0.044133, 0.058720, 0.047080, 0.065544, 0.047027, 0.025798, 0.014337, 0.014389, 0.015533, 0.012140, 0.009979, 0.003907, 0.006401, 0.001754
#*# 	  -0.022200, -0.020295, -0.017964, -0.014787, -0.010365, -0.006236, -0.003380, -0.007342, -0.008434, 0.002339, 0.027006, 0.031704, 0.037606, 0.022493, 0.049568, 0.038853, 0.037376, 0.067591, 0.041449, 0.057472, 0.058810, 0.019762, 0.001359, -0.000857, -0.000280, -0.000795, -0.000135, 0.004546, 0.010976, 0.006198
#*# 	  -0.018398, -0.015803, -0.012622, -0.010873, -0.005021, -0.005170, -0.000847, -0.002348, 0.002040, 0.025063, 0.006397, 0.026876, 0.045276, 0.041244, 0.045511, 0.041752, 0.020077, 0.056210, 0.052559, 0.024470, 0.054272, 0.014834, -0.005154, -0.005489, -0.005383, -0.004776, -0.000847, 0.002426, 0.007868, 0.002917
#*# 	  -0.013880, -0.009249, -0.005455, -0.005294, -0.002595, 0.002485, 0.004542, 0.007950, 0.005708, 0.025110, 0.055438, 0.061729, 0.038330, 0.031541, 0.023433, 0.046923, 0.028641, 0.048166, 0.071865, 0.042002, 0.020845, 0.030915, 0.003404, -0.003954, -0.001269, -0.003923, -0.000817, 0.003458, 0.007967, 0.004092
#*# 	  -0.006594, -0.007224, -0.005572, -0.000667, -0.001627, 0.007837, 0.007363, 0.005706, 0.010346, 0.025778, 0.066387, 0.055011, 0.025538, 0.030105, 0.016780, 0.014045, 0.017024, 0.012625, 0.052038, 0.067845, 0.044400, 0.048917, 0.022743, -0.002092, -0.003027, -0.002909, -0.001405, -0.000460, 0.005169, 0.001301
#*# 	  -0.008933, -0.009387, -0.003888, 0.001063, 0.003500, 0.005738, 0.007065, 0.007024, 0.008192, 0.014339, 0.059209, 0.049026, -0.000668, 0.013877, 0.015413, 0.007388, 0.003894, 0.003696, 0.013593, 0.048383, 0.054813, 0.027816, 0.004471, -0.005151, -0.005184, -0.005266, -0.005252, -0.003506, 0.005434, 0.000196
#*# 	  -0.007212, -0.003758, 0.002385, 0.000282, 0.006092, 0.012461, 0.010178, 0.012533, 0.011113, 0.014748, 0.053944, 0.057077, 0.011806, 0.005600, 0.000869, 0.003305, 0.005669, 0.007481, 0.008129, 0.011588, 0.008141, 0.003515, -0.002986, -0.006242, -0.009430, -0.008150, -0.004110, -0.005151, 0.010021, -0.004772
#*# 	  -0.005410, 0.001056, 0.001738, 0.007816, 0.012963, 0.016853, 0.018174, 0.016218, 0.018787, 0.020820, 0.048290, 0.067837, 0.034076, 0.007262, 0.007049, 0.007008, 0.011170, 0.012342, 0.012657, 0.012334, 0.008405, 0.004057, 0.000805, -0.002993, -0.005167, -0.005129, 0.003523, -0.004142, 0.009862, -0.002625
#*# 	  -0.000119, 0.007315, 0.007082, 0.014333, 0.020832, 0.020799, 0.025802, 0.027534, 0.027652, 0.029975, 0.040959, 0.070948, 0.057373, 0.015391, 0.015880, 0.016814, 0.018590, 0.021735, 0.020797, 0.021689, 0.019752, 0.012130, 0.009997, 0.005681, 0.002586, 0.001287, 0.015480, 0.002091, 0.004061, 0.006079
#*# 	  0.001129, 0.003091, 0.013016, 0.012215, 0.020420, 0.025699, 0.025122, 0.028253, 0.030674, 0.030457, 0.033702, 0.060445, 0.065276, 0.029775, 0.016641, 0.020820, 0.023107, 0.026376, 0.029437, 0.025125, 0.024215, 0.020968, 0.016428, 0.010031, 0.007034, 0.004454, 0.015382, 0.004585, 0.000208, 0.005609
#*# 	  0.004315, 0.005783, 0.012336, 0.018131, 0.020024, 0.029567, 0.027557, 0.031836, 0.035726, 0.033068, 0.032801, 0.049515, 0.066215, 0.044954, 0.022211, 0.025470, 0.026237, 0.028359, 0.028935, 0.029426, 0.026166, 0.021881, 0.016502, 0.012683, 0.008754, 0.003436, 0.006268, 0.007615, -0.003208, -0.004219
#*# 	  0.001318, 0.005060, 0.006966, 0.016531, 0.018868, 0.023285, 0.029916, 0.027279, 0.032110, 0.031788, 0.031512, 0.034823, 0.056719, 0.055619, 0.026272, 0.020841, 0.024723, 0.026887, 0.025113, 0.029163, 0.025101, 0.020838, 0.017588, 0.011664, 0.003924, -0.003959, -0.005659, -0.002439, -0.009144, -0.012828
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
