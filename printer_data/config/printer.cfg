[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR6
[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z1 Stepper - Rear Left on MOTOR7
[stepper_z1]
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PE5, PD12

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PA8
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1000
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.090
#*#
#*# [scanner model default]
#*# model_coef = 1.6424034669128336,
#*# 	1.9813670376128791,
#*# 	0.7010323266849157,
#*# 	0.2834719408058709,
#*# 	0.5084347287749059,
#*# 	0.3568761031635301,
#*# 	-0.5754861242878513,
#*# 	-0.39269876504330736,
#*# 	0.3741981573486312,
#*# 	0.2233120262586856
#*# model_domain = 3.302035001343314e-07,3.3513379931488797e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 30.969658
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.000926, 0.000390, 0.002313, 0.003359, 0.000932, 0.001322, 0.003602, 0.005429, 0.029707, 0.028158, 0.016892, -0.003466, -0.000966, 0.000701, -0.001124, 0.000374, -0.009574, -0.008796, -0.004659, -0.002838, -0.000937, -0.000519, -0.000290, 0.000660, 0.001233, 0.000909, 0.004162, 0.007369, 0.009774, 0.005713
#*# 	  -0.005443, -0.004965, -0.001889, -0.001195, -0.003353, -0.000726, 0.000679, 0.010171, 0.033315, 0.026151, 0.025417, 0.002174, 0.004033, 0.009412, 0.006237, -0.002747, -0.009832, -0.010113, -0.004722, -0.003256, -0.000273, 0.000765, 0.000920, 0.000938, 0.001200, 0.001150, 0.002164, 0.005933, 0.010623, 0.007893
#*# 	  -0.011775, -0.007692, -0.006040, -0.004469, -0.003388, -0.004835, -0.001771, 0.011807, 0.024482, 0.021450, 0.020931, -0.003737, -0.000591, 0.004680, 0.005577, -0.005208, -0.011983, -0.010882, -0.009583, -0.006718, -0.005435, -0.004101, -0.004361, -0.003656, -0.003389, -0.002178, -0.001103, 0.001951, 0.007093, 0.005787
#*# 	  -0.016157, -0.014691, -0.011053, -0.007782, -0.007139, -0.006828, -0.001506, 0.011976, 0.021085, 0.022749, 0.024900, -0.000431, -0.005757, -0.004187, -0.005129, -0.011211, -0.015242, -0.013440, -0.007797, -0.005903, -0.004643, -0.003344, -0.003065, -0.002649, -0.002385, -0.002408, -0.002393, 0.000708, 0.008175, 0.006395
#*# 	  -0.019789, -0.018281, -0.014732, -0.014624, -0.012570, -0.012025, -0.007956, 0.012353, 0.017141, 0.018562, 0.031294, 0.000700, -0.010531, -0.013547, -0.014406, -0.016938, -0.019534, -0.016017, -0.012840, -0.009682, -0.007587, -0.006702, -0.005585, -0.004999, -0.003101, -0.005103, -0.003265, 0.001009, 0.007889, 0.005594
#*# 	  -0.017197, -0.016444, -0.012582, -0.011949, -0.008062, -0.007929, -0.005807, 0.010262, 0.009871, 0.011231, 0.026477, 0.000292, -0.016035, -0.016610, -0.015327, -0.019115, -0.017474, -0.015322, -0.010374, -0.008647, -0.007704, -0.004858, -0.004695, -0.002856, -0.002842, -0.002323, 0.001352, 0.006066, 0.014075, 0.010083
#*# 	  -0.014184, -0.016291, -0.010241, -0.003451, -0.003372, -0.003363, -0.005799, 0.004970, -0.001860, 0.008187, 0.024003, -0.005683, -0.021610, -0.022311, -0.017324, -0.018745, -0.015348, -0.015274, -0.012051, -0.009872, -0.009024, -0.005860, -0.003549, -0.003225, -0.000458, -0.000523, 0.001302, 0.005894, 0.012986, 0.014239
#*# 	  -0.004619, -0.007006, -0.007343, -0.007549, -0.006968, -0.007142, -0.011913, -0.003644, -0.008648, 0.005858, 0.026027, -0.001702, -0.020225, -0.021891, -0.020882, -0.020241, -0.020730, -0.020984, -0.015289, -0.012005, -0.009866, -0.006614, -0.002650, 0.000451, 0.001426, 0.003093, 0.003389, 0.007386, 0.013012, 0.011205
#*# 	  -0.019890, -0.016681, -0.010413, -0.005236, -0.001894, -0.008131, -0.016619, -0.016386, -0.020409, 0.001930, 0.024877, 0.002765, -0.020239, -0.022973, -0.023057, -0.025451, -0.025848, -0.025472, -0.020767, -0.017454, -0.012175, -0.009509, -0.006491, -0.002260, 0.000934, 0.002520, 0.005366, 0.008655, 0.013620, 0.008552
#*# 	  -0.021254, -0.016429, -0.012883, -0.010075, -0.008106, -0.005990, -0.013424, -0.010036, -0.015529, -0.005092, 0.019995, 0.005710, -0.022017, -0.025768, -0.025074, -0.026224, -0.025339, -0.022214, -0.016711, -0.013625, -0.012052, -0.006917, -0.003071, 0.000793, 0.001551, 0.005541, 0.010179, 0.013847, 0.015556, 0.008433
#*# 	  -0.019386, -0.014036, -0.011862, -0.007956, -0.000271, 0.005520, 0.005241, -0.001175, 0.002733, -0.005149, 0.024252, 0.009941, -0.021306, -0.026681, -0.025871, -0.028323, -0.023047, -0.018694, -0.011355, -0.007864, -0.005940, -0.003374, -0.000980, 0.002745, 0.005779, 0.006541, 0.009575, 0.013919, 0.017929, 0.011770
#*# 	  -0.012987, -0.010037, -0.004902, 0.000194, 0.000781, 0.003267, 0.000947, -0.002175, 0.006435, 0.017591, 0.031942, 0.015107, -0.006472, -0.017794, -0.022369, -0.022450, -0.021552, -0.015742, -0.009328, -0.006691, -0.003208, -0.002297, 0.001547, 0.003400, 0.007391, 0.009047, 0.011699, 0.017108, 0.020366, 0.017066
#*# 	  -0.017127, -0.012406, -0.004462, 0.001346, -0.000229, 0.002390, 0.002744, -0.005370, -0.007407, 0.010157, 0.024743, 0.012656, 0.000202, -0.010331, -0.015561, -0.020528, -0.018918, -0.014787, -0.008651, -0.007967, -0.004125, -0.003509, -0.000643, 0.001207, 0.005595, 0.008469, 0.010335, 0.013856, 0.018678, 0.013238
#*# 	  -0.025048, -0.021251, -0.020315, -0.012404, -0.007746, -0.002710, 0.001417, 0.008699, 0.000490, 0.011177, 0.029793, 0.015782, 0.006463, -0.003929, -0.012783, -0.019090, -0.014979, -0.011768, -0.007502, -0.002313, -0.000922, 0.000950, 0.001669, 0.003368, 0.005430, 0.007573, 0.009823, 0.012004, 0.018029, 0.015468
#*# 	  -0.011459, -0.012836, -0.009243, -0.009697, -0.009845, -0.011486, -0.007382, -0.002014, 0.009258, 0.022113, 0.033525, 0.029659, 0.013730, 0.008043, -0.007869, -0.012259, -0.011483, -0.005494, -0.001965, 0.000943, 0.004080, 0.005840, 0.007018, 0.006807, 0.007714, 0.008874, 0.010273, 0.013658, 0.019201, 0.014309
#*# 	  -0.005763, -0.002421, -0.000414, 0.001226, 0.004970, 0.008029, 0.008026, 0.006174, 0.005958, 0.026916, 0.035221, 0.037346, 0.009854, 0.011949, 0.009388, 0.003135, 0.009460, -0.002155, 0.000690, 0.003307, 0.005968, 0.007743, 0.007923, 0.009480, 0.010132, 0.009687, 0.012194, 0.014701, 0.020751, 0.017240
#*# 	  -0.008323, -0.005496, 0.004446, 0.010568, 0.013627, 0.018286, 0.016431, 0.015613, 0.019214, 0.025944, 0.029800, 0.025822, 0.009289, 0.011139, 0.011715, 0.011152, 0.009557, 0.006672, 0.002934, 0.003227, 0.005721, 0.005089, 0.005161, 0.008549, 0.008589, 0.007445, 0.008834, 0.011428, 0.016814, 0.015590
#*# 	  -0.011104, -0.005635, 0.000907, 0.006659, 0.010435, 0.016836, 0.018190, 0.016710, 0.024051, 0.029509, 0.035225, 0.035198, 0.029299, 0.014776, 0.014979, 0.011662, 0.005816, 0.004735, 0.003501, 0.003049, 0.005159, 0.004951, 0.004838, 0.005431, 0.007615, 0.006589, 0.007049, 0.009455, 0.013620, 0.011223
#*# 	  -0.008897, -0.011613, -0.004486, 0.002332, 0.009651, 0.017944, 0.016453, 0.014134, 0.028284, 0.031042, 0.041420, 0.037624, 0.008202, 0.034938, 0.001249, 0.016232, 0.022375, 0.006953, -0.000113, 0.000950, 0.004393, 0.004529, 0.005797, 0.006470, 0.009400, 0.006715, 0.005532, 0.008847, 0.013022, 0.007789
#*# 	  -0.012428, -0.012018, -0.005656, -0.003327, 0.002842, 0.012891, 0.022251, 0.026120, 0.027756, 0.026528, 0.050520, 0.033425, 0.032699, 0.031971, 0.015580, 0.028215, 0.025871, 0.025139, 0.011407, 0.005857, 0.006427, 0.007952, 0.009227, 0.009271, 0.009743, 0.008776, 0.007071, 0.009640, 0.014864, 0.012024
#*# 	  -0.012729, -0.009817, -0.005008, -0.000810, 0.005788, 0.011424, 0.019628, 0.036744, 0.010499, 0.038770, 0.045553, 0.018359, 0.034146, 0.028617, 0.026432, 0.034470, 0.020962, 0.007732, 0.028251, 0.015081, 0.009763, 0.009185, 0.010416, 0.010632, 0.010609, 0.010093, 0.009490, 0.009965, 0.017032, 0.015820
#*# 	  0.000487, -0.002860, 0.000927, 0.000958, 0.006576, 0.015253, 0.026078, 0.016100, 0.034833, 0.048493, 0.044868, 0.035768, 0.040056, 0.027307, 0.026387, 0.035351, 0.040484, 0.036298, 0.027512, 0.014521, 0.016010, 0.016446, 0.017855, 0.017579, 0.018668, 0.018153, 0.015418, 0.017439, 0.022184, 0.017351
#*# 	  0.001757, 0.000817, 0.000396, 0.003619, 0.008365, 0.028492, 0.034556, 0.036337, 0.044126, 0.036277, 0.025643, 0.034678, 0.028967, 0.022433, 0.028422, 0.028274, 0.041063, 0.044974, 0.026408, 0.018008, 0.020913, 0.020846, 0.022466, 0.020995, 0.022420, 0.021818, 0.019723, 0.020906, 0.023425, 0.017466
#*# 	  -0.009319, -0.007767, -0.004472, 0.002946, 0.009803, 0.017608, 0.029866, 0.042725, 0.035765, 0.022322, 0.023389, 0.020675, 0.023686, 0.027882, 0.022280, 0.015384, 0.035096, 0.044438, 0.024287, 0.024096, 0.023844, 0.022719, 0.023162, 0.020876, 0.017417, 0.016153, 0.017148, 0.017616, 0.021498, 0.014795
#*# 	  -0.008872, -0.007523, -0.002825, 0.001445, 0.010843, 0.015355, 0.022682, 0.026659, 0.024120, 0.025052, 0.026787, 0.028587, 0.027837, 0.018097, 0.016686, 0.020621, 0.039474, 0.037156, 0.028564, 0.027148, 0.024686, 0.024587, 0.022321, 0.020725, 0.018268, 0.013137, 0.013699, 0.016208, 0.019136, 0.012082
#*# 	  0.001465, 0.003260, 0.005129, 0.010151, 0.012289, 0.016118, 0.018821, 0.022312, 0.027233, 0.034736, 0.035346, 0.039499, 0.037875, 0.033124, 0.028185, 0.033429, 0.043277, 0.034151, 0.029720, 0.029367, 0.027943, 0.028823, 0.028246, 0.024555, 0.022643, 0.018310, 0.017599, 0.019379, 0.023032, 0.015632
#*# 	  0.010358, 0.015609, 0.016726, 0.022146, 0.024405, 0.028018, 0.034542, 0.031245, 0.034741, 0.035364, 0.040845, 0.040728, 0.045329, 0.044824, 0.041598, 0.047779, 0.050546, 0.040975, 0.038618, 0.037903, 0.035222, 0.033597, 0.030642, 0.026647, 0.027760, 0.022806, 0.024475, 0.026693, 0.028944, 0.022909
#*# 	  0.009697, 0.017979, 0.026106, 0.029583, 0.032426, 0.038815, 0.041506, 0.044482, 0.045356, 0.043537, 0.046358, 0.048486, 0.048758, 0.049899, 0.048505, 0.060323, 0.054454, 0.045832, 0.045336, 0.045320, 0.043197, 0.041478, 0.035247, 0.034159, 0.028843, 0.026651, 0.028823, 0.029890, 0.033086, 0.027922
#*# 	  0.025299, 0.026998, 0.026428, 0.028808, 0.033693, 0.039571, 0.047822, 0.051847, 0.057962, 0.060470, 0.060777, 0.061952, 0.059204, 0.054333, 0.056582, 0.055883, 0.047186, 0.043730, 0.043729, 0.046931, 0.048763, 0.048235, 0.045187, 0.040798, 0.034152, 0.033002, 0.032559, 0.031000, 0.034491, 0.026321
#*# 	  0.030274, 0.031103, 0.030693, 0.034386, 0.039486, 0.043490, 0.051320, 0.058253, 0.058129, 0.060567, 0.060309, 0.061634, 0.057708, 0.056469, 0.060186, 0.054212, 0.043798, 0.043556, 0.043032, 0.044517, 0.045177, 0.043885, 0.039525, 0.035618, 0.032993, 0.029264, 0.029366, 0.030694, 0.033588, 0.026759
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
