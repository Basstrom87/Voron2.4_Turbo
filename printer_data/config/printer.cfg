[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 300
max_accel: 10000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: zv
#shaper_type_x: 56
#shaper_type_y: mzv
#shaper_freq_y: 40.4

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.100
#*#
#*# [scanner model default]
#*# model_coef = 1.6515713098967568,
#*# 	1.9885357572322888,
#*# 	0.7187313893945685,
#*# 	0.19164399108706373,
#*# 	0.3659472061943571,
#*# 	0.7017235797535931,
#*# 	-0.3481099719192544,
#*# 	-0.8804481383950366,
#*# 	0.2631193459639314,
#*# 	0.45218815282783953
#*# model_domain = 3.3020111401827494e-07,3.3508802221553266e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 25.042367
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.044493, -0.045588, -0.044494, -0.042324, -0.042017, -0.042095, -0.042183, -0.040590, -0.041042, -0.042170, -0.042154, -0.039950, -0.029200, -0.036653, -0.038777, -0.044120, -0.048521, -0.026086, -0.000561, -0.007607, -0.044822, -0.052632, -0.051957, -0.050535, -0.050477, -0.048911, -0.046811, -0.039928, -0.033292, -0.037229
#*# 	  -0.044101, -0.046152, -0.046171, -0.044219, -0.043980, -0.042469, -0.040357, -0.039927, -0.040169, -0.041163, -0.040328, -0.036072, -0.028971, -0.025088, -0.028400, -0.038688, -0.041570, -0.011705, 0.003406, 0.000578, -0.032712, -0.047178, -0.046823, -0.047498, -0.046939, -0.044984, -0.041199, -0.036524, -0.028144, -0.032490
#*# 	  -0.050759, -0.046684, -0.047081, -0.048877, -0.045029, -0.042444, -0.038099, -0.039978, -0.044517, -0.039570, -0.040779, -0.036616, -0.029150, -0.025134, -0.026904, -0.038231, -0.036203, -0.002900, -0.000673, -0.001528, -0.024345, -0.044567, -0.044490, -0.046691, -0.045302, -0.042908, -0.038089, -0.032167, -0.026292, -0.030530
#*# 	  -0.049120, -0.052024, -0.050173, -0.048780, -0.044919, -0.043863, -0.041081, -0.040179, -0.041916, -0.044406, -0.042237, -0.038992, -0.036064, -0.035727, -0.037399, -0.041811, -0.037346, 0.000193, 0.005128, -0.001115, -0.016218, -0.043203, -0.043897, -0.044660, -0.042770, -0.039810, -0.037103, -0.030929, -0.027067, -0.027055
#*# 	  -0.043596, -0.050291, -0.053237, -0.046573, -0.043253, -0.037954, -0.038157, -0.041176, -0.040262, -0.042128, -0.044519, -0.040633, -0.039996, -0.039804, -0.042567, -0.049296, -0.034541, 0.003426, 0.005437, -0.002595, -0.011222, -0.038214, -0.042701, -0.044768, -0.041024, -0.038787, -0.033601, -0.027492, -0.022709, -0.022183
#*# 	  -0.044684, -0.048533, -0.046908, -0.043391, -0.040119, -0.037986, -0.035896, -0.037536, -0.040020, -0.042061, -0.040344, -0.040123, -0.040145, -0.044457, -0.044503, -0.046419, -0.029606, 0.007685, -0.002929, -0.010721, -0.005798, -0.037922, -0.041042, -0.039742, -0.037952, -0.035251, -0.027032, -0.021832, -0.014933, -0.014686
#*# 	  -0.042900, -0.042719, -0.043240, -0.044602, -0.034838, -0.035904, -0.040137, -0.037330, -0.039355, -0.035768, -0.039994, -0.040104, -0.035763, -0.043042, -0.049023, -0.046662, -0.026431, 0.010606, -0.008859, -0.017981, -0.004875, -0.035782, -0.038376, -0.037903, -0.036295, -0.028343, -0.022982, -0.015950, -0.003823, -0.003337
#*# 	  -0.043710, -0.044509, -0.044234, -0.042126, -0.040121, -0.039150, -0.037924, -0.039183, -0.040123, -0.040335, -0.039978, -0.037812, -0.039737, -0.043418, -0.044717, -0.045185, -0.024839, 0.011512, -0.009287, -0.022696, -0.008739, -0.031355, -0.035184, -0.035188, -0.030966, -0.027309, -0.014673, -0.005146, -0.002470, -0.001825
#*# 	  -0.040031, -0.045376, -0.045562, -0.041895, -0.041219, -0.035718, -0.040115, -0.041230, -0.040119, -0.040113, -0.038866, -0.036732, -0.040138, -0.037910, -0.042577, -0.044895, -0.016501, 0.015251, -0.010976, -0.020657, -0.003663, -0.016215, -0.028077, -0.029094, -0.024992, -0.024274, -0.021990, -0.017350, -0.009514, 0.003161
#*# 	  -0.042249, -0.042379, -0.040890, -0.040122, -0.039906, -0.038231, -0.036629, -0.036991, -0.036414, -0.035624, -0.033397, -0.034322, -0.035710, -0.038897, -0.036057, -0.033002, -0.001611, 0.019155, -0.014646, -0.016529, 0.010789, -0.013537, -0.024872, -0.026995, -0.021642, -0.014000, -0.010601, -0.007849, -0.003325, -0.001174
#*# 	  -0.033949, -0.039740, -0.035651, -0.033487, -0.030901, -0.031563, -0.035839, -0.031370, -0.031399, -0.028414, -0.028296, -0.027123, -0.027048, -0.031425, -0.032355, -0.020386, 0.008508, 0.026056, -0.011964, 0.000238, 0.017698, 0.000968, -0.010287, -0.011909, -0.009781, -0.007293, -0.002163, 0.002527, 0.004231, 0.003955
#*# 	  -0.031775, -0.032503, -0.032752, -0.031413, -0.030014, -0.029055, -0.027091, -0.027593, -0.027442, -0.027046, -0.026988, -0.027058, -0.029171, -0.028548, -0.022611, -0.010818, 0.013246, 0.037163, 0.020161, 0.015980, 0.003134, -0.000291, -0.005425, -0.005812, -0.004361, -0.001094, 0.001708, 0.006409, 0.007693, 0.005053
#*# 	  -0.033062, -0.032912, -0.031414, -0.026628, -0.027071, -0.029128, -0.025534, -0.024833, -0.025376, -0.024202, -0.024380, -0.021629, -0.027068, -0.027113, -0.012443, -0.004547, 0.018160, 0.043916, 0.026717, 0.011807, 0.003355, 0.001909, 0.000890, 0.000873, -0.000091, -0.000269, -0.000109, 0.003217, 0.003071, -0.001446
#*# 	  -0.030552, -0.031365, -0.028703, -0.027327, -0.027045, -0.022808, -0.022887, -0.022562, -0.022366, -0.022091, -0.018404, -0.014478, -0.023299, -0.018248, -0.005375, 0.009609, 0.028176, 0.049910, 0.032562, 0.021922, 0.016839, 0.006751, -0.001385, -0.005426, -0.011498, -0.014002, -0.012432, -0.006171, 0.000222, -0.000872
#*# 	  -0.025098, -0.026751, -0.022552, -0.020883, -0.022824, -0.016535, -0.015519, -0.018546, -0.015599, -0.013038, -0.005439, -0.006033, -0.014138, -0.005647, 0.010873, 0.018199, 0.041665, 0.052954, 0.045940, 0.028614, 0.006765, -0.006412, -0.008665, -0.005921, -0.001493, 0.002868, 0.007494, 0.010725, 0.014600, 0.007701
#*# 	  -0.022862, -0.023291, -0.023050, -0.016373, -0.016091, -0.014810, -0.013803, -0.012043, -0.009739, -0.009461, -0.006372, 0.011434, 0.002963, 0.009183, 0.015543, 0.014266, 0.046373, 0.050120, 0.053677, 0.028649, 0.016017, 0.016090, 0.016461, 0.019000, 0.020316, 0.020294, 0.020329, 0.020294, 0.019110, 0.012031
#*# 	  -0.023825, -0.020417, -0.020953, -0.021849, -0.015311, -0.012830, -0.012148, -0.012102, -0.011572, -0.006532, 0.000238, 0.005556, 0.010940, 0.009471, 0.014286, 0.014596, 0.034828, 0.037667, 0.051935, 0.036825, 0.028804, 0.025065, 0.024194, 0.023765, 0.024161, 0.020860, 0.019286, 0.016038, 0.015850, 0.011066
#*# 	  -0.023730, -0.022505, -0.020876, -0.016581, -0.011904, -0.010955, -0.014072, -0.010839, -0.011672, -0.009273, 0.000115, 0.005226, 0.016070, 0.013307, 0.013894, 0.038046, 0.048548, 0.053600, 0.049064, 0.049939, 0.037526, 0.028338, 0.020292, 0.020429, 0.020362, 0.019242, 0.018296, 0.014523, 0.015063, 0.012384
#*# 	  -0.017327, -0.019956, -0.022687, -0.014439, -0.011048, -0.010481, -0.006656, -0.008531, -0.007574, -0.009833, 0.002836, 0.028571, 0.011224, -0.004035, 0.042869, 0.010447, 0.039904, 0.061450, 0.046146, 0.064727, 0.051965, 0.028987, 0.017820, 0.016191, 0.017044, 0.014104, 0.011529, 0.007493, 0.008744, 0.008304
#*# 	  -0.018767, -0.017519, -0.016563, -0.012197, -0.008702, -0.003861, -0.003834, -0.006483, -0.007068, 0.002317, 0.024717, 0.031928, 0.041869, 0.020208, 0.046344, 0.041311, 0.035434, 0.065772, 0.045247, 0.054860, 0.061539, 0.025877, 0.004250, 0.001184, 0.003170, 0.002821, 0.003084, 0.007372, 0.013375, 0.012538
#*# 	  -0.015761, -0.018376, -0.011914, -0.009737, -0.003676, -0.002203, -0.003270, 0.003163, 0.001362, 0.020924, 0.006003, 0.024288, 0.042793, 0.042797, 0.041642, 0.051004, 0.018330, 0.054369, 0.057949, 0.022534, 0.051781, 0.024259, -0.003310, -0.001125, -0.003269, -0.002849, -0.000593, 0.003977, 0.011355, 0.009626
#*# 	  -0.015963, -0.008413, -0.008509, -0.007742, -0.003826, 0.001258, 0.007498, 0.003174, 0.002111, 0.021438, 0.049576, 0.060521, 0.039771, 0.034980, 0.018801, 0.047783, 0.029917, 0.039907, 0.070433, 0.047903, 0.021036, 0.033638, 0.003887, -0.001956, -0.001887, -0.002014, -0.000579, 0.003197, 0.008827, 0.008668
#*# 	  -0.011104, -0.007701, -0.009779, -0.000901, -0.000043, 0.002122, 0.009620, 0.003033, 0.005714, 0.022411, 0.061346, 0.059676, 0.025976, 0.030447, 0.017132, 0.011755, 0.017809, 0.010036, 0.042019, 0.067955, 0.046409, 0.046349, 0.029548, -0.000971, -0.003259, -0.004862, -0.002169, 0.003154, 0.006446, 0.005777
#*# 	  -0.005392, -0.011850, -0.005324, -0.002563, -0.001217, 0.008218, 0.007453, 0.006282, 0.005265, 0.008716, 0.050913, 0.052019, -0.001653, 0.009880, 0.014898, 0.009032, 0.003108, 0.002199, 0.011636, 0.040387, 0.055272, 0.031995, 0.006504, -0.003429, -0.007571, -0.006421, -0.005357, -0.003572, 0.004242, 0.004177
#*# 	  -0.007957, -0.005834, -0.000191, -0.001248, 0.005182, 0.012349, 0.011731, 0.009783, 0.006558, 0.011987, 0.046324, 0.056243, 0.014599, 0.003947, 0.001399, 0.001546, 0.001063, 0.004943, 0.009375, 0.008199, 0.008038, 0.003263, -0.002890, -0.007072, -0.010133, -0.008015, -0.001118, -0.006185, 0.007516, 0.001162
#*# 	  -0.007398, -0.003622, -0.003060, 0.004760, 0.012318, 0.011385, 0.015472, 0.016567, 0.016052, 0.016021, 0.036530, 0.063891, 0.035316, 0.002399, 0.005063, 0.007512, 0.006781, 0.009640, 0.011146, 0.010399, 0.009619, 0.002543, -0.000915, -0.001109, -0.006207, -0.007420, 0.003087, -0.004349, 0.006852, 0.005034
#*# 	  -0.004068, 0.003195, 0.003193, 0.011720, 0.020129, 0.020383, 0.022252, 0.020061, 0.024233, 0.028882, 0.031230, 0.063665, 0.058646, 0.013809, 0.009855, 0.007489, 0.013872, 0.020063, 0.015665, 0.018056, 0.016422, 0.010007, 0.007488, 0.002140, -0.001614, -0.000287, 0.010971, 0.002399, 0.002151, 0.011088
#*# 	  0.001021, 0.002780, 0.007585, 0.007505, 0.017029, 0.024987, 0.020163, 0.025618, 0.029888, 0.027704, 0.025813, 0.051476, 0.058997, 0.030022, 0.010808, 0.015592, 0.020433, 0.019303, 0.022254, 0.020115, 0.018656, 0.017069, 0.010975, 0.007498, 0.004064, 0.001027, 0.008354, 0.005206, -0.001139, 0.003697
#*# 	  0.001662, 0.000033, 0.008433, 0.016234, 0.017956, 0.023381, 0.020311, 0.026697, 0.033088, 0.024275, 0.028531, 0.037860, 0.058491, 0.042122, 0.011377, 0.018279, 0.022456, 0.019315, 0.022349, 0.025337, 0.020080, 0.017633, 0.011385, 0.009547, 0.005317, -0.000736, -0.000306, 0.006914, -0.005291, -0.004503
#*# 	  -0.005263, 0.001055, 0.003124, 0.007512, 0.009919, 0.018954, 0.025071, 0.020025, 0.024418, 0.029151, 0.024682, 0.024625, 0.042655, 0.048062, 0.021456, 0.011734, 0.017843, 0.020783, 0.019066, 0.018394, 0.014795, 0.014053, 0.013654, 0.005339, -0.001001, -0.009161, -0.010251, -0.005978, -0.010247, -0.013072
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
