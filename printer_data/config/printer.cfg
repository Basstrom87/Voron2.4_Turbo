[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1000
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.120
#*#
#*# [scanner model default]
#*# model_coef = 1.6424034669128336,
#*# 	  1.9813670376128791,
#*# 	  0.7010323266849157,
#*# 	  0.2834719408058709,
#*# 	  0.5084347287749059,
#*# 	  0.3568761031635301,
#*# 	  -0.5754861242878513,
#*# 	  -0.39269876504330736,
#*# 	  0.3741981573486312,
#*# 	  0.2233120262586856
#*# model_domain = 3.302035001343314e-07,3.3513379931488797e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 30.969658
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.003816, -0.003319, -0.001499, 0.001485, 0.000090, -0.001846, 0.001435, 0.005218, 0.023619, 0.023675, 0.011983, -0.008169, -0.006650, -0.003032, -0.006851, -0.005036, -0.015953, -0.012441, -0.008250, -0.005544, -0.002549, -0.001949, -0.002397, -0.000474, 0.001490, 0.001140, 0.001552, 0.003413, 0.006612, -0.000306
#*# 	-0.009217, -0.006666, -0.003598, -0.003285, -0.004271, -0.002635, 0.000832, 0.007775, 0.028398, 0.020447, 0.017441, -0.002520, -0.002678, 0.002830, 0.001197, -0.007363, -0.015988, -0.014651, -0.008909, -0.007005, -0.004505, -0.002700, -0.002406, -0.002534, 0.000879, 0.000972, 0.001513, 0.002516, 0.008110, 0.001367
#*# 	-0.018167, -0.009340, -0.003362, -0.002682, -0.002102, -0.003975, -0.002645, 0.008706, 0.022774, 0.014965, 0.012357, -0.011507, -0.007033, -0.000090, 0.002452, -0.010393, -0.015911, -0.015965, -0.013592, -0.009400, -0.008753, -0.005215, -0.006741, -0.004609, -0.003349, -0.005891, -0.002679, -0.001400, 0.002828, 0.002283
#*# 	-0.018923, -0.015988, -0.012103, -0.007857, -0.007101, -0.006811, -0.004421, 0.008698, 0.014185, 0.014095, 0.014262, -0.007657, -0.011443, -0.007092, -0.010409, -0.015748, -0.020400, -0.017946, -0.015100, -0.011936, -0.009486, -0.007046, -0.005035, -0.003860, -0.003792, -0.004744, -0.004707, -0.002765, 0.003950, -0.000107
#*# 	-0.018477, -0.017321, -0.013340, -0.010922, -0.012246, -0.012747, -0.010376, 0.008114, 0.015593, 0.014379, 0.024763, -0.001763, -0.011526, -0.017740, -0.018402, -0.021771, -0.025407, -0.023246, -0.017832, -0.016512, -0.013062, -0.008254, -0.007096, -0.006082, -0.002681, -0.005439, -0.003698, -0.000859, 0.005489, -0.000873
#*# 	-0.016707, -0.016543, -0.013033, -0.012672, -0.011524, -0.009963, -0.009510, 0.005310, 0.004540, 0.005199, 0.022315, -0.004419, -0.019429, -0.020453, -0.020399, -0.022464, -0.022361, -0.020273, -0.015832, -0.013180, -0.012634, -0.011661, -0.011522, -0.006470, -0.002785, -0.002778, -0.002018, 0.001863, 0.008334, 0.003992
#*# 	-0.017398, -0.018070, -0.011943, -0.005959, -0.005342, -0.006766, -0.008064, -0.001204, -0.004690, 0.001534, 0.020221, -0.012161, -0.025033, -0.025846, -0.023951, -0.023320, -0.018405, -0.019532, -0.015407, -0.011534, -0.013885, -0.012522, -0.009319, -0.006347, -0.003823, -0.002813, -0.000464, 0.002139, 0.009235, 0.007469
#*# 	-0.009660, -0.011052, -0.011108, -0.010574, -0.010592, -0.011223, -0.015905, -0.008546, -0.012538, 0.000179, 0.018327, -0.005009, -0.022098, -0.024706, -0.023400, -0.022630, -0.023809, -0.024444, -0.020311, -0.016581, -0.015926, -0.013189, -0.009659, -0.005205, -0.001063, -0.000369, 0.001590, 0.005444, 0.011264, 0.005665
#*# 	-0.022715, -0.016373, -0.011972, -0.006401, -0.004398, -0.009406, -0.020288, -0.016333, -0.021981, -0.002250, 0.020067, 0.004257, -0.018233, -0.020671, -0.020544, -0.025614, -0.027085, -0.025507, -0.022125, -0.021079, -0.015943, -0.015575, -0.008076, -0.005041, 0.000932, 0.003111, 0.006404, 0.006675, 0.011355, 0.005978
#*# 	-0.026305, -0.020602, -0.016555, -0.015260, -0.011240, -0.009538, -0.013715, -0.012860, -0.019606, -0.008965, 0.015100, 0.002564, -0.025264, -0.029298, -0.027082, -0.029616, -0.027428, -0.024990, -0.020356, -0.017055, -0.013244, -0.010370, -0.007690, -0.002152, 0.002055, 0.005032, 0.006820, 0.011011, 0.015025, 0.007827
#*# 	-0.020391, -0.016245, -0.013057, -0.007675, -0.001229, 0.003785, 0.002049, -0.001096, 0.001930, -0.006546, 0.019726, 0.006709, -0.017911, -0.029155, -0.028392, -0.027489, -0.026483, -0.021020, -0.013944, -0.010901, -0.006827, -0.002131, 0.000691, 0.002352, 0.006728, 0.008551, 0.010541, 0.014241, 0.017117, 0.008531
#*# 	-0.015907, -0.013064, -0.007649, -0.002027, 0.000992, 0.000419, 0.001315, -0.004890, 0.003796, 0.016146, 0.028465, 0.012171, -0.009007, -0.018165, -0.025271, -0.025075, -0.023890, -0.019556, -0.012219, -0.008190, -0.004150, -0.001458, 0.001722, 0.005629, 0.008337, 0.007509, 0.010396, 0.013549, 0.018174, 0.012769
#*# 	-0.019974, -0.013882, -0.006846, 0.001673, 0.003275, 0.004500, 0.005709, -0.004344, -0.006551, 0.009299, 0.023303, 0.005019, -0.001151, -0.013373, -0.015758, -0.020075, -0.020424, -0.013993, -0.007239, -0.002665, -0.000134, 0.001765, 0.005193, 0.006215, 0.010036, 0.011284, 0.011898, 0.014843, 0.018633, 0.011049
#*# 	-0.024826, -0.022141, -0.014336, -0.007739, -0.002573, 0.003106, 0.004759, 0.009478, 0.002800, 0.011692, 0.030097, 0.014302, 0.001444, -0.007593, -0.014501, -0.015808, -0.014219, -0.010529, -0.003782, 0.001483, 0.005028, 0.006892, 0.008914, 0.010241, 0.010447, 0.009711, 0.010532, 0.013558, 0.016419, 0.011724
#*# 	-0.012148, -0.009570, -0.007804, -0.007068, -0.006817, -0.004813, 0.000847, 0.004296, 0.011057, 0.023587, 0.034814, 0.031538, 0.012649, 0.007525, -0.003163, -0.011663, -0.007199, -0.003303, -0.001158, 0.006442, 0.011165, 0.014924, 0.015267, 0.015543, 0.015577, 0.014109, 0.011911, 0.014378, 0.018944, 0.010197
#*# 	-0.007565, -0.005014, 0.001090, 0.002123, 0.006162, 0.010172, 0.009641, 0.012662, 0.010264, 0.026259, 0.035361, 0.035025, 0.009472, 0.009879, 0.007688, 0.001797, 0.009025, -0.000529, 0.004031, 0.006226, 0.010669, 0.014901, 0.014938, 0.015350, 0.015801, 0.012219, 0.012699, 0.014867, 0.018163, 0.013312
#*# 	-0.013351, -0.005485, 0.003715, 0.010394, 0.015113, 0.017384, 0.019059, 0.016101, 0.017829, 0.027352, 0.026928, 0.022010, 0.009907, 0.005785, 0.008444, 0.008051, 0.007622, 0.007247, 0.002467, 0.006244, 0.009785, 0.012526, 0.013280, 0.011258, 0.012727, 0.009878, 0.010302, 0.011151, 0.014935, 0.011772
#*# 	-0.007565, -0.005150, 0.001772, 0.008951, 0.010715, 0.017511, 0.018131, 0.017079, 0.021968, 0.027510, 0.032391, 0.031414, 0.029704, 0.015971, 0.012453, 0.011325, 0.006690, 0.002607, 0.003808, 0.005127, 0.007863, 0.008733, 0.010378, 0.010532, 0.010524, 0.009455, 0.008340, 0.009320, 0.012281, 0.006636
#*# 	-0.012472, -0.012717, -0.005022, 0.002951, 0.007510, 0.014095, 0.014589, 0.012781, 0.025485, 0.029688, 0.037504, 0.034987, 0.007853, 0.031045, 0.000560, 0.013761, 0.023595, 0.004473, -0.000309, 0.002004, 0.003081, 0.008250, 0.008313, 0.008182, 0.010981, 0.007664, 0.006385, 0.006824, 0.010800, 0.007377
#*# 	-0.007060, -0.011519, -0.007730, -0.004871, -0.001280, 0.012627, 0.020805, 0.025845, 0.028145, 0.025517, 0.047006, 0.031204, 0.028810, 0.034391, 0.010309, 0.026262, 0.021765, 0.021614, 0.012957, 0.007923, 0.008299, 0.008300, 0.007507, 0.008454, 0.011019, 0.006753, 0.005858, 0.008819, 0.012070, 0.007158
#*# 	-0.011511, -0.008566, -0.007105, 0.001724, 0.006088, 0.008308, 0.015922, 0.027909, 0.008225, 0.035895, 0.044168, 0.020207, 0.032522, 0.029661, 0.022053, 0.031718, 0.018264, 0.006781, 0.028395, 0.015553, 0.008628, 0.008535, 0.009707, 0.009559, 0.009567, 0.008475, 0.008967, 0.009023, 0.015191, 0.011646
#*# 	-0.000686, -0.000715, -0.002599, 0.000313, 0.003802, 0.008704, 0.022510, 0.012751, 0.029045, 0.045416, 0.039771, 0.033220, 0.039444, 0.025111, 0.023482, 0.030239, 0.038771, 0.034528, 0.025490, 0.013005, 0.013348, 0.012922, 0.013872, 0.015850, 0.019297, 0.016005, 0.015324, 0.015499, 0.019041, 0.012428
#*# 	0.002072, -0.000469, 0.001121, 0.001862, 0.005098, 0.021529, 0.028919, 0.028638, 0.037148, 0.031678, 0.025178, 0.031618, 0.028355, 0.019618, 0.025317, 0.024363, 0.035763, 0.042876, 0.028934, 0.017253, 0.015475, 0.016443, 0.017262, 0.019998, 0.019730, 0.019331, 0.017104, 0.017562, 0.020210, 0.012059
#*# 	-0.007382, -0.004712, -0.003217, 0.008216, 0.010825, 0.018199, 0.029626, 0.041498, 0.033856, 0.021778, 0.021209, 0.022189, 0.019788, 0.025935, 0.018931, 0.009873, 0.032949, 0.042645, 0.024332, 0.021271, 0.019967, 0.019812, 0.021115, 0.018541, 0.014922, 0.014770, 0.014886, 0.015075, 0.018325, 0.011838
#*# 	-0.002801, -0.004049, -0.001015, 0.005024, 0.009915, 0.019298, 0.021391, 0.025027, 0.025222, 0.021087, 0.025075, 0.027047, 0.026496, 0.018852, 0.016903, 0.018432, 0.036453, 0.031538, 0.028120, 0.024769, 0.024673, 0.024683, 0.023409, 0.021294, 0.019851, 0.016754, 0.013310, 0.014353, 0.017132, 0.006668
#*# 	-0.000981, 0.004187, 0.006428, 0.012314, 0.016803, 0.018747, 0.021521, 0.023225, 0.022399, 0.032253, 0.032971, 0.036731, 0.036816, 0.028195, 0.026912, 0.030017, 0.038898, 0.031799, 0.027752, 0.027925, 0.027746, 0.029392, 0.029597, 0.028072, 0.025558, 0.021480, 0.017115, 0.018803, 0.019992, 0.011949
#*# 	0.012010, 0.019565, 0.019583, 0.027097, 0.027871, 0.031605, 0.036539, 0.037769, 0.034168, 0.034760, 0.038033, 0.040408, 0.049570, 0.043286, 0.041855, 0.045389, 0.045097, 0.039337, 0.038155, 0.038938, 0.038225, 0.035796, 0.032073, 0.028034, 0.025788, 0.028061, 0.024720, 0.024396, 0.027948, 0.017786
#*# 	0.012783, 0.024707, 0.028298, 0.031845, 0.036415, 0.040732, 0.043554, 0.045387, 0.044933, 0.046642, 0.045440, 0.047684, 0.045366, 0.043408, 0.049811, 0.054605, 0.052019, 0.045848, 0.042360, 0.044547, 0.043544, 0.042908, 0.039804, 0.034538, 0.031628, 0.027358, 0.024312, 0.028272, 0.029513, 0.022841
#*# 	0.029219, 0.032580, 0.036481, 0.034844, 0.040486, 0.044320, 0.048387, 0.060482, 0.062084, 0.062142, 0.062699, 0.058332, 0.058880, 0.056383, 0.057431, 0.056062, 0.048704, 0.045289, 0.045126, 0.045434, 0.051908, 0.050409, 0.049096, 0.045462, 0.036768, 0.033779, 0.030764, 0.031706, 0.032034, 0.023915
#*# 	0.032833, 0.033737, 0.038717, 0.037075, 0.041109, 0.045460, 0.049633, 0.058923, 0.059192, 0.061361, 0.059642, 0.058450, 0.057784, 0.056300, 0.058443, 0.052430, 0.044657, 0.043306, 0.042450, 0.044407, 0.046840, 0.045812, 0.042995, 0.041101, 0.034875, 0.030192, 0.028019, 0.028393, 0.031323, 0.024330
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
