[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 300
max_accel: 10000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.

#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor BTT-Pi]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################
[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01

#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: zv
#shaper_type_x: 56
#shaper_type_y: mzv
#shaper_freq_y: 40.4

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.050
#*#
#*# [scanner model default]
#*# model_coef = 1.6515713098967568,
#*# 	1.9885357572322888,
#*# 	0.7187313893945685,
#*# 	0.19164399108706373,
#*# 	0.3659472061943571,
#*# 	0.7017235797535931,
#*# 	-0.3481099719192544,
#*# 	-0.8804481383950366,
#*# 	0.2631193459639314,
#*# 	0.45218815282783953
#*# model_domain = 3.3020111401827494e-07,3.3508802221553266e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 25.042367
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.025430, 0.024691, 0.024970, 0.028253, 0.029618, 0.031711, 0.030982, 0.033844, 0.033932, 0.034404, 0.036237, 0.038484, 0.040687, 0.044866, 0.045874, 0.042264, 0.038097, 0.038087, 0.042220, 0.041458, 0.038089, 0.035549, 0.036433, 0.034719, 0.032819, 0.031350, 0.033812, 0.038021, 0.042806, 0.041564
#*# 	  0.023526, 0.020922, 0.021849, 0.024540, 0.025387, 0.027693, 0.029592, 0.031800, 0.031191, 0.031853, 0.034904, 0.041364, 0.047657, 0.055706, 0.054594, 0.046694, 0.039650, 0.037203, 0.038190, 0.040029, 0.037155, 0.034413, 0.035013, 0.034102, 0.032479, 0.033292, 0.035366, 0.039650, 0.046553, 0.042413
#*# 	  0.014570, 0.013329, 0.012590, 0.017428, 0.018936, 0.021035, 0.023353, 0.025068, 0.026378, 0.025663, 0.028011, 0.037111, 0.046634, 0.054836, 0.052857, 0.043210, 0.034941, 0.033074, 0.033084, 0.034256, 0.031676, 0.029589, 0.030537, 0.029676, 0.030064, 0.029778, 0.033814, 0.038092, 0.042571, 0.041162
#*# 	  0.008298, 0.006714, 0.008306, 0.011075, 0.013088, 0.016897, 0.019251, 0.019779, 0.020808, 0.018561, 0.021558, 0.028729, 0.036430, 0.041897, 0.040175, 0.033694, 0.028224, 0.026849, 0.028073, 0.028610, 0.025353, 0.025353, 0.025351, 0.025361, 0.025386, 0.027480, 0.029738, 0.037012, 0.038089, 0.041131
#*# 	  0.005883, 0.004316, 0.003916, 0.006972, 0.012555, 0.014741, 0.015532, 0.017424, 0.012469, 0.016844, 0.016834, 0.018960, 0.022156, 0.023326, 0.023594, 0.022687, 0.016819, 0.022834, 0.023322, 0.021061, 0.020657, 0.021372, 0.021879, 0.022271, 0.020893, 0.025450, 0.025957, 0.032111, 0.038090, 0.038157
#*# 	  0.004846, 0.002790, 0.003725, 0.007112, 0.010427, 0.013449, 0.014800, 0.014576, 0.012557, 0.011877, 0.012992, 0.014089, 0.013688, 0.013623, 0.013325, 0.014048, 0.013955, 0.016596, 0.019060, 0.021035, 0.019947, 0.019812, 0.019004, 0.020460, 0.020816, 0.022016, 0.025882, 0.031728, 0.037394, 0.038079
#*# 	  0.003886, -0.000571, 0.004102, 0.005940, 0.006360, 0.010798, 0.011059, 0.013157, 0.009504, 0.006435, 0.009412, 0.010334, 0.006150, 0.006543, 0.006612, 0.009898, 0.009235, 0.008509, 0.016831, 0.016000, 0.016495, 0.016839, 0.016082, 0.017138, 0.018913, 0.020312, 0.025399, 0.029529, 0.035777, 0.033814
#*# 	  -0.000614, -0.000522, -0.000259, 0.002734, 0.004012, 0.006563, 0.006209, 0.006061, 0.004138, 0.004684, 0.005769, 0.008211, 0.005184, 0.004037, 0.004015, 0.004827, 0.007182, 0.008660, 0.010834, 0.012563, 0.017131, 0.016860, 0.014697, 0.014282, 0.016846, 0.018967, 0.023244, 0.029443, 0.035983, 0.037006
#*# 	  -0.005235, -0.003946, -0.004707, -0.000257, -0.001130, 0.001415, 0.001606, -0.000388, 0.004027, 0.001872, 0.003077, 0.006007, 0.002488, 0.004323, 0.002287, 0.001794, 0.005079, 0.006138, 0.006168, 0.012255, 0.020595, 0.025331, 0.013086, 0.011499, 0.016786, 0.018670, 0.023887, 0.028498, 0.034311, 0.037033
#*# 	  -0.004749, -0.007801, -0.005439, -0.004440, -0.004139, -0.002860, -0.001255, -0.001337, -0.000846, 0.000849, 0.004023, 0.004705, 0.002438, 0.001798, 0.001912, 0.003983, 0.004127, 0.006198, 0.006282, 0.014419, 0.025512, 0.025537, 0.015398, 0.011459, 0.013723, 0.017634, 0.024155, 0.029968, 0.037464, 0.038085
#*# 	  -0.002416, -0.004466, -0.002447, -0.002401, -0.000397, -0.000348, 0.000676, 0.000003, 0.001868, 0.003052, 0.006157, 0.006168, 0.003597, 0.001843, 0.003118, 0.006038, 0.007914, 0.008613, 0.011616, 0.017363, 0.027326, 0.026966, 0.017404, 0.012955, 0.016698, 0.020929, 0.027517, 0.033973, 0.042195, 0.042000
#*# 	  -0.000229, -0.000286, -0.001321, -0.000392, 0.000752, 0.000793, -0.000270, 0.000561, 0.003647, 0.004058, 0.004543, 0.004693, 0.002035, 0.002272, 0.003032, 0.005557, 0.008832, 0.011785, 0.013133, 0.017092, 0.022287, 0.022865, 0.017363, 0.016727, 0.017230, 0.021251, 0.029126, 0.037813, 0.045044, 0.044532
#*# 	  -0.000276, -0.002553, -0.004036, -0.004429, 0.000597, 0.001813, -0.000285, -0.000051, 0.001869, 0.004053, 0.003683, 0.000267, 0.000801, -0.000599, -0.001189, 0.003069, 0.008529, 0.012581, 0.014157, 0.016080, 0.021094, 0.020386, 0.016747, 0.016779, 0.017339, 0.021107, 0.028102, 0.034612, 0.042455, 0.043242
#*# 	  -0.004720, -0.006263, -0.004882, -0.000295, 0.000106, -0.000284, 0.003337, 0.001874, 0.003993, 0.003061, 0.003381, 0.004027, -0.000757, -0.002343, -0.000345, 0.004000, 0.008323, 0.012589, 0.016834, 0.018331, 0.017519, 0.017365, 0.016846, 0.016843, 0.019577, 0.021550, 0.026543, 0.033771, 0.041600, 0.042389
#*# 	  0.000742, -0.004566, 0.000105, 0.000170, 0.003216, 0.005077, 0.006094, 0.004172, 0.004215, 0.005179, 0.008436, 0.006150, 0.001742, 0.001544, 0.003678, 0.007209, 0.011681, 0.014783, 0.021520, 0.022195, 0.021037, 0.021465, 0.021923, 0.023159, 0.023276, 0.025286, 0.029726, 0.035220, 0.042577, 0.042289
#*# 	  0.003398, 0.000831, 0.004034, 0.004007, 0.006168, 0.010138, 0.008802, 0.006233, 0.008805, 0.009779, 0.012554, 0.009113, 0.003994, 0.004646, 0.007450, 0.009013, 0.013616, 0.017855, 0.023590, 0.025719, 0.025237, 0.025372, 0.024421, 0.025685, 0.027022, 0.029585, 0.032018, 0.038201, 0.042783, 0.042785
#*# 	  -0.000275, -0.000265, -0.000303, 0.004812, 0.006155, 0.004262, 0.007197, 0.007085, 0.009930, 0.007705, 0.007805, 0.010013, 0.005091, 0.003214, 0.007774, 0.010415, 0.012873, 0.016982, 0.020965, 0.028387, 0.029004, 0.026390, 0.024302, 0.026361, 0.029605, 0.029089, 0.029585, 0.034150, 0.038564, 0.039104
#*# 	  0.004047, 0.001744, 0.000853, 0.000458, 0.006434, 0.007627, 0.006150, 0.006257, 0.005940, 0.004550, 0.006129, 0.003990, 0.004986, 0.002954, 0.004008, 0.008494, 0.012509, 0.015920, 0.021370, 0.030628, 0.034077, 0.026961, 0.021096, 0.023278, 0.024966, 0.025805, 0.029554, 0.033016, 0.037788, 0.037688
#*# 	  0.004512, 0.004928, 0.002806, 0.004006, 0.008510, 0.011504, 0.013168, 0.007815, 0.003737, 0.005065, 0.005768, 0.003879, 0.003144, 0.003570, 0.006828, 0.009300, 0.012095, 0.016876, 0.021714, 0.033799, 0.039009, 0.029527, 0.021094, 0.021182, 0.024487, 0.027081, 0.029381, 0.032702, 0.037928, 0.037376
#*# 	  0.008834, 0.005490, 0.006247, 0.008332, 0.012059, 0.014701, 0.017267, 0.010933, 0.006436, 0.007012, 0.009129, 0.007373, 0.006075, 0.003758, 0.008643, 0.010450, 0.012580, 0.015922, 0.021707, 0.033412, 0.037838, 0.028017, 0.018977, 0.021106, 0.025252, 0.027114, 0.030323, 0.034445, 0.040318, 0.041104
#*# 	  0.012572, 0.008291, 0.010494, 0.013702, 0.014806, 0.018972, 0.018639, 0.014887, 0.013869, 0.010815, 0.013044, 0.010683, 0.006418, 0.006378, 0.008267, 0.011657, 0.012870, 0.015766, 0.020403, 0.029541, 0.033828, 0.025193, 0.018335, 0.021443, 0.023342, 0.025404, 0.031446, 0.035893, 0.042329, 0.042662
#*# 	  0.016472, 0.015174, 0.016820, 0.015838, 0.019031, 0.021213, 0.022218, 0.019983, 0.018033, 0.016310, 0.016287, 0.014704, 0.011865, 0.009250, 0.010438, 0.010748, 0.014689, 0.016869, 0.021177, 0.027790, 0.028854, 0.024475, 0.020983, 0.022921, 0.025744, 0.027259, 0.030772, 0.038028, 0.044405, 0.046542
#*# 	  0.022802, 0.021539, 0.019705, 0.021123, 0.020396, 0.026382, 0.026390, 0.020978, 0.022036, 0.019964, 0.018091, 0.017222, 0.014172, 0.010618, 0.009938, 0.011763, 0.014843, 0.017249, 0.022948, 0.025749, 0.026405, 0.025366, 0.022146, 0.023230, 0.026037, 0.029069, 0.031591, 0.037772, 0.045747, 0.047488
#*# 	  0.023611, 0.020329, 0.025456, 0.022361, 0.021093, 0.027088, 0.027146, 0.026416, 0.022729, 0.016553, 0.021126, 0.015456, 0.008291, 0.006601, 0.007264, 0.008434, 0.012299, 0.016094, 0.020830, 0.022094, 0.024435, 0.021600, 0.021067, 0.021756, 0.023252, 0.027113, 0.031356, 0.034926, 0.044426, 0.046988
#*# 	  0.027657, 0.027490, 0.027605, 0.030780, 0.030705, 0.029041, 0.029865, 0.028270, 0.026417, 0.023475, 0.023070, 0.022940, 0.014379, 0.008242, 0.009342, 0.010448, 0.013550, 0.017274, 0.020953, 0.025352, 0.022690, 0.021044, 0.020810, 0.021076, 0.023081, 0.025460, 0.031986, 0.034347, 0.050284, 0.047348
#*# 	  0.035964, 0.035943, 0.034922, 0.033613, 0.037789, 0.038610, 0.038643, 0.035935, 0.033840, 0.034210, 0.027736, 0.024304, 0.019281, 0.015756, 0.014683, 0.016178, 0.019187, 0.023205, 0.025617, 0.026158, 0.025854, 0.024953, 0.025356, 0.025255, 0.025326, 0.029721, 0.042288, 0.039033, 0.050734, 0.054557
#*# 	  0.042356, 0.044283, 0.044424, 0.044438, 0.050993, 0.049289, 0.044286, 0.046514, 0.044011, 0.044263, 0.039193, 0.033757, 0.033859, 0.025235, 0.021056, 0.023085, 0.026869, 0.031538, 0.033208, 0.033811, 0.035664, 0.033626, 0.032803, 0.033242, 0.034030, 0.037004, 0.054722, 0.046456, 0.050834, 0.063359
#*# 	  0.042245, 0.045481, 0.046501, 0.054953, 0.053218, 0.050720, 0.052827, 0.052202, 0.050960, 0.044224, 0.040709, 0.044308, 0.034991, 0.025349, 0.027350, 0.027118, 0.030035, 0.033893, 0.034943, 0.040179, 0.039013, 0.037128, 0.038397, 0.038321, 0.041768, 0.041663, 0.055732, 0.056129, 0.050746, 0.059361
#*# 	  0.052703, 0.052844, 0.059378, 0.058203, 0.055012, 0.057595, 0.057440, 0.059614, 0.052885, 0.048596, 0.050743, 0.044703, 0.035961, 0.032456, 0.029677, 0.033805, 0.032066, 0.033836, 0.040090, 0.041278, 0.041415, 0.041838, 0.041824, 0.042591, 0.041717, 0.042325, 0.049936, 0.061150, 0.051276, 0.054887
#*# 	  0.055632, 0.058710, 0.063347, 0.061731, 0.061238, 0.064397, 0.061151, 0.056071, 0.056444, 0.052808, 0.051676, 0.046902, 0.037146, 0.033170, 0.031488, 0.030210, 0.032996, 0.035525, 0.038653, 0.040101, 0.041282, 0.043242, 0.042704, 0.043777, 0.042327, 0.041356, 0.043289, 0.054835, 0.054873, 0.053063
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
