[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR6
[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z1 Stepper - Rear Left on MOTOR7
[stepper_z1]
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PE5, PD12

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


# moved to printer_toolhead.cfg
# [fan_generic exhaust_fan]
# #	Exhaust fan - CNC_FAN3
# pin: PD13
# max_power: 1.0
# shutdown_speed: 0.0
# kick_start_time: 5.0

[output_pin BedFans]
pin: PA8
value: 0
shutdown_value: 0


#####################################################################
# 	LED Control
#####################################################################

[output_pin DaylightSticks]
pin: PB11
pwm: True
cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.035
#*#
#*# [scanner model default]
#*# model_coef = 1.6505600743105848,
#*# 	1.9820184161766665,
#*# 	0.7582830879408482,
#*# 	0.3162196790179616,
#*# 	0.22842829779143606,
#*# 	0.215878394581027,
#*# 	-0.14771289914230398,
#*# 	-0.17974717229611736,
#*# 	0.1601374346159676,
#*# 	0.11699363406748503
#*# model_domain = 3.3036003167324736e-07,3.351243187450464e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 22.204529
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.051537, -0.061575, -0.055344, -0.050412, -0.043820, -0.034783, -0.030435, -0.027008, -0.032596, -0.037137, -0.036307, -0.036225, -0.036065, -0.030420, -0.033379, -0.034704, -0.035751, -0.031628, -0.031483, -0.036012, -0.043695, -0.061038, -0.068972, -0.070752, -0.070890, -0.066716, -0.065258, -0.062944, -0.057639, -0.050192
#*# 	  -0.043416, -0.040820, -0.040430, -0.039484, -0.033635, -0.026071, -0.021187, -0.019422, -0.023752, -0.024557, -0.022839, -0.022513, -0.012577, -0.009745, -0.014805, -0.020738, -0.024508, -0.025142, -0.024652, -0.028839, -0.035323, -0.048266, -0.054545, -0.056572, -0.057942, -0.043421, -0.040316, -0.035270, -0.026036, -0.031846
#*# 	  -0.034579, -0.037220, -0.050076, -0.045003, -0.036182, -0.031274, -0.018399, -0.016379, -0.017269, -0.018208, -0.017946, -0.008822, -0.006630, -0.003958, -0.015786, -0.027428, -0.028967, -0.028749, -0.029263, -0.026582, -0.032082, -0.036802, -0.042548, -0.039670, -0.038745, -0.038535, -0.035893, -0.035219, -0.029156, -0.014783
#*# 	  -0.045567, -0.050051, -0.052354, -0.045609, -0.037251, -0.029413, -0.016946, -0.016361, -0.017255, -0.017835, -0.021105, -0.017828, -0.015397, -0.016277, -0.019436, -0.027616, -0.030974, -0.029175, -0.024211, -0.021854, -0.027066, -0.030466, -0.034088, -0.041068, -0.041126, -0.040060, -0.037859, -0.041089, -0.031939, -0.010227
#*# 	  -0.050789, -0.052179, -0.048691, -0.041573, -0.027107, -0.018577, -0.014694, -0.013210, -0.031661, -0.033221, -0.031628, -0.029101, -0.019920, -0.020358, -0.021041, -0.024063, -0.024595, -0.016422, -0.016472, -0.017847, -0.022446, -0.038517, -0.042122, -0.041578, -0.040965, -0.035691, -0.033745, -0.030377, -0.022355, -0.008694
#*# 	  -0.048692, -0.040810, -0.038481, -0.030767, -0.027272, -0.020940, -0.017916, -0.016528, -0.019740, -0.022795, -0.023366, -0.020685, -0.015854, -0.012293, -0.012698, -0.012691, -0.012821, -0.014174, -0.013426, -0.015861, -0.020089, -0.028190, -0.031622, -0.031781, -0.028120, -0.015639, -0.013343, -0.008562, 0.000727, -0.004391
#*# 	  -0.022477, -0.031097, -0.035970, -0.030487, -0.022469, -0.019904, -0.008828, -0.006762, -0.007599, -0.009940, -0.002069, 0.000266, 0.001440, 0.001925, -0.013658, -0.013335, -0.010773, -0.009508, -0.001516, -0.003600, -0.008007, -0.011360, -0.013005, -0.008274, -0.004238, -0.002817, 0.000212, -0.005349, 0.003158, 0.019161
#*# 	  -0.020253, -0.021618, -0.022484, -0.018181, -0.015484, -0.009895, -0.002825, 0.000469, 0.000796, 0.001074, 0.000709, 0.002411, 0.003285, 0.001826, 0.001529, -0.000684, -0.000445, 0.002549, 0.003193, 0.009472, 0.005560, 0.005089, 0.004806, -0.000350, 0.001888, 0.000844, 0.002907, 0.009017, 0.009197, 0.026203
#*# 	  -0.027121, -0.027095, -0.024344, -0.013386, -0.011856, -0.008654, -0.002405, -0.004661, -0.010410, -0.009819, -0.009402, -0.008868, -0.001740, -0.003953, -0.003924, -0.001642, 0.006457, 0.005897, 0.009325, 0.007351, -0.005659, -0.007835, -0.008902, -0.008135, -0.001257, 0.000269, 0.000003, 0.003745, 0.007920, 0.016964
#*# 	  -0.036125, -0.030488, -0.026831, -0.022474, -0.020154, -0.016422, -0.011304, -0.005571, -0.004600, -0.005880, -0.005862, -0.006229, -0.006495, -0.003552, -0.003469, -0.001960, 0.002407, 0.001324, 0.001456, 0.000258, -0.001700, -0.005037, -0.008981, -0.008796, -0.006520, -0.005789, 0.001973, 0.004887, 0.009399, 0.004422
#*# 	  -0.023042, -0.033561, -0.032197, -0.027004, -0.022457, -0.011805, -0.005295, -0.001267, 0.000825, 0.004981, 0.005172, 0.006378, 0.004875, -0.004775, -0.008638, -0.004814, -0.001348, 0.005059, 0.005847, 0.004359, 0.000803, -0.000077, 0.004806, 0.005655, 0.008595, 0.007056, -0.003670, -0.001034, 0.001703, 0.015032
#*# 	  -0.029051, -0.026966, -0.024749, -0.020187, -0.015038, -0.009931, -0.005811, -0.000863, 0.000428, 0.000295, 0.000274, -0.000635, 0.000248, -0.001037, 0.000284, 0.002784, 0.004339, 0.007358, 0.006315, 0.002684, 0.005948, 0.004879, 0.004860, 0.006352, 0.003503, 0.004503, 0.004801, 0.006309, 0.007337, 0.013311
#*# 	  -0.036360, -0.027883, -0.025497, -0.013778, -0.008991, -0.004841, -0.005402, -0.008913, -0.009463, -0.008844, -0.009087, -0.000495, -0.001737, -0.001386, -0.000649, 0.005515, 0.010891, 0.013844, 0.013855, 0.000274, -0.001336, -0.001688, -0.001315, 0.002952, 0.004733, 0.004801, 0.006127, 0.004862, 0.012308, 0.013100
#*# 	  -0.030057, -0.029283, -0.025627, -0.020024, -0.012478, -0.009035, -0.005004, -0.004022, -0.003788, -0.003276, -0.001977, -0.000474, 0.000207, -0.004095, -0.000241, 0.001420, 0.006932, 0.009407, 0.008166, 0.006997, 0.006001, 0.003968, 0.005654, 0.002550, 0.004043, 0.005797, 0.004724, 0.010444, 0.014876, 0.014681
#*# 	  -0.018962, -0.029989, -0.026866, -0.019748, -0.008869, -0.003930, -0.000080, 0.000954, 0.000936, 0.007076, 0.009340, 0.009981, 0.002553, -0.001958, -0.001662, 0.000327, 0.009229, 0.010084, 0.012957, 0.013444, 0.012767, 0.015728, 0.013873, 0.014009, 0.018338, 0.010480, 0.009473, 0.012171, 0.015190, 0.024946
#*# 	  -0.017910, -0.018474, -0.017863, -0.012941, -0.005399, 0.000153, 0.002616, 0.006237, 0.005785, 0.006738, 0.008634, 0.007568, 0.007158, 0.007078, 0.007659, 0.009423, 0.013111, 0.013771, 0.016665, 0.016684, 0.016118, 0.018342, 0.018382, 0.020605, 0.021796, 0.020155, 0.019356, 0.019949, 0.023084, 0.031345
#*# 	  -0.023988, -0.020236, -0.016176, -0.011427, -0.005671, 0.000231, -0.001657, -0.001035, -0.000719, 0.000179, 0.004846, 0.005135, 0.004890, 0.004795, 0.004875, 0.010335, 0.013676, 0.016063, 0.015235, 0.012216, 0.012909, 0.012877, 0.012769, 0.015318, 0.017335, 0.015785, 0.015077, 0.019929, 0.022657, 0.028915
#*# 	  -0.020935, -0.022898, -0.022251, -0.017992, -0.013027, -0.006525, -0.001524, 0.000199, 0.000763, 0.000548, 0.002349, 0.003531, 0.003098, 0.002341, 0.002924, 0.005230, 0.008099, 0.010673, 0.012140, 0.012428, 0.011802, 0.011440, 0.009705, 0.007895, 0.009323, 0.009267, 0.009336, 0.010719, 0.018881, 0.026887
#*# 	  -0.010764, -0.015660, -0.017891, -0.010698, -0.005690, 0.000676, 0.004736, 0.007321, 0.011507, 0.012157, 0.014273, 0.015482, 0.005522, 0.007181, 0.009339, 0.012346, 0.016774, 0.019797, 0.020379, 0.019621, 0.019694, 0.019398, 0.019170, 0.019057, 0.017761, 0.017359, 0.017947, 0.018221, 0.022991, 0.032650
#*# 	  0.005447, 0.002584, 0.000674, 0.003660, 0.007881, 0.013719, 0.017004, 0.017761, 0.019970, 0.021716, 0.022880, 0.024351, 0.023968, 0.022998, 0.023514, 0.026437, 0.029886, 0.031826, 0.034125, 0.031959, 0.030553, 0.028237, 0.028049, 0.027697, 0.029200, 0.029417, 0.030839, 0.032087, 0.038121, 0.043120
#*# 	  -0.000848, 0.001845, -0.001869, 0.002303, 0.006398, 0.005637, 0.012223, 0.013365, 0.014434, 0.019759, 0.021851, 0.021712, 0.022595, 0.021640, 0.023607, 0.023611, 0.027608, 0.031179, 0.027267, 0.027185, 0.025109, 0.022670, 0.024144, 0.024807, 0.025171, 0.025973, 0.026497, 0.031520, 0.035069, 0.040317
#*# 	  -0.005428, -0.008614, -0.010815, -0.009507, -0.003956, 0.001043, 0.004815, 0.009344, 0.010721, 0.012791, 0.013068, 0.015016, 0.014575, 0.014207, 0.012728, 0.012997, 0.015230, 0.018495, 0.020426, 0.020172, 0.018262, 0.016933, 0.017307, 0.016488, 0.018200, 0.017742, 0.018360, 0.019495, 0.027477, 0.032041
#*# 	  -0.012171, -0.017934, -0.017897, -0.012258, -0.007798, -0.001859, 0.001716, 0.006981, 0.007069, 0.010184, 0.011579, 0.011246, 0.004661, 0.004718, 0.003180, 0.005935, 0.008457, 0.011456, 0.013832, 0.013607, 0.014806, 0.014224, 0.013861, 0.013988, 0.011788, 0.013121, 0.013877, 0.014643, 0.020912, 0.027170
#*# 	  -0.012441, -0.014948, -0.016282, -0.014612, -0.005727, 0.000240, 0.004806, 0.007586, 0.008748, 0.008976, 0.009048, 0.007452, 0.004793, 0.006131, 0.005611, 0.004841, 0.006925, 0.009957, 0.012542, 0.012012, 0.013898, 0.011590, 0.010476, 0.011509, 0.013518, 0.013915, 0.016025, 0.018344, 0.021885, 0.026997
#*# 	  -0.018191, -0.015334, -0.015660, -0.011571, -0.004673, -0.000432, 0.001864, 0.004817, 0.007304, 0.011521, 0.011964, 0.011553, 0.008440, 0.009433, 0.007068, 0.009043, 0.010062, 0.010280, 0.013401, 0.013387, 0.012437, 0.013216, 0.011723, 0.010744, 0.012037, 0.015191, 0.018483, 0.019072, 0.020742, 0.022845
#*# 	  -0.020552, -0.018228, -0.017858, -0.016107, -0.012504, -0.004663, -0.000011, 0.006509, 0.008011, 0.009833, 0.011208, 0.011085, 0.009879, 0.006788, 0.006328, 0.005593, 0.005155, 0.008494, 0.010342, 0.013051, 0.013067, 0.009901, 0.009302, 0.008296, 0.008577, 0.009622, 0.010883, 0.010084, 0.012863, 0.014033
#*# 	  -0.024524, -0.027076, -0.022124, -0.018123, -0.013913, -0.006883, -0.002249, 0.004777, 0.005755, 0.009905, 0.008101, 0.007080, 0.003967, 0.000056, -0.000467, 0.002175, 0.004570, 0.007287, 0.012396, 0.013838, 0.011308, 0.009529, 0.005871, 0.001362, 0.000863, 0.001012, 0.001063, 0.002390, 0.002240, 0.004043
#*# 	  -0.020969, -0.019670, -0.016595, -0.015144, -0.011000, -0.007045, 0.000574, 0.004741, 0.006811, 0.009403, 0.004817, 0.007065, 0.003127, 0.002515, 0.002552, 0.003181, 0.005686, 0.008266, 0.012027, 0.015560, 0.014111, 0.013844, 0.007179, 0.001069, 0.003168, 0.003632, 0.002570, 0.000711, -0.000297, 0.000271
#*# 	  -0.016157, -0.007374, -0.002972, -0.002727, -0.004814, -0.001361, 0.000993, 0.003288, 0.007309, 0.011256, 0.013653, 0.015189, 0.012599, 0.014143, 0.011031, 0.013833, 0.014143, 0.013133, 0.013928, 0.017651, 0.016725, 0.017851, 0.014903, 0.012726, 0.009194, 0.009097, 0.005857, 0.002552, 0.002867, 0.001887
#*# 	  -0.011418, -0.003724, 0.001537, 0.000951, -0.004067, -0.001313, -0.001103, 0.000285, 0.006924, 0.009229, 0.011263, 0.012476, 0.012918, 0.014499, 0.013934, 0.013846, 0.011030, 0.008568, 0.009609, 0.009696, 0.012258, 0.014978, 0.013370, 0.009374, 0.006873, 0.001210, -0.003113, -0.007157, -0.007497, -0.007584
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
