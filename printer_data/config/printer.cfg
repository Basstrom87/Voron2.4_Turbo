[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1000
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.090
#*#
#*# [scanner model default]
#*# model_coef = 1.6424034669128336,
#*# 	1.9813670376128791,
#*# 	0.7010323266849157,
#*# 	0.2834719408058709,
#*# 	0.5084347287749059,
#*# 	0.3568761031635301,
#*# 	-0.5754861242878513,
#*# 	-0.39269876504330736,
#*# 	0.3741981573486312,
#*# 	0.2233120262586856
#*# model_domain = 3.302035001343314e-07,3.3513379931488797e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 30.969658
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.012916, -0.013873, -0.011012, -0.014238, -0.011429, -0.011600, -0.011107, -0.010216, 0.014751, 0.012340, -0.000397, -0.018405, -0.018589, -0.015310, -0.015668, -0.015357, -0.027471, -0.027661, -0.023436, -0.021244, -0.021213, -0.020301, -0.019965, -0.019672, -0.016981, -0.019328, -0.019110, -0.016951, -0.013575, -0.017733
#*# 	  -0.015765, -0.015452, -0.014684, -0.014480, -0.012840, -0.013065, -0.009977, -0.002466, 0.020582, 0.008510, 0.010091, -0.011331, -0.014338, -0.004429, -0.007561, -0.018505, -0.023973, -0.024458, -0.023847, -0.018990, -0.017168, -0.019260, -0.017101, -0.018168, -0.017674, -0.021423, -0.015965, -0.014607, -0.009583, -0.013947
#*# 	  -0.021420, -0.020104, -0.021552, -0.021372, -0.016071, -0.011743, -0.011903, 0.001140, 0.016000, 0.010539, 0.019322, -0.011955, -0.012222, -0.003571, -0.009548, -0.019922, -0.021391, -0.026035, -0.023627, -0.021106, -0.019884, -0.018959, -0.019166, -0.018933, -0.018789, -0.019231, -0.019036, -0.017781, -0.010578, -0.015008
#*# 	  -0.023566, -0.019794, -0.019381, -0.014948, -0.015642, -0.014324, -0.010623, -0.001691, 0.013971, 0.010839, 0.014392, -0.011272, -0.015634, -0.017274, -0.015455, -0.022249, -0.030039, -0.023989, -0.019370, -0.021771, -0.018762, -0.017116, -0.019198, -0.015956, -0.017371, -0.018351, -0.017122, -0.010657, -0.011779, -0.010621
#*# 	  -0.024079, -0.023060, -0.019691, -0.017105, -0.015541, -0.015148, -0.012471, 0.005038, 0.008088, 0.012342, 0.018418, -0.009534, -0.021211, -0.020339, -0.022513, -0.023656, -0.025729, -0.024210, -0.019833, -0.017215, -0.017102, -0.015482, -0.016829, -0.019119, -0.017847, -0.016026, -0.015082, -0.007874, -0.005056, -0.006256
#*# 	  -0.017098, -0.019971, -0.017226, -0.014636, -0.011228, -0.014195, -0.011579, 0.004914, 0.002748, 0.007311, 0.022275, -0.004874, -0.022131, -0.022999, -0.025737, -0.023719, -0.024290, -0.026463, -0.018729, -0.016027, -0.018382, -0.014274, -0.012975, -0.012719, -0.011579, -0.011273, -0.007458, -0.005769, 0.000244, -0.002252
#*# 	  -0.012841, -0.012790, -0.012882, -0.011973, -0.007804, -0.011713, -0.012541, 0.000065, -0.004057, 0.004485, 0.022456, -0.003464, -0.022824, -0.024493, -0.023027, -0.023708, -0.022736, -0.025066, -0.019621, -0.017742, -0.015181, -0.013366, -0.010753, -0.010271, -0.007407, -0.010032, -0.006527, -0.003216, 0.002657, 0.000700
#*# 	  -0.006930, -0.008570, -0.009199, -0.009444, -0.008645, -0.011667, -0.013828, -0.006287, -0.010584, 0.005977, 0.022785, -0.004647, -0.022476, -0.025849, -0.024664, -0.024386, -0.024039, -0.023840, -0.022165, -0.017809, -0.015251, -0.013883, -0.009712, -0.009393, -0.005591, -0.006371, -0.002498, -0.001017, 0.006348, 0.003123
#*# 	  -0.023504, -0.019104, -0.013363, -0.006168, -0.003003, -0.002610, -0.012811, -0.011114, -0.014158, 0.001884, 0.022723, -0.002478, -0.024083, -0.026409, -0.026349, -0.026943, -0.026925, -0.025822, -0.021395, -0.019022, -0.014267, -0.010997, -0.008520, -0.005953, -0.002904, -0.002148, -0.001199, 0.002538, 0.007720, 0.000749
#*# 	  -0.017714, -0.013709, -0.010200, -0.011194, -0.008809, -0.007351, -0.012908, -0.008239, -0.014583, -0.005212, 0.024419, 0.005612, -0.020302, -0.025455, -0.026307, -0.025743, -0.025644, -0.024615, -0.018692, -0.014660, -0.010688, -0.008172, -0.008117, -0.003314, 0.000572, 0.001534, 0.003410, 0.006724, 0.010700, 0.004093
#*# 	  -0.012640, -0.009399, -0.006356, -0.002377, 0.000566, 0.002538, 0.001616, -0.001841, 0.002784, -0.004049, 0.026168, 0.012412, -0.014785, -0.023210, -0.022195, -0.023846, -0.023445, -0.019974, -0.014646, -0.008679, -0.006479, -0.005365, -0.000648, 0.002186, 0.003889, 0.006267, 0.008007, 0.013127, 0.014979, 0.010509
#*# 	  -0.011324, -0.008136, -0.002528, 0.000634, 0.004404, 0.005494, 0.004785, 0.000047, 0.008002, 0.019626, 0.033548, 0.012044, -0.006123, -0.016981, -0.021441, -0.021885, -0.020755, -0.015635, -0.009240, -0.008114, -0.003497, -0.003153, 0.000060, 0.003729, 0.005729, 0.006466, 0.009368, 0.012160, 0.016650, 0.012532
#*# 	  -0.016831, -0.012798, -0.004775, 0.000572, 0.004994, 0.004331, 0.006719, 0.002029, -0.004381, 0.012405, 0.028762, 0.013329, -0.001711, -0.010748, -0.017650, -0.021523, -0.018527, -0.013099, -0.007642, -0.004100, -0.001325, -0.003522, 0.000155, 0.001782, 0.004336, 0.004199, 0.007999, 0.009694, 0.015545, 0.011147
#*# 	  -0.017102, -0.017099, -0.014408, -0.008631, -0.003680, 0.000060, 0.004432, 0.011476, 0.003298, 0.012406, 0.032102, 0.018812, 0.008452, -0.001375, -0.010591, -0.017021, -0.013719, -0.008880, -0.004144, -0.001470, 0.000642, 0.001901, 0.001897, 0.002239, 0.004677, 0.004122, 0.006598, 0.010721, 0.016059, 0.011766
#*# 	  -0.007844, -0.005186, -0.002679, -0.002054, -0.001903, 0.000062, -0.002346, 0.000345, 0.010408, 0.023048, 0.036229, 0.030805, 0.015326, 0.010809, -0.004442, -0.007876, -0.008155, -0.004224, -0.000261, 0.003867, 0.003935, 0.006772, 0.007689, 0.008094, 0.009479, 0.008491, 0.009230, 0.012875, 0.017373, 0.012948
#*# 	  -0.001184, 0.001210, 0.004999, 0.008942, 0.011983, 0.012955, 0.012653, 0.008529, 0.008354, 0.029613, 0.037507, 0.035568, 0.013168, 0.013017, 0.011357, 0.004329, 0.013299, -0.000336, 0.002133, 0.005239, 0.007834, 0.008598, 0.009696, 0.010058, 0.010565, 0.009707, 0.010115, 0.012940, 0.016916, 0.015391
#*# 	  -0.004223, -0.002657, 0.004305, 0.009413, 0.015262, 0.018599, 0.019320, 0.016264, 0.020915, 0.030189, 0.029829, 0.029032, 0.017377, 0.011746, 0.008755, 0.011360, 0.008103, 0.005294, 0.002184, 0.003403, 0.006260, 0.007960, 0.007032, 0.008327, 0.007306, 0.007622, 0.008205, 0.009149, 0.013667, 0.010577
#*# 	  -0.008453, -0.004528, 0.001933, 0.008403, 0.012482, 0.020216, 0.021519, 0.019115, 0.025193, 0.032307, 0.037506, 0.037531, 0.030699, 0.016038, 0.012801, 0.012500, 0.006403, 0.004194, 0.003326, 0.004149, 0.004887, 0.005365, 0.006946, 0.006501, 0.007603, 0.005428, 0.004282, 0.007062, 0.011357, 0.009161
#*# 	  -0.012745, -0.008713, -0.002919, 0.005496, 0.012632, 0.021226, 0.022274, 0.020440, 0.030329, 0.028557, 0.042695, 0.035831, 0.007961, 0.036744, 0.004407, 0.018371, 0.026198, 0.009954, 0.002843, 0.005116, 0.005132, 0.004316, 0.004979, 0.005544, 0.006493, 0.003691, 0.004069, 0.006228, 0.011047, 0.007594
#*# 	  -0.008015, -0.007875, -0.004178, -0.000238, 0.005464, 0.014421, 0.020893, 0.026970, 0.025724, 0.028441, 0.051618, 0.035689, 0.034117, 0.036451, 0.017719, 0.030081, 0.028836, 0.026286, 0.010537, 0.008406, 0.008503, 0.008525, 0.008587, 0.008602, 0.008584, 0.007251, 0.005776, 0.008393, 0.012310, 0.008728
#*# 	  -0.008657, -0.008439, -0.004964, -0.001141, 0.004367, 0.008584, 0.020778, 0.032731, 0.009842, 0.039394, 0.047549, 0.021749, 0.034370, 0.034012, 0.027501, 0.034672, 0.017325, 0.007226, 0.027091, 0.012955, 0.010235, 0.008960, 0.009673, 0.008824, 0.009083, 0.008669, 0.006488, 0.008605, 0.012890, 0.008744
#*# 	  -0.006504, -0.007479, -0.003398, -0.000552, 0.005014, 0.013127, 0.026575, 0.015801, 0.031323, 0.050661, 0.040154, 0.031771, 0.037285, 0.019237, 0.024762, 0.032473, 0.038021, 0.034807, 0.026131, 0.016093, 0.014812, 0.015376, 0.015702, 0.015045, 0.014506, 0.012661, 0.011755, 0.012847, 0.016566, 0.011170
#*# 	  -0.007445, -0.007518, -0.002713, -0.000223, 0.004433, 0.023255, 0.034073, 0.033952, 0.043606, 0.037357, 0.021796, 0.029413, 0.023389, 0.017316, 0.022956, 0.024971, 0.038827, 0.041722, 0.026074, 0.017861, 0.017235, 0.018253, 0.017116, 0.016798, 0.015466, 0.013587, 0.013323, 0.014286, 0.017373, 0.010714
#*# 	  -0.009238, -0.008959, -0.004742, -0.000947, 0.000312, 0.011417, 0.024946, 0.037176, 0.028737, 0.018974, 0.017995, 0.017143, 0.021873, 0.027150, 0.019217, 0.009875, 0.029737, 0.035420, 0.017879, 0.017219, 0.018402, 0.017280, 0.016605, 0.014787, 0.012057, 0.009319, 0.008639, 0.010486, 0.012859, 0.004925
#*# 	  -0.012102, -0.008845, -0.005029, -0.000133, 0.004521, 0.009137, 0.013095, 0.016329, 0.016391, 0.015654, 0.021071, 0.022310, 0.020969, 0.017857, 0.015250, 0.015277, 0.033669, 0.033041, 0.019568, 0.017495, 0.017244, 0.016937, 0.016105, 0.012589, 0.010205, 0.007904, 0.006345, 0.008773, 0.011322, 0.004630
#*# 	  -0.011525, -0.005263, -0.004069, 0.003254, 0.007878, 0.011887, 0.015660, 0.018376, 0.019847, 0.021221, 0.027210, 0.028160, 0.025256, 0.023826, 0.022187, 0.025734, 0.035878, 0.031208, 0.022718, 0.021569, 0.021359, 0.019921, 0.017592, 0.013844, 0.011841, 0.007998, 0.008046, 0.008548, 0.011530, 0.003863
#*# 	  -0.005299, 0.000565, 0.002659, 0.008737, 0.013971, 0.019404, 0.024819, 0.026215, 0.027866, 0.030564, 0.034131, 0.036193, 0.037556, 0.031885, 0.029050, 0.038140, 0.040348, 0.031310, 0.029823, 0.029740, 0.028275, 0.025694, 0.023467, 0.019245, 0.016597, 0.012582, 0.011788, 0.012695, 0.015262, 0.007654
#*# 	  0.001731, 0.005377, 0.010002, 0.012702, 0.017495, 0.023535, 0.028250, 0.029305, 0.033838, 0.036405, 0.036620, 0.040350, 0.040663, 0.036188, 0.036911, 0.045001, 0.036154, 0.032080, 0.030329, 0.030445, 0.031785, 0.030233, 0.024868, 0.021864, 0.017031, 0.016096, 0.014326, 0.015140, 0.017409, 0.010416
#*# 	  0.009983, 0.013680, 0.017265, 0.019780, 0.023998, 0.029973, 0.035668, 0.038221, 0.039283, 0.041485, 0.042357, 0.044687, 0.045629, 0.040688, 0.044424, 0.047573, 0.036872, 0.034876, 0.034848, 0.035849, 0.033791, 0.030556, 0.027635, 0.022464, 0.020781, 0.017046, 0.017100, 0.016973, 0.020242, 0.010917
#*# 	  0.012848, 0.013096, 0.019127, 0.022954, 0.026844, 0.033688, 0.036271, 0.038922, 0.039476, 0.040652, 0.040196, 0.044092, 0.043547, 0.041443, 0.045295, 0.041701, 0.032954, 0.031516, 0.029561, 0.029169, 0.027187, 0.024657, 0.021412, 0.017838, 0.013403, 0.011806, 0.009632, 0.010969, 0.014879, 0.007983
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
