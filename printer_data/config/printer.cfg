[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR6
[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z1 Stepper - Rear Left on MOTOR7
[stepper_z1]
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PE5, PD12

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


# moved to printer_toolhead.cfg
# [fan_generic exhaust_fan]
# #	Exhaust fan - CNC_FAN3
# pin: PD13
# max_power: 1.0
# shutdown_speed: 0.0
# kick_start_time: 5.0

[output_pin BedFans]
pin: PA8
value: 0
shutdown_value: 0


#####################################################################
# 	LED Control
#####################################################################

[output_pin DaylightSticks]
pin: PB11
pwm: True
cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.020
#*#
#*# [scanner model default]
#*# model_coef = 1.6505600743105848,
#*# 	1.9820184161766665,
#*# 	0.7582830879408482,
#*# 	0.3162196790179616,
#*# 	0.22842829779143606,
#*# 	0.215878394581027,
#*# 	-0.14771289914230398,
#*# 	-0.17974717229611736,
#*# 	0.1601374346159676,
#*# 	0.11699363406748503
#*# model_domain = 3.3036003167324736e-07,3.351243187450464e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 22.204529
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.019385, 0.007690, 0.007391, 0.007111, 0.006891, 0.005661, 0.001661, -0.004063, -0.007079, -0.007724, 0.001363, -0.011855, -0.014084, -0.014673, -0.018277, -0.017979, -0.016009, -0.012881, -0.018876, -0.006149, -0.006320, -0.008499, -0.009169, -0.006727, -0.004970, -0.002406, -0.000625, 0.001532, 0.006212, 0.011026
#*# 	  0.000500, 0.000139, -0.000687, -0.001724, -0.000980, -0.001607, -0.004778, -0.007311, -0.009674, -0.013368, -0.004273, -0.014163, -0.014549, -0.015229, -0.028237, -0.020389, -0.017058, -0.014001, -0.011472, -0.009167, -0.011069, -0.011232, -0.012021, -0.011173, -0.008845, -0.006895, -0.003363, -0.014233, 0.005896, 0.023854
#*# 	  -0.011604, -0.000713, 0.000888, 0.013582, -0.000472, -0.002061, -0.001571, -0.003887, -0.006092, -0.009984, -0.009779, -0.011962, -0.009762, -0.010960, -0.012598, -0.015749, -0.000454, -0.011427, -0.006912, -0.006458, -0.007439, -0.009018, -0.009941, -0.008440, -0.016347, -0.004479, 0.002026, 0.006448, 0.012657, 0.018906
#*# 	  0.017685, 0.017327, 0.017063, 0.017650, 0.027756, 0.018271, 0.017848, 0.017281, 0.004218, 0.012300, 0.009346, 0.008818, 0.008427, 0.008737, 0.006958, 0.006632, 0.009816, 0.013266, 0.016609, 0.017208, 0.015356, 0.000472, 0.011052, 0.013391, 0.015548, 0.020543, 0.025328, 0.031117, 0.036595, 0.042850
#*# 	  0.026491, 0.022753, 0.023965, 0.025072, 0.026014, 0.013578, 0.027253, 0.025748, 0.024463, 0.034297, 0.022576, 0.020439, 0.018165, 0.017843, 0.018378, 0.020536, 0.025061, 0.028017, 0.031895, 0.033942, 0.031826, 0.028493, 0.037167, 0.028278, 0.036229, 0.044614, 0.047276, 0.053019, 0.057418, 0.064147
#*# 	  0.012526, 0.007560, -0.000463, 0.010717, 0.011424, 0.011768, 0.010962, 0.009623, 0.006936, 0.007627, 0.007357, 0.007012, 0.003772, 0.002179, 0.002859, -0.005306, 0.008893, 0.013024, 0.015903, 0.017899, 0.016214, 0.016100, 0.015577, 0.029984, 0.024317, 0.033372, 0.039294, 0.031935, 0.050481, 0.056496
#*# 	  -0.000741, -0.002925, -0.002844, -0.002249, -0.000534, 0.000267, -0.002019, -0.003316, -0.003784, -0.005872, -0.006957, -0.018908, -0.007562, -0.011388, -0.011907, -0.000427, -0.007259, -0.003995, 0.000297, 0.000586, 0.001419, 0.001748, 0.003503, 0.006388, 0.010717, 0.016551, 0.022821, 0.029507, 0.045091, 0.042683
#*# 	  -0.006781, -0.008432, -0.008073, -0.007284, -0.004995, -0.006961, -0.007848, -0.007606, -0.011734, -0.020210, -0.012944, -0.015012, -0.015628, -0.016588, -0.017419, -0.016450, -0.013837, 0.000880, -0.006966, -0.004874, -0.004923, -0.004213, -0.001454, 0.000552, 0.004216, 0.008885, 0.012748, 0.019754, 0.027650, 0.035657
#*# 	  0.004479, 0.004020, 0.002422, 0.003854, -0.004947, 0.004546, 0.004545, 0.002322, 0.000483, -0.001130, -0.002631, -0.004264, -0.005313, -0.008906, -0.008890, -0.007040, -0.002959, -0.009490, 0.002481, 0.002343, 0.002406, 0.010900, 0.006970, 0.011563, 0.015301, 0.020453, 0.025297, 0.031021, 0.038706, 0.046492
#*# 	  0.017569, 0.007078, 0.008079, 0.002175, 0.011309, 0.012267, 0.013201, 0.013496, 0.011646, 0.009911, 0.007612, 0.010131, 0.002019, 0.000076, -0.000700, -0.006835, 0.004297, 0.006165, 0.007151, 0.008941, 0.010415, 0.011851, 0.013678, 0.017966, 0.032273, 0.027668, 0.032368, 0.040613, 0.038760, 0.054601
#*# 	  0.013448, 0.011004, 0.018252, 0.012281, 0.013495, 0.015526, 0.016401, 0.017653, 0.014407, 0.013200, -0.000258, 0.008379, 0.004384, 0.002357, 0.010695, 0.005842, 0.008296, 0.010567, 0.013361, 0.014632, 0.015219, 0.015999, 0.017785, 0.016673, 0.025766, 0.030337, 0.035966, 0.047415, 0.051479, 0.058296
#*# 	  0.013525, 0.009547, 0.009331, 0.009284, 0.011533, 0.015742, 0.012580, 0.012548, 0.009778, 0.004391, 0.006390, 0.005480, 0.003595, 0.000456, 0.002314, 0.004713, 0.009200, 0.011315, 0.020418, 0.014869, 0.015947, 0.016098, 0.012423, 0.020592, 0.025657, 0.033030, 0.038520, 0.046894, 0.054843, 0.061126
#*# 	  0.013576, 0.009100, 0.008398, 0.010949, 0.006692, 0.014426, 0.012352, 0.012305, 0.018522, 0.009843, 0.008961, 0.006967, 0.004330, 0.002742, 0.002631, 0.007415, 0.005917, 0.015430, 0.017174, 0.019303, 0.018653, 0.024900, 0.021732, 0.024027, 0.029076, 0.036058, 0.043294, 0.047942, 0.054759, 0.059437
#*# 	  0.023922, 0.017829, 0.017043, 0.017099, 0.022420, 0.022063, 0.020376, 0.017614, 0.014995, 0.013555, 0.011618, 0.010500, 0.009243, 0.002850, 0.004280, 0.008829, 0.008724, 0.017903, 0.019349, 0.022755, 0.022744, 0.022417, 0.025091, 0.028491, 0.042064, 0.043677, 0.051444, 0.057593, 0.062441, 0.067713
#*# 	  0.011382, 0.015880, 0.010109, 0.013617, 0.017898, 0.022091, 0.022511, 0.022798, 0.020531, 0.019183, 0.013193, 0.016656, 0.011075, 0.008171, 0.013869, 0.013237, 0.018030, 0.022165, 0.025411, 0.027343, 0.027109, 0.027899, 0.025202, 0.029836, 0.034449, 0.039467, 0.045065, 0.052291, 0.056051, 0.053861
#*# 	  0.014705, 0.011413, 0.013046, 0.018192, 0.024001, 0.028900, 0.034209, 0.031987, 0.032674, 0.031765, 0.027404, 0.027723, 0.023128, 0.020465, 0.019809, 0.021967, 0.025592, 0.029002, 0.037221, 0.034948, 0.034829, 0.035364, 0.036100, 0.031961, 0.039439, 0.041957, 0.045137, 0.047897, 0.052664, 0.057371
#*# 	  0.026263, 0.023860, 0.027224, 0.027122, 0.036671, 0.042973, 0.047315, 0.055046, 0.051670, 0.051895, 0.051866, 0.050019, 0.045498, 0.041516, 0.039143, 0.038419, 0.038898, 0.045603, 0.047211, 0.050200, 0.054340, 0.049644, 0.051368, 0.050438, 0.051876, 0.053144, 0.054725, 0.055426, 0.056616, 0.064335
#*# 	  0.032862, 0.033204, 0.035689, 0.040582, 0.044092, 0.050991, 0.057024, 0.060493, 0.063305, 0.064558, 0.067427, 0.067925, 0.065381, 0.059579, 0.054068, 0.052535, 0.050892, 0.056449, 0.059248, 0.059175, 0.059545, 0.060327, 0.059969, 0.061100, 0.064965, 0.069849, 0.065507, 0.065483, 0.068382, 0.072890
#*# 	  0.030003, 0.033634, 0.031905, 0.036508, 0.041308, 0.047989, 0.050248, 0.052859, 0.054761, 0.054907, 0.064961, 0.067167, 0.066291, 0.061278, 0.059785, 0.050323, 0.050053, 0.049650, 0.050827, 0.050403, 0.051713, 0.051545, 0.050859, 0.057033, 0.060642, 0.060794, 0.064103, 0.060815, 0.065033, 0.066069
#*# 	  0.023515, 0.022686, 0.022458, 0.026242, 0.031034, 0.034255, 0.036396, 0.033276, 0.034191, 0.039257, 0.048182, 0.058876, 0.059896, 0.057030, 0.049393, 0.044597, 0.038708, 0.036533, 0.035420, 0.034046, 0.031633, 0.034385, 0.038945, 0.040837, 0.047812, 0.047940, 0.047801, 0.048594, 0.052891, 0.061025
#*# 	  0.034711, 0.028218, 0.029505, 0.027020, 0.034794, 0.037686, 0.036567, 0.038191, 0.030828, 0.038716, 0.050824, 0.063182, 0.069876, 0.070412, 0.062090, 0.052385, 0.047486, 0.043195, 0.038079, 0.036632, 0.032920, 0.033759, 0.041011, 0.046101, 0.050204, 0.051367, 0.051245, 0.053015, 0.059425, 0.067023
#*# 	  0.041093, 0.036669, 0.037526, 0.039786, 0.043503, 0.045526, 0.045824, 0.045989, 0.044829, 0.049509, 0.063580, 0.077777, 0.087019, 0.087138, 0.081375, 0.073126, 0.067851, 0.061345, 0.054576, 0.046548, 0.043603, 0.046182, 0.051751, 0.055070, 0.057408, 0.061572, 0.062887, 0.066342, 0.073288, 0.077135
#*# 	  0.046794, 0.045786, 0.043486, 0.046749, 0.048543, 0.052187, 0.052551, 0.055114, 0.056704, 0.059503, 0.069755, 0.082144, 0.088455, 0.091562, 0.083912, 0.077975, 0.072879, 0.068636, 0.063821, 0.057870, 0.054621, 0.053374, 0.054145, 0.057024, 0.060061, 0.063010, 0.068279, 0.073138, 0.081158, 0.084393
#*# 	  0.049111, 0.044867, 0.046066, 0.049127, 0.051765, 0.055414, 0.057598, 0.059188, 0.061370, 0.064718, 0.070290, 0.075379, 0.078234, 0.078101, 0.074990, 0.071849, 0.070464, 0.068334, 0.064795, 0.061564, 0.057962, 0.055659, 0.054684, 0.054764, 0.057029, 0.061102, 0.064351, 0.071934, 0.079808, 0.082736
#*# 	  0.052461, 0.047102, 0.045316, 0.050701, 0.055218, 0.058801, 0.061205, 0.062691, 0.061687, 0.062787, 0.062430, 0.061819, 0.060748, 0.059937, 0.058218, 0.055048, 0.058338, 0.058654, 0.059420, 0.059301, 0.054741, 0.049444, 0.049780, 0.048964, 0.050444, 0.054062, 0.058674, 0.064359, 0.070227, 0.074850
#*# 	  0.057948, 0.054789, 0.059739, 0.064606, 0.068516, 0.070459, 0.071913, 0.073005, 0.072863, 0.070832, 0.068483, 0.064786, 0.060494, 0.057765, 0.056470, 0.057728, 0.060323, 0.065144, 0.068261, 0.064383, 0.061836, 0.056316, 0.053549, 0.052255, 0.055057, 0.059848, 0.064593, 0.065127, 0.071171, 0.072832
#*# 	  0.069132, 0.067623, 0.070826, 0.075173, 0.079811, 0.083523, 0.084274, 0.085351, 0.081840, 0.082963, 0.079880, 0.077680, 0.072409, 0.070294, 0.064987, 0.063805, 0.068272, 0.073070, 0.075101, 0.074957, 0.071886, 0.067219, 0.064825, 0.063888, 0.063592, 0.064753, 0.067800, 0.067643, 0.072447, 0.076194
#*# 	  0.067104, 0.066251, 0.068544, 0.072082, 0.077278, 0.079893, 0.080418, 0.081197, 0.082179, 0.081828, 0.080454, 0.079340, 0.071364, 0.067437, 0.063734, 0.063360, 0.067737, 0.071698, 0.072590, 0.071899, 0.068836, 0.066100, 0.065025, 0.060504, 0.060708, 0.058813, 0.056353, 0.057552, 0.061415, 0.067194
#*# 	  0.060490, 0.060894, 0.061553, 0.067420, 0.073845, 0.078588, 0.081845, 0.082083, 0.081906, 0.081841, 0.081617, 0.077541, 0.073379, 0.067049, 0.062666, 0.063882, 0.067729, 0.068844, 0.073167, 0.072844, 0.066167, 0.064853, 0.060422, 0.057038, 0.053812, 0.049827, 0.046786, 0.045607, 0.048782, 0.054149
#*# 	  0.042999, 0.041933, 0.049162, 0.055317, 0.063667, 0.070038, 0.070653, 0.073639, 0.074358, 0.073818, 0.073898, 0.069594, 0.062706, 0.058716, 0.053944, 0.055278, 0.058516, 0.059461, 0.061275, 0.058723, 0.054659, 0.051188, 0.047067, 0.042168, 0.037352, 0.032101, 0.027380, 0.026679, 0.027382, 0.031944
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
