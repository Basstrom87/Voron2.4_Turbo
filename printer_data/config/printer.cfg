[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1000
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.100
#*#
#*# [scanner model default]
#*# model_coef = 1.6424034669128336,
#*# 	1.9813670376128791,
#*# 	0.7010323266849157,
#*# 	0.2834719408058709,
#*# 	0.5084347287749059,
#*# 	0.3568761031635301,
#*# 	-0.5754861242878513,
#*# 	-0.39269876504330736,
#*# 	0.3741981573486312,
#*# 	0.2233120262586856
#*# model_domain = 3.302035001343314e-07,3.3513379931488797e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 30.969658
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.008167, -0.008198, -0.004664, -0.003953, -0.005266, -0.007493, -0.005129, -0.003721, 0.018899, 0.017250, 0.004912, -0.013147, -0.012265, -0.008326, -0.012745, -0.007518, -0.020349, -0.018826, -0.015919, -0.013924, -0.012608, -0.012141, -0.012321, -0.011020, -0.009787, -0.009749, -0.009218, -0.005384, 0.000185, -0.003042
#*# 	  -0.012335, -0.010625, -0.008785, -0.007839, -0.008837, -0.008448, -0.006792, -0.000131, 0.024579, 0.016376, 0.015550, -0.008444, -0.005800, 0.000255, -0.000019, -0.011023, -0.020102, -0.020620, -0.016139, -0.012649, -0.012459, -0.011329, -0.010635, -0.009821, -0.009172, -0.009273, -0.009927, -0.007213, -0.000141, -0.000852
#*# 	  -0.018406, -0.016048, -0.014499, -0.013066, -0.012610, -0.013081, -0.011853, 0.004059, 0.022031, 0.012978, 0.018635, -0.007731, -0.006630, -0.002330, -0.002896, -0.014446, -0.022864, -0.020884, -0.018629, -0.016334, -0.014312, -0.013200, -0.012554, -0.011692, -0.011801, -0.011938, -0.011479, -0.007718, -0.001759, -0.004091
#*# 	  -0.019218, -0.019924, -0.016931, -0.014486, -0.012392, -0.012030, -0.009383, 0.006964, 0.018794, 0.016111, 0.020763, -0.008195, -0.011800, -0.010773, -0.011863, -0.018212, -0.024042, -0.020254, -0.015762, -0.013468, -0.013069, -0.012174, -0.011941, -0.011373, -0.011825, -0.012911, -0.011712, -0.007637, -0.004044, -0.001879
#*# 	  -0.020847, -0.020731, -0.018636, -0.014469, -0.013540, -0.012375, -0.006983, 0.006963, 0.014184, 0.014314, 0.020238, -0.006681, -0.018045, -0.018765, -0.018763, -0.023444, -0.023106, -0.021207, -0.012592, -0.014290, -0.013087, -0.013371, -0.012949, -0.012165, -0.011460, -0.011828, -0.011331, -0.006979, 0.000440, 0.000084
#*# 	  -0.016626, -0.016748, -0.015620, -0.012476, -0.011800, -0.011450, -0.009557, 0.005721, 0.006013, 0.006350, 0.024841, -0.002469, -0.020159, -0.020845, -0.020798, -0.021962, -0.022000, -0.020358, -0.014582, -0.012827, -0.012666, -0.012201, -0.010531, -0.009007, -0.007786, -0.008412, -0.007254, -0.002182, 0.005480, 0.004466
#*# 	  -0.010138, -0.012954, -0.011767, -0.010116, -0.009576, -0.009432, -0.010272, 0.001621, -0.001176, 0.002688, 0.025743, -0.001066, -0.020769, -0.023370, -0.022200, -0.022615, -0.019324, -0.022653, -0.016215, -0.014916, -0.014043, -0.012175, -0.008032, -0.007359, -0.004266, -0.004552, -0.004077, 0.000680, 0.008136, 0.007211
#*# 	  -0.004594, -0.006091, -0.008136, -0.007571, -0.007036, -0.008261, -0.011826, -0.008183, -0.010137, 0.001921, 0.024857, -0.002274, -0.021806, -0.025036, -0.024216, -0.022137, -0.021545, -0.023278, -0.020170, -0.017874, -0.014619, -0.011808, -0.008952, -0.003966, -0.003893, -0.003213, -0.000084, 0.004015, 0.010323, 0.009129
#*# 	  -0.022961, -0.018988, -0.010896, -0.004833, -0.002131, -0.004490, -0.013441, -0.012133, -0.014961, 0.001529, 0.023508, 0.001127, -0.022933, -0.026775, -0.024001, -0.026983, -0.026148, -0.024751, -0.021227, -0.016888, -0.013365, -0.011079, -0.009907, -0.007101, -0.002610, -0.000618, 0.002304, 0.006501, 0.010732, 0.007741
#*# 	  -0.020939, -0.017723, -0.013849, -0.012531, -0.009450, -0.008573, -0.016888, -0.011771, -0.015653, -0.005679, 0.022623, 0.007759, -0.021027, -0.026577, -0.025267, -0.027491, -0.025228, -0.023097, -0.018023, -0.014591, -0.012285, -0.009147, -0.007586, -0.003768, 0.000127, 0.001296, 0.005023, 0.008924, 0.012314, 0.009462
#*# 	  -0.016755, -0.013979, -0.010233, -0.007025, -0.003807, -0.000937, 0.000542, -0.004682, 0.001086, -0.004319, 0.025438, 0.011568, -0.017320, -0.024110, -0.023501, -0.024671, -0.023233, -0.019373, -0.012724, -0.010820, -0.008522, -0.004669, -0.003919, -0.000040, 0.003422, 0.004919, 0.008637, 0.012326, 0.015319, 0.011902
#*# 	  -0.014204, -0.011444, -0.006429, -0.003107, 0.001840, 0.002492, 0.001785, -0.001690, 0.007866, 0.018833, 0.034168, 0.016516, -0.008380, -0.020367, -0.023175, -0.023698, -0.021086, -0.015531, -0.009329, -0.007803, -0.004028, -0.000897, -0.000044, 0.002496, 0.004394, 0.004641, 0.008510, 0.013473, 0.017389, 0.013056
#*# 	  -0.019377, -0.016194, -0.007712, -0.002899, 0.000485, 0.002465, 0.003627, 0.000591, -0.007053, 0.010208, 0.030142, 0.012753, -0.003750, -0.014573, -0.022708, -0.024231, -0.021910, -0.015722, -0.009307, -0.004367, -0.000803, 0.000099, 0.001605, 0.002968, 0.005001, 0.005620, 0.007662, 0.011430, 0.016985, 0.012905
#*# 	  -0.019802, -0.018854, -0.017150, -0.012354, -0.007221, -0.002285, 0.003843, 0.009954, 0.002598, 0.012437, 0.033208, 0.019972, 0.005157, -0.004694, -0.014458, -0.019415, -0.016576, -0.010811, -0.005928, -0.000529, 0.001764, 0.004253, 0.004486, 0.004978, 0.004797, 0.004677, 0.006632, 0.009692, 0.014941, 0.013316
#*# 	  -0.010275, -0.008168, -0.005873, -0.004321, -0.005411, -0.004649, -0.005987, -0.002004, 0.007655, 0.022344, 0.035805, 0.034256, 0.012658, 0.008255, -0.001913, -0.010237, -0.008578, -0.003446, -0.001357, 0.003571, 0.006399, 0.010179, 0.010617, 0.009816, 0.010717, 0.008941, 0.008838, 0.011463, 0.016887, 0.016117
#*# 	  -0.004697, -0.001933, 0.004310, 0.006285, 0.008686, 0.010739, 0.010480, 0.007617, 0.008099, 0.029864, 0.036176, 0.039732, 0.011068, 0.010148, 0.008264, 0.004516, 0.012264, 0.000057, 0.003560, 0.004769, 0.008613, 0.011570, 0.012877, 0.012859, 0.011725, 0.008868, 0.008835, 0.012845, 0.016820, 0.017381
#*# 	  -0.006136, -0.004605, 0.001888, 0.008593, 0.011285, 0.016663, 0.019098, 0.016911, 0.020670, 0.032402, 0.033297, 0.030087, 0.018238, 0.011811, 0.010408, 0.010078, 0.008553, 0.007681, 0.004601, 0.004749, 0.007471, 0.009481, 0.010816, 0.010069, 0.009540, 0.007780, 0.008248, 0.009813, 0.015573, 0.013728
#*# 	  -0.008046, -0.007229, -0.001720, 0.004139, 0.011082, 0.018016, 0.019854, 0.018866, 0.025242, 0.036293, 0.039951, 0.043340, 0.032901, 0.016164, 0.013068, 0.011461, 0.006348, 0.004738, 0.004834, 0.004524, 0.006005, 0.007994, 0.008509, 0.008128, 0.007523, 0.004813, 0.004574, 0.007834, 0.013159, 0.011389
#*# 	  -0.008078, -0.008458, -0.003735, 0.004632, 0.012066, 0.020198, 0.022832, 0.019437, 0.031589, 0.033392, 0.043752, 0.038390, 0.009193, 0.038020, 0.003019, 0.017066, 0.026967, 0.012478, 0.003254, 0.004794, 0.007565, 0.006511, 0.005606, 0.004723, 0.007313, 0.004561, 0.005255, 0.007417, 0.011935, 0.011573
#*# 	  -0.003797, -0.005798, -0.001785, 0.000323, 0.005312, 0.012723, 0.022104, 0.027855, 0.028452, 0.030474, 0.056062, 0.035556, 0.035388, 0.039720, 0.018564, 0.029572, 0.029558, 0.028454, 0.012649, 0.009072, 0.008613, 0.008260, 0.006671, 0.007575, 0.008636, 0.007907, 0.006684, 0.008716, 0.013174, 0.012436
#*# 	  -0.003992, -0.002827, -0.002827, 0.000630, 0.005768, 0.010368, 0.020005, 0.035105, 0.011690, 0.043104, 0.051347, 0.024581, 0.036960, 0.036600, 0.029539, 0.037395, 0.020393, 0.006432, 0.028691, 0.013765, 0.009524, 0.008350, 0.008950, 0.008871, 0.008995, 0.008738, 0.008511, 0.009381, 0.014115, 0.012528
#*# 	  -0.001682, -0.001719, 0.001959, 0.002192, 0.007160, 0.015037, 0.028719, 0.020903, 0.034844, 0.055528, 0.050490, 0.035675, 0.041151, 0.025776, 0.025430, 0.035979, 0.041120, 0.036847, 0.029839, 0.015596, 0.014925, 0.014977, 0.014839, 0.014094, 0.015154, 0.013247, 0.012911, 0.014251, 0.018393, 0.015020
#*# 	  0.000510, -0.001329, 0.002155, 0.003863, 0.008059, 0.026377, 0.040429, 0.037878, 0.049439, 0.042030, 0.025312, 0.032416, 0.027205, 0.020434, 0.026168, 0.027624, 0.040449, 0.046843, 0.032148, 0.020224, 0.017601, 0.018698, 0.018796, 0.016418, 0.015868, 0.013888, 0.014003, 0.015387, 0.018092, 0.012400
#*# 	  -0.001089, -0.001057, -0.003280, 0.004013, 0.007983, 0.017568, 0.029882, 0.040763, 0.037854, 0.023207, 0.022184, 0.027095, 0.026104, 0.029522, 0.026940, 0.012717, 0.033855, 0.040889, 0.023181, 0.020869, 0.020686, 0.020805, 0.020154, 0.017948, 0.013876, 0.012336, 0.012782, 0.012862, 0.015110, 0.010006
#*# 	  0.000451, -0.002764, 0.001467, 0.006395, 0.012352, 0.016200, 0.019077, 0.021414, 0.022900, 0.022987, 0.027995, 0.028099, 0.026521, 0.022374, 0.019110, 0.019329, 0.038959, 0.038047, 0.025627, 0.024341, 0.021804, 0.021123, 0.018999, 0.017189, 0.013291, 0.010743, 0.009699, 0.012585, 0.014989, 0.008300
#*# 	  0.000839, 0.004415, 0.006314, 0.010787, 0.015695, 0.020499, 0.027739, 0.026701, 0.027502, 0.029525, 0.032125, 0.032234, 0.034990, 0.031201, 0.027720, 0.031902, 0.042184, 0.037772, 0.028689, 0.030147, 0.028305, 0.026183, 0.022751, 0.019104, 0.016465, 0.012705, 0.011383, 0.012831, 0.016396, 0.010175
#*# 	  0.006701, 0.010796, 0.013884, 0.018100, 0.024173, 0.028559, 0.030130, 0.037003, 0.038056, 0.039707, 0.042285, 0.044137, 0.044022, 0.040192, 0.039071, 0.044169, 0.047346, 0.039993, 0.035708, 0.036927, 0.033700, 0.032616, 0.029453, 0.024887, 0.021339, 0.017883, 0.016817, 0.017563, 0.021092, 0.015899
#*# 	  0.014461, 0.017052, 0.021520, 0.022763, 0.027382, 0.032897, 0.036788, 0.041488, 0.043999, 0.046067, 0.048744, 0.051304, 0.050236, 0.046501, 0.046420, 0.054520, 0.048374, 0.039983, 0.038936, 0.039959, 0.038798, 0.037157, 0.035317, 0.030168, 0.025960, 0.021568, 0.021391, 0.022553, 0.025131, 0.019850
#*# 	  0.022210, 0.024314, 0.027711, 0.030025, 0.034628, 0.040611, 0.046607, 0.049364, 0.048810, 0.050430, 0.050041, 0.054314, 0.054350, 0.051050, 0.052616, 0.056635, 0.048093, 0.043086, 0.042446, 0.042360, 0.041040, 0.038222, 0.036683, 0.029514, 0.028824, 0.024961, 0.024154, 0.025222, 0.027042, 0.022109
#*# 	  0.023288, 0.026297, 0.029388, 0.033083, 0.037380, 0.042661, 0.047521, 0.050580, 0.051089, 0.051016, 0.050448, 0.056137, 0.052648, 0.052349, 0.054492, 0.049975, 0.042958, 0.039218, 0.038879, 0.037626, 0.037361, 0.034032, 0.031406, 0.027455, 0.025138, 0.021249, 0.021060, 0.021262, 0.025164, 0.019933
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
