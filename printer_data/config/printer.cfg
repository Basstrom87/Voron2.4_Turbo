[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR6
[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z1 Stepper - Rear Left on MOTOR7
[stepper_z1]
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PE5, PD12

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


# moved to printer_toolhead.cfg
# [fan_generic exhaust_fan]
# #	Exhaust fan - CNC_FAN3
# pin: PD13
# max_power: 1.0
# shutdown_speed: 0.0
# kick_start_time: 5.0

[output_pin BedFans]
pin: PA8
value: 0
shutdown_value: 0


#####################################################################
# 	LED Control
#####################################################################

[output_pin DaylightSticks]
pin: PB11
pwm: True
cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.000
#*#
#*# [scanner model default]
#*# model_coef = 1.6505600743105848,
#*# 	1.9820184161766665,
#*# 	0.7582830879408482,
#*# 	0.3162196790179616,
#*# 	0.22842829779143606,
#*# 	0.215878394581027,
#*# 	-0.14771289914230398,
#*# 	-0.17974717229611736,
#*# 	0.1601374346159676,
#*# 	0.11699363406748503
#*# model_domain = 3.3036003167324736e-07,3.351243187450464e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 22.204529
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.030643, 0.019656, 0.034791, 0.020889, 0.021183, 0.019441, 0.016217, 0.011694, 0.007199, -0.009057, -0.011768, -0.013654, -0.002129, 0.008841, 0.007355, 0.007171, -0.004195, -0.002006, 0.000545, 0.002699, 0.002174, 0.002140, -0.011206, -0.010313, 0.003314, 0.006470, 0.018311, 0.021011, 0.015133, 0.021602
#*# 	  0.011814, 0.021326, 0.021700, 0.021755, 0.010975, -0.002822, -0.002095, -0.004368, 0.000807, -0.002009, -0.003852, -0.003878, -0.004402, -0.004830, 0.003892, 0.002654, -0.009105, -0.006245, -0.016220, -0.012253, -0.015408, -0.003512, -0.004493, -0.004415, -0.003288, -0.000457, 0.016825, 0.021388, 0.025985, 0.031918
#*# 	  0.027340, 0.012121, 0.026234, 0.025683, 0.011721, 0.012573, 0.010683, 0.007916, 0.004785, 0.002033, -0.015540, -0.016065, -0.016066, -0.001855, 0.010375, 0.007193, 0.007174, -0.003952, -0.001086, -0.000286, -0.001604, -0.004428, -0.004402, -0.015774, -0.013602, 0.000308, 0.004908, 0.020361, 0.025825, 0.023369
#*# 	  0.030470, 0.036936, 0.038630, 0.029119, 0.018739, 0.020596, 0.019957, 0.027897, 0.025757, 0.023121, 0.020703, 0.018843, 0.016802, 0.026366, 0.025083, 0.014239, 0.017344, 0.009569, 0.011584, 0.011805, 0.020501, 0.018339, 0.016617, 0.016530, 0.018717, 0.036446, 0.040955, 0.044797, 0.038186, 0.058722
#*# 	  0.050630, 0.034559, 0.044692, 0.048391, 0.048782, 0.037047, 0.036367, 0.036588, 0.034850, 0.034521, 0.032335, 0.016227, 0.014394, 0.025579, 0.025211, 0.039072, 0.043099, 0.044371, 0.038375, 0.037954, 0.036912, 0.031827, 0.030156, 0.030392, 0.028715, 0.034836, 0.050305, 0.054921, 0.068213, 0.066506
#*# 	  0.023550, 0.027749, 0.016539, 0.019324, 0.012619, 0.011863, 0.020842, 0.019498, 0.017400, 0.016730, 0.016391, 0.014991, 0.019794, 0.018359, 0.008093, 0.009489, 0.002476, 0.006998, 0.010251, 0.021065, 0.019270, 0.017922, 0.016356, 0.018662, 0.023630, 0.041764, 0.048934, 0.044312, 0.050936, 0.057221
#*# 	  0.012343, -0.004084, 0.005927, 0.018627, 0.021004, 0.018736, 0.006060, 0.005960, 0.004108, 0.002798, 0.000704, 0.000199, -0.012999, -0.016449, -0.006317, -0.006271, 0.008323, 0.011462, 0.002534, 0.002917, 0.001472, 0.001805, 0.002577, 0.004414, 0.008833, 0.006819, 0.011249, 0.027075, 0.033491, 0.041040
#*# 	  -0.002238, 0.001271, 0.000277, -0.006749, -0.004111, 0.001480, 0.000599, -0.000137, -0.004092, -0.005843, -0.006115, 0.000222, -0.000048, -0.010767, -0.014309, -0.020909, -0.020734, -0.016162, -0.005120, -0.004929, -0.007040, -0.004733, -0.003674, -0.002096, 0.011803, 0.014107, 0.009203, 0.014696, 0.011511, 0.031719
#*# 	  0.016024, 0.001875, 0.000315, 0.011933, 0.021283, 0.022667, 0.021342, 0.009597, 0.006500, 0.005007, 0.003357, 0.002390, 0.000818, -0.012152, -0.015964, -0.002630, -0.001062, 0.011768, 0.011511, 0.002528, 0.001982, 0.004347, 0.005519, 0.008700, 0.011232, 0.015370, 0.012189, 0.016655, 0.032357, 0.034770
#*# 	  0.014701, 0.015061, 0.009510, 0.010065, 0.015464, 0.017159, 0.016960, 0.016441, 0.015013, 0.013173, 0.017028, 0.016442, 0.007944, 0.004846, -0.002824, -0.002168, 0.000530, 0.007957, 0.008706, 0.009730, 0.009487, 0.010467, 0.011649, 0.023076, 0.027593, 0.023233, 0.025694, 0.023288, 0.032408, 0.049572
#*# 	  0.020967, 0.007690, 0.007163, 0.015426, 0.017963, 0.027162, 0.029066, 0.027912, 0.017737, 0.016286, 0.014709, 0.012435, 0.008287, 0.007130, -0.002093, 0.000594, 0.009513, 0.011528, 0.021008, 0.021023, 0.013935, 0.012846, 0.015297, 0.016931, 0.020501, 0.023929, 0.022176, 0.030112, 0.038538, 0.048250
#*# 	  0.018897, 0.012598, 0.010645, 0.014976, 0.016793, 0.018881, 0.017870, 0.017529, 0.014501, 0.017295, 0.014065, 0.013612, 0.006933, 0.002148, 0.000225, 0.000882, 0.010794, 0.013668, 0.014950, 0.014452, 0.012813, 0.013820, 0.021060, 0.022607, 0.018894, 0.024820, 0.025213, 0.030210, 0.045967, 0.053777
#*# 	  0.019718, 0.016127, 0.007179, 0.010672, 0.018711, 0.019698, 0.027690, 0.025792, 0.022750, 0.014122, 0.013053, 0.010444, 0.008468, 0.004998, 0.005187, 0.002459, 0.006267, 0.015896, 0.016505, 0.025555, 0.022743, 0.016198, 0.016348, 0.017625, 0.022139, 0.026619, 0.034171, 0.034963, 0.042009, 0.048357
#*# 	  0.028699, 0.024098, 0.023713, 0.026941, 0.028138, 0.030187, 0.027990, 0.024806, 0.023041, 0.020879, 0.017352, 0.013121, 0.007177, 0.002720, 0.002464, 0.010137, 0.014117, 0.017733, 0.019589, 0.021002, 0.019869, 0.025626, 0.025719, 0.022323, 0.027917, 0.029525, 0.037337, 0.042517, 0.053090, 0.058434
#*# 	  0.021708, 0.018501, 0.016477, 0.015241, 0.019151, 0.029206, 0.030047, 0.036170, 0.031911, 0.030305, 0.021742, 0.018823, 0.013937, 0.010166, 0.010889, 0.014042, 0.011880, 0.015848, 0.025185, 0.025599, 0.030795, 0.030250, 0.024755, 0.026240, 0.028883, 0.030042, 0.035217, 0.040558, 0.044073, 0.053268
#*# 	  0.025400, 0.020876, 0.022729, 0.025906, 0.031364, 0.036396, 0.039512, 0.041459, 0.039553, 0.039367, 0.034819, 0.029930, 0.025615, 0.021169, 0.021624, 0.023206, 0.026806, 0.030204, 0.033047, 0.034200, 0.034972, 0.035786, 0.033194, 0.032519, 0.030130, 0.030207, 0.030927, 0.039524, 0.044034, 0.050998
#*# 	  0.033159, 0.031142, 0.033280, 0.037833, 0.039399, 0.043985, 0.052734, 0.055394, 0.058435, 0.058112, 0.057918, 0.049337, 0.046183, 0.042550, 0.039056, 0.039288, 0.037894, 0.039479, 0.043593, 0.048239, 0.046202, 0.050018, 0.049238, 0.044723, 0.045231, 0.046101, 0.045746, 0.046913, 0.050820, 0.057878
#*# 	  0.043938, 0.042322, 0.043534, 0.046933, 0.053272, 0.058613, 0.064392, 0.067420, 0.068542, 0.067485, 0.068906, 0.066940, 0.064813, 0.061170, 0.056700, 0.055252, 0.055965, 0.057182, 0.059272, 0.062125, 0.062071, 0.058249, 0.055783, 0.053048, 0.055825, 0.057445, 0.059996, 0.059807, 0.062287, 0.067787
#*# 	  0.037083, 0.039023, 0.038523, 0.042489, 0.046408, 0.048504, 0.051437, 0.055955, 0.056165, 0.062126, 0.067041, 0.070562, 0.066276, 0.061755, 0.057509, 0.051903, 0.051073, 0.046900, 0.047474, 0.046927, 0.048684, 0.050609, 0.052892, 0.053197, 0.054607, 0.054709, 0.054584, 0.054234, 0.057570, 0.064215
#*# 	  0.034870, 0.033050, 0.031085, 0.034865, 0.038744, 0.041371, 0.042503, 0.040137, 0.038510, 0.040601, 0.049646, 0.056530, 0.060122, 0.058223, 0.053148, 0.046868, 0.042571, 0.039363, 0.037844, 0.033496, 0.030297, 0.030814, 0.033080, 0.037658, 0.043358, 0.042840, 0.043665, 0.042698, 0.047411, 0.052963
#*# 	  0.038888, 0.039960, 0.038804, 0.041299, 0.044324, 0.045160, 0.041752, 0.037396, 0.037980, 0.040224, 0.050221, 0.062234, 0.072177, 0.071624, 0.068206, 0.059060, 0.052448, 0.048173, 0.039064, 0.033076, 0.027135, 0.030354, 0.035086, 0.041950, 0.047678, 0.046495, 0.047096, 0.048575, 0.054293, 0.063249
#*# 	  0.052078, 0.049481, 0.049788, 0.050731, 0.053048, 0.053873, 0.054725, 0.054891, 0.051186, 0.054749, 0.063891, 0.079613, 0.089145, 0.091035, 0.087455, 0.078910, 0.072796, 0.067886, 0.060020, 0.051257, 0.044850, 0.043791, 0.047736, 0.052217, 0.054073, 0.057181, 0.058448, 0.062941, 0.069026, 0.077463
#*# 	  0.052871, 0.053033, 0.052383, 0.054923, 0.057048, 0.059476, 0.060557, 0.057880, 0.058070, 0.064477, 0.072215, 0.080765, 0.091967, 0.094244, 0.089739, 0.084317, 0.080064, 0.074838, 0.068127, 0.060992, 0.053117, 0.052407, 0.053535, 0.057596, 0.060181, 0.059778, 0.063197, 0.068654, 0.076379, 0.083999
#*# 	  0.058133, 0.057258, 0.055350, 0.057461, 0.060996, 0.065488, 0.066138, 0.068293, 0.067604, 0.071172, 0.073901, 0.078866, 0.081956, 0.081177, 0.080478, 0.078113, 0.074370, 0.071744, 0.069231, 0.066087, 0.059376, 0.056709, 0.053363, 0.053641, 0.054468, 0.058241, 0.062948, 0.068936, 0.076559, 0.084389
#*# 	  0.057079, 0.057926, 0.055730, 0.059269, 0.064081, 0.066502, 0.067345, 0.065371, 0.065804, 0.068346, 0.068928, 0.068767, 0.068912, 0.066832, 0.064376, 0.063090, 0.061557, 0.063002, 0.064312, 0.061119, 0.057202, 0.052966, 0.050630, 0.049871, 0.050782, 0.053192, 0.057548, 0.063106, 0.070555, 0.075478
#*# 	  0.069425, 0.067481, 0.068540, 0.074204, 0.078140, 0.080017, 0.082442, 0.084555, 0.081327, 0.080422, 0.077598, 0.073331, 0.069772, 0.066316, 0.062392, 0.064803, 0.069401, 0.071417, 0.073895, 0.071667, 0.066695, 0.062151, 0.056788, 0.055390, 0.057540, 0.061564, 0.064539, 0.067781, 0.071672, 0.076400
#*# 	  0.080958, 0.079059, 0.080924, 0.085056, 0.090621, 0.093046, 0.093555, 0.094423, 0.093810, 0.089160, 0.087105, 0.086607, 0.080561, 0.077101, 0.074146, 0.075713, 0.080148, 0.084535, 0.084841, 0.082421, 0.077912, 0.071172, 0.069027, 0.064534, 0.067312, 0.068304, 0.070896, 0.071321, 0.073816, 0.080111
#*# 	  0.075555, 0.071252, 0.074773, 0.079639, 0.084531, 0.089201, 0.091088, 0.093657, 0.089765, 0.089901, 0.088283, 0.084693, 0.080172, 0.074917, 0.071263, 0.075729, 0.080480, 0.084698, 0.084745, 0.081798, 0.077647, 0.073432, 0.070766, 0.067481, 0.066460, 0.062573, 0.061117, 0.060919, 0.063970, 0.071192
#*# 	  0.069680, 0.071175, 0.071848, 0.078224, 0.082945, 0.088258, 0.089096, 0.090562, 0.090647, 0.089108, 0.087670, 0.084291, 0.080847, 0.075696, 0.073435, 0.077025, 0.080460, 0.084290, 0.084346, 0.079758, 0.075492, 0.070772, 0.066506, 0.064397, 0.061561, 0.057112, 0.054473, 0.053139, 0.053057, 0.058831
#*# 	  0.048691, 0.051354, 0.056198, 0.062971, 0.071261, 0.077829, 0.080215, 0.081170, 0.082461, 0.082716, 0.082262, 0.078663, 0.073919, 0.065040, 0.065542, 0.065241, 0.070656, 0.073192, 0.072861, 0.069064, 0.062903, 0.059560, 0.056395, 0.050817, 0.047668, 0.041653, 0.034685, 0.030933, 0.033936, 0.039232
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
