[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.120
#*#
#*# [scanner model default]
#*# model_coef = 1.6515713098967568,
#*# 	1.9885357572322888,
#*# 	0.7187313893945685,
#*# 	0.19164399108706373,
#*# 	0.3659472061943571,
#*# 	0.7017235797535931,
#*# 	-0.3481099719192544,
#*# 	-0.8804481383950366,
#*# 	0.2631193459639314,
#*# 	0.45218815282783953
#*# model_domain = 3.3020111401827494e-07,3.3508802221553266e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 25.042367
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.002669, -0.003392, -0.000546, 0.001584, -0.000668, -0.002164, -0.000538, 0.000583, 0.029237, 0.024916, 0.011288, -0.006631, -0.006394, -0.003113, -0.008906, -0.002939, -0.011752, -0.013340, -0.011999, -0.004944, -0.006800, -0.007245, -0.005694, -0.008913, -0.002432, -0.003974, -0.006900, 0.002633, 0.003942, 0.001479
#*# 	  -0.008257, -0.006989, -0.006767, -0.002971, -0.004270, -0.003938, -0.000860, 0.007078, 0.032649, 0.023426, 0.019019, -0.003178, -0.002453, 0.003470, 0.001861, -0.007086, -0.015446, -0.015284, -0.010790, -0.007219, -0.006806, -0.004994, -0.004951, -0.006293, -0.005998, -0.006309, -0.005840, -0.002684, 0.005812, 0.001328
#*# 	  -0.015879, -0.015467, -0.010495, -0.010679, -0.008933, -0.006931, -0.004713, 0.008149, 0.025800, 0.018264, 0.021882, -0.004805, -0.004626, -0.001000, -0.000842, -0.011338, -0.019264, -0.018410, -0.012735, -0.011299, -0.010773, -0.008874, -0.008175, -0.008432, -0.008035, -0.009858, -0.008953, -0.006855, 0.000773, -0.001776
#*# 	  -0.019782, -0.018930, -0.015459, -0.012935, -0.011188, -0.009205, -0.006321, 0.009949, 0.022109, 0.019360, 0.024749, -0.007026, -0.010809, -0.008612, -0.010596, -0.015571, -0.020004, -0.018693, -0.015437, -0.012881, -0.011309, -0.011362, -0.008062, -0.010194, -0.009288, -0.010985, -0.011467, -0.004703, 0.000966, -0.002181
#*# 	  -0.021829, -0.019554, -0.019686, -0.014919, -0.011604, -0.010661, -0.006910, 0.010759, 0.015080, 0.017943, 0.026358, -0.006664, -0.015569, -0.016342, -0.015470, -0.020191, -0.022116, -0.018546, -0.013634, -0.012490, -0.011204, -0.011092, -0.010929, -0.010913, -0.009239, -0.011299, -0.010964, -0.006649, 0.001478, 0.001132
#*# 	  -0.019483, -0.019039, -0.015925, -0.013338, -0.013360, -0.010999, -0.008956, 0.007409, 0.006107, 0.007765, 0.027422, -0.002780, -0.019273, -0.019741, -0.019320, -0.022326, -0.019714, -0.020102, -0.014722, -0.011698, -0.012903, -0.010849, -0.009100, -0.008789, -0.006774, -0.007849, -0.007196, -0.003566, 0.001374, 0.003569
#*# 	  -0.011189, -0.013461, -0.011692, -0.011170, -0.007395, -0.010686, -0.011129, 0.003586, -0.003707, 0.006333, 0.027088, -0.001925, -0.019591, -0.022390, -0.020225, -0.021642, -0.019901, -0.020120, -0.016377, -0.013556, -0.011466, -0.011168, -0.007983, -0.006798, -0.005797, -0.005638, -0.004587, -0.000469, 0.006460, 0.005844
#*# 	  -0.006977, -0.008784, -0.009713, -0.009195, -0.007755, -0.009976, -0.012332, -0.006792, -0.011036, 0.004450, 0.026914, -0.002201, -0.022122, -0.025217, -0.022948, -0.021895, -0.020994, -0.023726, -0.019341, -0.015981, -0.014365, -0.011209, -0.010802, -0.005839, -0.003593, -0.002747, -0.002125, 0.001520, 0.010355, 0.006595
#*# 	  -0.028135, -0.022792, -0.013308, -0.007395, -0.003649, -0.005443, -0.015566, -0.013372, -0.015417, 0.001719, 0.024023, 0.000033, -0.023985, -0.024032, -0.025045, -0.026136, -0.027744, -0.025282, -0.019872, -0.017236, -0.013761, -0.011248, -0.010065, -0.006798, -0.002740, -0.002673, 0.001056, 0.004973, 0.009951, 0.005527
#*# 	  -0.024949, -0.021482, -0.017539, -0.015520, -0.014971, -0.010966, -0.016620, -0.011681, -0.019211, -0.006055, 0.023062, 0.006274, -0.022891, -0.027036, -0.026586, -0.028293, -0.026374, -0.023764, -0.019474, -0.015457, -0.012182, -0.011224, -0.008796, -0.005859, -0.002783, 0.000513, 0.002586, 0.006746, 0.012126, 0.005506
#*# 	  -0.020592, -0.016232, -0.013905, -0.010147, -0.006157, -0.001773, -0.002629, -0.005886, 0.000945, -0.006324, 0.026916, 0.011493, -0.015430, -0.024197, -0.024221, -0.024673, -0.024020, -0.020041, -0.015441, -0.011168, -0.010102, -0.006944, -0.005320, -0.001693, -0.000020, 0.002082, 0.005340, 0.010261, 0.014263, 0.009682
#*# 	  -0.018730, -0.015660, -0.011176, -0.006598, -0.001704, -0.002039, 0.000500, -0.003137, 0.005929, 0.018584, 0.035204, 0.014311, -0.010043, -0.019320, -0.024000, -0.024032, -0.023750, -0.017184, -0.011200, -0.008265, -0.006917, -0.004660, -0.002658, 0.000259, 0.002027, 0.004735, 0.005962, 0.010592, 0.014204, 0.011880
#*# 	  -0.023684, -0.019691, -0.011017, -0.005648, -0.002509, 0.000818, 0.002006, -0.001607, -0.006467, 0.011092, 0.031710, 0.013271, -0.003797, -0.015558, -0.020725, -0.023998, -0.021667, -0.015469, -0.009616, -0.005375, -0.002873, -0.002719, -0.002274, -0.000073, 0.002138, 0.003274, 0.003993, 0.010012, 0.014687, 0.010593
#*# 	  -0.025863, -0.023514, -0.021808, -0.015705, -0.011098, -0.005687, -0.000822, 0.005819, 0.000774, 0.012488, 0.033210, 0.018840, 0.003967, -0.006688, -0.015438, -0.020594, -0.016129, -0.011278, -0.007932, -0.002785, -0.000904, 0.001290, 0.000675, 0.001673, 0.001691, 0.002650, 0.004707, 0.008998, 0.014551, 0.010718
#*# 	  -0.014811, -0.012194, -0.006955, -0.007960, -0.007512, -0.006666, -0.007224, -0.005865, 0.006130, 0.022820, 0.037441, 0.031587, 0.011093, 0.006084, -0.004844, -0.012194, -0.010257, -0.003218, -0.002667, -0.000480, 0.003330, 0.005680, 0.005804, 0.006009, 0.006185, 0.005817, 0.005868, 0.009247, 0.015031, 0.012958
#*# 	  -0.007962, -0.004794, -0.002661, 0.003686, 0.006190, 0.010067, 0.009988, 0.005217, 0.006070, 0.029613, 0.035393, 0.038549, 0.009931, 0.010596, 0.006840, 0.001591, 0.011693, -0.002298, 0.001185, 0.004455, 0.005822, 0.008162, 0.008537, 0.008924, 0.007913, 0.005877, 0.006375, 0.010097, 0.016136, 0.013757
#*# 	  -0.011184, -0.007296, -0.002355, 0.004865, 0.009149, 0.014289, 0.015403, 0.014734, 0.018536, 0.031074, 0.036081, 0.027473, 0.015913, 0.009815, 0.006318, 0.006875, 0.005999, 0.005865, 0.001170, 0.003142, 0.005726, 0.006089, 0.007040, 0.006444, 0.006790, 0.005449, 0.005793, 0.008116, 0.012507, 0.010006
#*# 	  -0.010430, -0.011984, -0.000464, 0.003204, 0.009702, 0.015580, 0.014289, 0.018747, 0.024479, 0.034280, 0.039492, 0.041463, 0.033314, 0.014350, 0.009570, 0.010346, 0.005327, 0.002275, 0.002672, 0.002586, 0.003966, 0.005715, 0.005519, 0.005007, 0.005203, 0.002791, 0.003098, 0.003746, 0.009837, 0.009103
#*# 	  -0.011594, -0.011446, -0.006842, 0.001769, 0.009281, 0.018215, 0.019313, 0.018417, 0.031273, 0.032959, 0.045004, 0.038346, 0.006124, 0.038985, 0.001883, 0.017992, 0.027375, 0.011442, 0.001590, 0.003630, 0.005134, 0.004714, 0.004080, 0.002726, 0.004242, 0.001742, 0.001573, 0.004766, 0.009690, 0.008686
#*# 	  -0.005059, -0.006599, -0.004527, -0.004634, 0.003607, 0.010074, 0.022408, 0.028701, 0.023734, 0.030763, 0.057166, 0.033456, 0.035887, 0.039638, 0.018764, 0.031093, 0.025410, 0.027406, 0.012216, 0.005820, 0.006318, 0.006130, 0.006250, 0.005758, 0.005558, 0.005804, 0.003207, 0.005832, 0.011693, 0.010375
#*# 	  -0.004798, -0.006733, -0.003594, -0.000497, 0.005623, 0.009543, 0.018428, 0.034506, 0.010341, 0.043572, 0.050261, 0.022482, 0.037410, 0.035997, 0.028514, 0.038833, 0.020009, 0.005958, 0.030244, 0.012602, 0.008352, 0.009068, 0.009178, 0.008990, 0.008602, 0.006586, 0.006270, 0.009081, 0.014227, 0.011101
#*# 	  -0.004655, -0.004099, -0.003571, 0.003968, 0.007630, 0.014076, 0.028462, 0.016389, 0.034270, 0.054885, 0.047219, 0.037424, 0.041594, 0.024528, 0.025651, 0.031259, 0.044431, 0.039396, 0.028990, 0.016306, 0.014490, 0.014861, 0.016221, 0.014292, 0.014721, 0.014101, 0.013324, 0.014272, 0.018561, 0.014654
#*# 	  -0.000532, -0.000549, 0.002139, 0.005393, 0.007969, 0.027936, 0.040548, 0.039164, 0.050997, 0.043322, 0.027314, 0.032187, 0.027022, 0.019543, 0.026891, 0.026776, 0.040508, 0.049040, 0.031262, 0.020540, 0.018535, 0.019656, 0.019481, 0.018483, 0.018524, 0.015779, 0.015075, 0.016504, 0.019963, 0.014671
#*# 	  -0.000794, -0.003225, 0.005959, 0.005658, 0.009046, 0.019007, 0.030924, 0.044830, 0.038517, 0.021669, 0.026899, 0.025735, 0.025191, 0.033221, 0.025648, 0.016271, 0.035791, 0.042659, 0.024816, 0.022170, 0.021862, 0.022859, 0.022375, 0.019470, 0.017480, 0.016355, 0.014634, 0.016891, 0.018526, 0.013697
#*# 	  -0.003678, -0.001615, 0.001583, 0.009767, 0.012977, 0.017969, 0.018997, 0.021854, 0.022329, 0.022791, 0.026919, 0.030671, 0.027846, 0.022696, 0.020604, 0.019955, 0.039403, 0.038687, 0.025879, 0.024635, 0.022767, 0.022678, 0.020660, 0.018394, 0.014564, 0.011682, 0.011020, 0.014272, 0.017797, 0.009797
#*# 	  0.005795, 0.010850, 0.007868, 0.011140, 0.022698, 0.024036, 0.027707, 0.029100, 0.026805, 0.035667, 0.036285, 0.035188, 0.039648, 0.033654, 0.029566, 0.034727, 0.043258, 0.041728, 0.030607, 0.030701, 0.031133, 0.027835, 0.026571, 0.022662, 0.018334, 0.015249, 0.014573, 0.017238, 0.019540, 0.014628
#*# 	  0.010091, 0.015316, 0.015444, 0.021657, 0.028119, 0.031500, 0.036898, 0.040469, 0.039621, 0.045420, 0.046921, 0.047837, 0.049754, 0.043872, 0.041620, 0.048239, 0.049974, 0.043728, 0.039489, 0.039503, 0.037033, 0.035688, 0.035119, 0.029246, 0.026409, 0.022747, 0.021374, 0.022705, 0.026837, 0.020727
#*# 	  0.014260, 0.019957, 0.021694, 0.031118, 0.032794, 0.035476, 0.047023, 0.047857, 0.049423, 0.050235, 0.052000, 0.058291, 0.054653, 0.050024, 0.052793, 0.058150, 0.052238, 0.045805, 0.043731, 0.047930, 0.043803, 0.042151, 0.041217, 0.035009, 0.031382, 0.028031, 0.026493, 0.027318, 0.032196, 0.026639
#*# 	  0.026857, 0.025112, 0.035341, 0.036013, 0.039457, 0.047077, 0.051851, 0.055286, 0.056137, 0.056246, 0.062333, 0.060464, 0.060144, 0.060427, 0.059480, 0.063434, 0.054214, 0.050213, 0.048950, 0.048596, 0.047733, 0.046635, 0.043338, 0.037901, 0.035328, 0.031120, 0.031135, 0.032495, 0.035329, 0.030108
#*# 	  0.027199, 0.030898, 0.039493, 0.040642, 0.043555, 0.052265, 0.054551, 0.058437, 0.059188, 0.058446, 0.062390, 0.063883, 0.060375, 0.061446, 0.063820, 0.060725, 0.052645, 0.047903, 0.048336, 0.044769, 0.043721, 0.043701, 0.039501, 0.035488, 0.032160, 0.029424, 0.028913, 0.029429, 0.032310, 0.029034
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
