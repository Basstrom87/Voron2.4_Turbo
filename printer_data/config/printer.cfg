[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR6
[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z1 Stepper - Rear Left on MOTOR7
[stepper_z1]
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PE5, PD12

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


# moved to printer_toolhead.cfg
# [fan_generic exhaust_fan]
# #	Exhaust fan - CNC_FAN3
# pin: PD13
# max_power: 1.0
# shutdown_speed: 0.0
# kick_start_time: 5.0

[output_pin BedFans]
pin: PA8
value: 0
shutdown_value: 0


#####################################################################
# 	LED Control
#####################################################################

[output_pin DaylightSticks]
pin: PB11
pwm: True
cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.000
#*#
#*# [scanner model default]
#*# model_coef = 1.6505600743105848,
#*# 	1.9820184161766665,
#*# 	0.7582830879408482,
#*# 	0.3162196790179616,
#*# 	0.22842829779143606,
#*# 	0.215878394581027,
#*# 	-0.14771289914230398,
#*# 	-0.17974717229611736,
#*# 	0.1601374346159676,
#*# 	0.11699363406748503
#*# model_domain = 3.3036003167324736e-07,3.351243187450464e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 22.204529
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.004811, 0.008587, 0.012934, 0.015494, 0.017142, 0.019203, 0.021727, 0.016444, 0.008943, 0.002329, -0.000053, -0.001983, 0.000779, -0.000225, -0.002978, -0.004576, -0.003533, -0.001458, 0.005099, 0.006684, 0.000074, -0.002438, -0.008929, -0.009871, -0.009311, -0.007106, -0.008289, -0.009171, -0.010454, -0.006694
#*# 	  -0.007832, -0.002839, -0.002085, -0.000352, 0.003297, 0.004718, 0.005887, 0.005374, 0.001164, -0.002447, -0.003202, -0.003768, -0.002864, -0.003560, -0.006360, -0.013101, -0.013721, -0.007476, -0.003846, 0.002015, 0.000180, -0.006824, -0.009476, -0.012029, -0.011850, -0.011729, -0.011450, -0.014536, -0.014533, -0.011502
#*# 	  -0.008862, -0.002656, -0.006852, -0.004966, -0.010223, -0.006573, 0.000033, -0.000829, -0.003849, -0.006491, -0.007335, -0.006341, 0.000654, 0.001320, 0.000006, -0.009655, -0.010075, -0.013728, -0.009145, -0.003171, -0.004306, -0.008450, -0.012779, -0.012881, -0.011904, -0.007055, -0.007000, -0.009406, -0.006880, -0.004361
#*# 	  0.003170, 0.000012, 0.002860, 0.005946, 0.008079, 0.009438, 0.011753, 0.008895, 0.008398, 0.006893, 0.009046, 0.008074, 0.013604, 0.014385, 0.006049, 0.005699, 0.006733, 0.006992, 0.011638, 0.015587, 0.007068, 0.004462, 0.004826, 0.003536, 0.011058, 0.013618, 0.014025, 0.011475, 0.014037, 0.019541
#*# 	  0.008879, 0.014769, 0.017601, 0.019399, 0.023797, 0.025989, 0.027689, 0.035806, 0.033149, 0.025682, 0.026073, 0.017296, 0.017717, 0.016166, 0.020899, 0.022852, 0.024854, 0.027172, 0.032631, 0.032920, 0.036974, 0.032521, 0.022699, 0.021726, 0.020125, 0.023715, 0.032300, 0.034056, 0.033570, 0.040840
#*# 	  -0.000171, -0.000840, 0.002364, 0.005126, 0.013651, 0.015697, 0.014931, 0.011901, 0.011808, 0.012072, 0.010693, 0.010359, 0.008536, 0.003991, 0.003296, 0.006827, 0.009240, 0.018174, 0.023308, 0.019903, 0.015292, 0.013565, 0.011199, 0.009765, 0.013463, 0.011444, 0.015233, 0.019010, 0.028295, 0.032867
#*# 	  -0.008839, -0.010923, -0.003850, -0.003347, -0.003517, 0.000111, -0.006867, -0.009147, -0.002313, -0.002557, -0.002308, -0.003700, -0.002659, -0.005063, -0.007147, -0.000411, 0.001383, -0.003085, 0.000109, -0.002297, -0.005600, -0.002158, -0.002310, -0.001486, -0.001503, 0.002090, 0.004348, 0.014419, 0.015825, 0.019505
#*# 	  -0.021437, -0.020849, -0.020008, -0.016905, -0.013948, -0.016973, -0.014569, -0.011689, -0.013140, -0.012436, -0.008439, -0.008857, -0.014037, -0.015510, -0.016245, -0.015718, -0.013802, -0.010943, -0.013898, -0.013750, -0.009076, -0.009639, -0.004575, -0.003846, -0.007894, -0.008038, -0.005069, -0.001841, 0.003202, 0.010747
#*# 	  -0.015347, -0.020393, -0.018382, -0.010428, -0.008882, -0.008218, -0.008908, -0.007229, -0.008255, -0.003420, -0.004010, -0.008777, -0.009324, -0.011222, -0.016109, -0.009836, -0.006593, -0.004600, -0.004081, -0.004313, -0.004453, -0.004832, -0.000002, 0.001361, -0.001884, 0.000065, -0.001737, 0.004350, 0.010358, 0.019578
#*# 	  -0.006718, -0.009489, -0.008267, -0.004452, -0.005313, -0.004353, -0.002129, -0.000167, 0.000025, 0.000192, -0.001672, -0.005733, -0.004868, -0.002695, -0.003884, 0.001750, 0.005466, 0.003672, 0.004404, 0.004480, 0.002297, 0.002452, 0.002038, 0.002855, -0.000764, 0.006809, 0.010492, 0.014131, 0.024813, 0.033129
#*# 	  -0.004288, -0.005935, -0.006799, -0.005828, 0.000693, 0.004525, 0.001522, 0.003962, -0.000689, -0.000058, 0.004227, 0.003789, 0.002002, 0.001662, 0.000615, 0.004110, 0.005390, 0.012466, 0.009491, 0.008598, 0.008070, -0.000029, 0.001690, 0.007904, 0.007284, 0.009184, 0.013002, 0.018242, 0.022604, 0.033774
#*# 	  -0.006790, -0.008486, -0.008615, -0.007050, -0.005691, -0.001162, 0.000802, 0.002184, 0.002083, 0.004526, 0.001990, 0.000489, -0.000260, 0.000008, 0.000819, 0.002052, 0.002481, 0.003815, 0.010222, 0.010303, 0.007427, 0.009358, 0.004563, 0.006702, 0.009114, 0.011427, 0.015881, 0.022354, 0.025967, 0.027151
#*# 	  -0.010077, -0.012487, -0.011040, -0.012764, -0.006276, -0.003532, -0.001697, -0.000035, -0.001888, -0.000151, 0.000152, 0.002266, 0.000383, -0.002351, -0.002511, -0.000190, 0.001218, 0.007266, 0.009203, 0.010116, 0.006982, 0.005845, 0.003814, 0.005585, 0.009767, 0.015302, 0.017014, 0.022948, 0.022313, 0.030741
#*# 	  -0.004200, -0.005584, -0.004377, -0.000529, 0.003969, 0.005363, 0.006415, 0.005577, 0.003768, 0.002834, -0.000091, 0.001268, -0.000169, -0.002306, 0.000624, 0.001512, 0.006256, 0.010387, 0.011364, 0.012540, 0.010279, 0.007671, 0.004528, 0.003297, 0.011375, 0.017953, 0.027309, 0.032767, 0.032032, 0.036098
#*# 	  -0.008973, -0.010252, -0.007768, -0.003058, 0.002727, 0.006333, 0.011695, 0.010257, 0.007308, 0.009625, 0.006380, 0.003808, 0.004165, 0.001613, -0.001012, 0.003158, 0.007687, 0.012248, 0.015965, 0.018274, 0.012480, 0.012102, 0.011059, 0.007507, 0.009092, 0.014461, 0.016227, 0.020544, 0.024356, 0.030555
#*# 	  -0.012844, -0.012053, -0.010175, -0.004956, 0.003690, 0.010131, 0.014910, 0.016750, 0.017865, 0.018203, 0.018120, 0.015230, 0.012492, 0.010224, 0.006738, 0.008584, 0.013762, 0.017041, 0.019164, 0.022651, 0.020019, 0.018006, 0.016193, 0.015336, 0.014402, 0.014300, 0.015740, 0.013177, 0.016146, 0.025214
#*# 	  -0.009678, -0.008304, -0.005674, 0.002331, 0.009352, 0.015925, 0.023002, 0.026304, 0.028001, 0.030604, 0.029486, 0.028596, 0.026307, 0.023623, 0.020411, 0.020084, 0.022939, 0.023346, 0.027297, 0.031437, 0.029124, 0.026686, 0.024911, 0.023979, 0.022285, 0.022678, 0.024103, 0.024730, 0.024801, 0.030188
#*# 	  -0.000001, 0.000108, 0.006122, 0.012029, 0.019194, 0.026221, 0.033525, 0.038714, 0.040789, 0.042388, 0.044067, 0.043454, 0.040339, 0.036376, 0.032459, 0.031681, 0.033807, 0.036588, 0.037944, 0.039698, 0.038504, 0.035612, 0.033864, 0.031759, 0.033931, 0.036242, 0.033783, 0.033553, 0.033557, 0.036684
#*# 	  -0.000344, -0.000560, 0.001960, 0.009206, 0.015908, 0.022443, 0.029485, 0.033968, 0.035048, 0.038377, 0.040526, 0.040769, 0.040329, 0.037180, 0.031394, 0.027935, 0.028295, 0.029232, 0.031534, 0.031582, 0.028623, 0.028376, 0.026004, 0.027351, 0.028562, 0.029926, 0.028080, 0.027989, 0.027448, 0.033164
#*# 	  -0.011277, -0.012169, -0.009138, -0.004392, 0.002117, 0.006367, 0.011350, 0.011016, 0.009501, 0.013187, 0.017377, 0.022568, 0.025407, 0.022662, 0.015556, 0.011325, 0.008646, 0.008933, 0.008872, 0.007026, 0.004528, 0.004134, 0.005579, 0.010030, 0.013558, 0.013569, 0.012025, 0.011478, 0.013960, 0.019831
#*# 	  -0.010959, -0.009165, -0.008869, -0.003085, 0.000737, 0.004528, 0.006699, 0.003245, -0.000178, 0.000953, 0.008589, 0.018353, 0.023659, 0.024666, 0.020195, 0.014246, 0.008024, 0.004352, 0.004085, -0.000635, -0.006282, -0.005410, -0.000083, 0.005648, 0.009538, 0.009886, 0.009332, 0.010495, 0.013557, 0.022377
#*# 	  0.000146, 0.000936, 0.003852, 0.004022, 0.011204, 0.013923, 0.017565, 0.015877, 0.010200, 0.010802, 0.020357, 0.031822, 0.040656, 0.040772, 0.036653, 0.030184, 0.023027, 0.020366, 0.017210, 0.010040, 0.005099, 0.005669, 0.011060, 0.015958, 0.016852, 0.019950, 0.019829, 0.021185, 0.026728, 0.032464
#*# 	  0.006066, 0.008857, 0.009803, 0.013608, 0.018120, 0.021310, 0.023370, 0.025589, 0.023169, 0.026168, 0.032161, 0.040849, 0.047615, 0.049227, 0.044581, 0.039517, 0.035483, 0.031699, 0.028805, 0.022591, 0.018152, 0.016504, 0.017454, 0.019270, 0.022224, 0.023152, 0.024972, 0.027304, 0.032847, 0.041728
#*# 	  0.006233, 0.004996, 0.007116, 0.012019, 0.017185, 0.020626, 0.023252, 0.025755, 0.026268, 0.027120, 0.031617, 0.036009, 0.040250, 0.039541, 0.036086, 0.031681, 0.029823, 0.028785, 0.027116, 0.023816, 0.019796, 0.017194, 0.014647, 0.013523, 0.013583, 0.015989, 0.019382, 0.028820, 0.034088, 0.036102
#*# 	  0.002322, 0.003397, 0.005058, 0.009350, 0.013601, 0.017954, 0.019632, 0.020441, 0.022087, 0.022697, 0.024379, 0.024733, 0.023519, 0.022834, 0.018983, 0.017498, 0.018000, 0.018182, 0.019783, 0.018546, 0.014458, 0.012852, 0.008608, 0.008411, 0.008634, 0.008956, 0.012960, 0.017958, 0.023936, 0.029983
#*# 	  0.006569, 0.006530, 0.012025, 0.014655, 0.021070, 0.023526, 0.027129, 0.029260, 0.027274, 0.028463, 0.027398, 0.024141, 0.022065, 0.017453, 0.013788, 0.015587, 0.017833, 0.022669, 0.026810, 0.025423, 0.021235, 0.015695, 0.009890, 0.009181, 0.009305, 0.012954, 0.014456, 0.020319, 0.020411, 0.025573
#*# 	  0.019746, 0.019550, 0.022812, 0.028710, 0.033505, 0.037643, 0.040601, 0.040648, 0.041033, 0.040245, 0.038827, 0.035521, 0.029484, 0.023776, 0.021591, 0.022557, 0.026733, 0.031511, 0.036131, 0.035420, 0.030020, 0.023788, 0.019059, 0.015798, 0.015381, 0.018112, 0.018552, 0.019165, 0.021326, 0.027439
#*# 	  0.019094, 0.019694, 0.023245, 0.026525, 0.032381, 0.034755, 0.037846, 0.039796, 0.040690, 0.040334, 0.037687, 0.034069, 0.030718, 0.024031, 0.021479, 0.023141, 0.028839, 0.033917, 0.035555, 0.034227, 0.027813, 0.022711, 0.019656, 0.016176, 0.013479, 0.013743, 0.011330, 0.008793, 0.010642, 0.015705
#*# 	  0.008389, 0.008853, 0.011710, 0.015866, 0.021458, 0.026501, 0.028369, 0.030565, 0.030701, 0.031620, 0.030874, 0.025623, 0.021664, 0.017416, 0.014618, 0.017705, 0.022639, 0.027337, 0.030420, 0.025093, 0.022998, 0.015688, 0.012707, 0.008754, 0.002858, 0.001388, -0.002293, -0.003967, -0.004259, 0.002079
#*# 	  -0.008835, -0.004355, -0.004071, 0.002701, 0.009826, 0.016578, 0.021914, 0.022648, 0.022662, 0.022949, 0.022984, 0.020493, 0.014762, 0.009073, 0.005903, 0.005821, 0.010833, 0.015016, 0.018085, 0.013147, 0.008034, 0.002895, -0.001195, -0.003918, -0.009730, -0.013620, -0.020583, -0.025063, -0.022275, -0.019191
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
