[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR6
[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z1 Stepper - Rear Left on MOTOR7
[stepper_z1]
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PE5, PD12

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


# moved to printer_toolhead.cfg
# [fan_generic exhaust_fan]
# #	Exhaust fan - CNC_FAN3
# pin: PD13
# max_power: 1.0
# shutdown_speed: 0.0
# kick_start_time: 5.0

[output_pin BedFans]
pin: PA8
value: 0
shutdown_value: 0


#####################################################################
# 	LED Control
#####################################################################

[output_pin DaylightSticks]
pin: PB11
pwm: True
cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.045
#*#
#*# [scanner model default]
#*# model_coef = 1.6505600743105848,
#*# 	  1.9820184161766665,
#*# 	  0.7582830879408482,
#*# 	  0.3162196790179616,
#*# 	  0.22842829779143606,
#*# 	  0.215878394581027,
#*# 	  -0.14771289914230398,
#*# 	  -0.17974717229611736,
#*# 	  0.1601374346159676,
#*# 	  0.11699363406748503
#*# model_domain = 3.3036003167324736e-07,3.351243187450464e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 22.204529
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.065474, -0.063051, -0.059718, -0.054660, -0.052595, -0.046584, -0.042501, -0.040364, -0.040837, -0.046285, -0.043423, -0.040180, -0.037592, -0.026427, -0.029113, -0.031066, -0.031008, -0.036396, -0.038072, -0.043313, -0.052760, -0.060179, -0.072490, -0.076562, -0.073970, -0.068922, -0.065725, -0.066890, -0.065479, -0.065560
#*# 	  -0.054666, -0.059226, -0.058633, -0.051346, -0.042472, -0.034457, -0.029361, -0.029168, -0.029578, -0.028418, -0.021667, -0.017443, -0.012841, -0.015678, -0.021983, -0.026517, -0.031104, -0.026888, -0.028335, -0.031845, -0.040160, -0.046478, -0.046089, -0.049084, -0.048837, -0.047024, -0.058655, -0.058420, -0.051011, -0.045450
#*# 	  -0.051640, -0.053621, -0.051786, -0.045437, -0.046160, -0.040133, -0.035909, -0.026413, -0.017374, -0.019726, -0.016171, -0.019774, -0.012654, -0.012249, -0.015012, -0.023360, -0.033232, -0.033337, -0.035617, -0.036498, -0.036903, -0.034839, -0.038639, -0.042277, -0.047508, -0.046177, -0.044520, -0.039145, -0.031520, -0.028157
#*# 	  -0.058441, -0.059361, -0.051646, -0.044065, -0.035525, -0.029478, -0.030926, -0.032587, -0.032577, -0.035177, -0.026185, -0.021590, -0.016919, -0.016921, -0.020353, -0.019931, -0.021413, -0.020476, -0.026349, -0.033026, -0.039486, -0.045296, -0.049283, -0.044325, -0.044013, -0.044463, -0.042040, -0.039076, -0.020642, -0.008136
#*# 	  -0.067695, -0.067657, -0.044934, -0.040205, -0.030571, -0.026243, -0.030945, -0.030351, -0.031370, -0.031507, -0.029370, -0.031699, -0.031048, -0.028208, -0.023368, -0.017286, -0.017178, -0.016859, -0.017024, -0.026675, -0.029933, -0.035335, -0.037860, -0.039896, -0.049226, -0.045826, -0.044621, -0.034262, -0.021049, -0.011113
#*# 	  -0.051583, -0.052481, -0.050001, -0.040955, -0.033391, -0.028838, -0.025321, -0.026219, -0.026409, -0.026465, -0.024519, -0.023916, -0.024188, -0.023899, -0.023627, -0.020764, -0.017615, -0.017105, -0.016065, -0.017797, -0.016873, -0.020396, -0.020856, -0.024254, -0.027590, -0.033345, -0.032624, -0.028805, -0.012604, -0.005842
#*# 	  -0.025821, -0.035777, -0.032667, -0.027608, -0.021377, -0.017549, -0.023644, -0.024220, -0.026815, -0.017447, -0.008428, -0.007381, -0.003827, -0.010602, -0.008293, -0.006791, -0.005802, -0.004531, -0.010126, -0.013594, -0.017743, -0.019724, -0.010667, -0.008438, -0.008380, -0.005718, -0.008926, -0.003927, 0.003012, 0.005802
#*# 	  -0.026993, -0.026028, -0.021812, -0.017269, -0.015058, -0.010856, -0.008955, -0.009153, -0.006849, -0.009890, -0.009238, -0.007042, -0.005185, 0.000669, 0.005055, 0.005149, 0.009541, 0.000574, 0.002962, -0.000089, -0.005318, -0.003859, -0.005017, -0.007124, -0.004309, -0.003388, 0.009550, 0.014141, 0.019569, 0.016459
#*# 	  -0.041037, -0.038864, -0.036318, -0.032806, -0.011738, -0.007913, -0.003393, 0.000274, -0.008673, -0.009475, -0.008190, -0.007017, -0.006492, -0.012917, -0.008726, -0.008348, 0.002006, 0.009536, 0.009690, 0.009681, -0.002012, -0.005066, -0.007094, -0.008025, -0.006178, -0.010027, -0.009283, -0.003881, 0.002609, 0.008935
#*# 	  -0.036530, -0.035297, -0.031915, -0.028870, -0.024572, -0.018723, -0.012110, -0.007846, -0.008429, -0.009840, -0.009795, -0.012934, -0.012959, -0.009531, -0.005865, -0.003750, -0.001537, -0.000632, -0.000350, 0.001134, -0.001999, -0.003587, -0.008351, -0.013085, -0.010656, -0.011819, -0.006461, -0.005730, -0.001472, 0.001886
#*# 	  -0.024276, -0.023380, -0.028486, -0.024227, -0.019633, -0.014646, -0.009897, -0.012906, -0.012932, -0.012932, -0.010656, -0.003969, 0.004949, 0.002183, 0.005618, 0.002105, 0.004219, 0.005387, 0.003279, 0.001949, -0.007856, -0.006151, -0.004774, -0.001684, 0.005050, 0.005052, 0.005058, 0.005020, 0.002922, 0.005445
#*# 	  -0.029647, -0.028602, -0.026038, -0.019746, -0.017467, -0.010726, -0.006540, -0.004297, -0.003603, -0.002980, -0.003340, -0.001678, 0.000581, 0.001288, 0.004656, 0.003021, 0.004412, 0.005054, 0.005041, 0.002577, 0.000096, 0.001481, 0.001986, 0.002680, 0.005372, 0.006513, 0.005684, 0.005429, 0.002355, 0.004471
#*# 	  -0.029251, -0.028876, -0.030946, -0.026449, -0.019303, -0.010471, 0.000414, 0.002577, 0.002685, 0.002790, -0.002065, -0.001961, -0.001041, -0.000105, 0.000761, -0.002415, 0.000581, 0.002828, 0.005556, 0.009625, 0.006913, 0.006470, 0.002008, 0.003470, 0.004179, 0.004687, 0.003164, 0.000620, 0.004761, 0.006239
#*# 	  -0.030242, -0.030851, -0.026635, -0.021247, -0.012929, -0.010112, -0.006258, -0.005068, -0.006309, -0.004131, -0.003018, -0.000933, -0.000369, -0.001489, -0.000196, 0.002720, 0.004996, 0.009552, 0.007284, 0.006873, 0.004906, 0.000254, 0.000157, 0.003287, 0.004673, 0.005508, 0.004587, 0.007097, 0.009335, 0.015565
#*# 	  -0.024220, -0.017466, -0.015961, -0.012654, -0.010508, -0.004087, -0.001336, 0.001495, 0.001039, -0.003999, -0.002091, -0.001397, -0.003895, 0.009541, 0.009541, 0.011256, 0.013930, 0.010492, 0.012695, 0.011889, 0.011122, 0.010217, 0.007668, 0.008910, 0.008023, 0.012578, 0.015779, 0.014813, 0.018766, 0.023290
#*# 	  -0.017892, -0.020016, -0.018033, -0.012947, -0.005560, -0.000145, 0.003652, 0.005317, 0.005134, 0.006596, 0.006928, 0.007633, 0.007725, 0.006046, 0.008134, 0.008267, 0.010801, 0.014352, 0.017528, 0.014763, 0.014746, 0.015023, 0.018891, 0.019442, 0.020298, 0.019202, 0.014583, 0.014160, 0.020563, 0.025319
#*# 	  -0.018049, -0.019941, -0.018551, -0.014635, -0.013395, -0.006135, -0.004195, 0.002945, 0.009599, 0.010182, 0.009648, 0.005119, 0.005964, 0.004763, 0.004967, 0.006335, 0.009539, 0.007956, 0.009049, 0.009532, 0.012826, 0.017076, 0.016099, 0.018473, 0.014021, 0.014156, 0.015314, 0.016287, 0.020442, 0.022776
#*# 	  -0.019750, -0.023036, -0.021974, -0.017123, -0.011529, -0.004475, -0.000261, 0.001844, 0.001703, 0.002013, 0.003691, 0.003651, 0.002618, 0.002649, 0.002950, 0.006177, 0.008079, 0.009868, 0.010268, 0.009716, 0.010671, 0.009505, 0.009386, 0.009519, 0.009560, 0.009582, 0.009480, 0.011383, 0.019505, 0.020928
#*# 	  -0.013323, -0.015407, -0.011376, -0.003383, 0.002826, 0.009087, 0.007317, 0.009360, 0.010492, 0.010498, 0.012546, 0.007677, 0.007310, 0.007939, 0.012749, 0.018486, 0.020320, 0.023494, 0.024602, 0.019125, 0.018477, 0.017405, 0.016487, 0.016142, 0.013367, 0.014011, 0.014012, 0.018439, 0.024621, 0.031442
#*# 	  0.009923, 0.003553, 0.002387, 0.003194, 0.009462, 0.013662, 0.018970, 0.020397, 0.018486, 0.021296, 0.022828, 0.022622, 0.023125, 0.024488, 0.023518, 0.026442, 0.028508, 0.030181, 0.030659, 0.029771, 0.027408, 0.027383, 0.027391, 0.027409, 0.026217, 0.026829, 0.026126, 0.026477, 0.035873, 0.038747
#*# 	  0.010504, 0.000309, -0.002195, 0.000610, 0.007458, 0.012773, 0.011898, 0.013862, 0.014020, 0.019684, 0.025107, 0.027388, 0.026281, 0.020354, 0.020867, 0.022291, 0.025537, 0.026540, 0.022902, 0.022592, 0.019875, 0.018488, 0.022594, 0.024585, 0.024609, 0.027242, 0.023477, 0.027190, 0.030094, 0.035764
#*# 	  -0.008614, -0.013169, -0.013638, -0.009832, -0.001675, 0.004839, 0.009542, 0.011158, 0.010343, 0.010234, 0.012900, 0.012513, 0.011844, 0.009432, 0.008805, 0.008816, 0.013441, 0.014629, 0.018062, 0.015124, 0.014115, 0.014023, 0.013729, 0.014302, 0.015788, 0.014102, 0.015261, 0.018639, 0.024533, 0.024558
#*# 	  -0.013014, -0.015370, -0.017522, -0.013493, -0.005860, 0.003483, 0.006948, 0.010101, 0.007372, 0.007407, 0.009027, 0.007890, 0.006937, -0.000099, -0.001303, -0.000555, 0.004640, 0.010678, 0.011736, 0.009763, 0.010017, 0.008611, 0.009163, 0.008509, 0.009476, 0.010435, 0.009301, 0.013976, 0.017147, 0.021242
#*# 	  -0.007692, -0.015150, -0.014921, -0.011584, -0.005047, 0.000150, 0.000445, 0.000756, 0.004682, 0.007046, 0.010986, 0.010475, 0.007299, 0.002864, 0.000473, -0.000022, 0.002944, 0.004961, 0.006342, 0.006270, 0.007374, 0.006874, 0.006772, 0.008419, 0.009890, 0.010250, 0.010790, 0.013722, 0.016376, 0.018873
#*# 	  -0.007093, -0.011029, -0.011266, -0.010935, -0.004058, 0.002247, 0.005200, 0.006566, 0.004494, 0.005090, 0.005070, 0.009559, 0.010373, 0.009542, 0.005116, 0.001450, 0.002681, 0.005608, 0.007737, 0.009575, 0.004213, 0.004418, 0.005003, 0.005019, 0.010001, 0.011811, 0.010075, 0.012872, 0.014006, 0.016419
#*# 	  -0.024108, -0.026520, -0.020584, -0.013983, -0.010214, -0.001687, 0.000423, 0.004830, 0.005118, 0.005928, 0.007327, 0.003411, 0.000068, -0.004102, -0.005577, -0.001670, 0.000566, 0.002731, 0.006712, 0.007289, 0.004903, 0.002543, 0.001280, 0.000039, 0.000504, 0.003145, 0.001094, 0.004493, 0.006721, 0.005055
#*# 	  -0.021832, -0.022813, -0.026495, -0.022250, -0.017173, -0.011323, 0.002215, 0.005084, 0.006928, 0.005860, 0.004443, 0.004960, 0.001748, -0.002371, -0.005749, -0.008416, -0.004341, -0.001186, 0.002885, 0.005794, 0.001953, 0.000929, -0.003900, -0.006085, -0.004973, -0.004050, -0.004102, -0.005123, -0.006155, -0.006183
#*# 	  -0.019581, -0.020056, -0.018920, -0.018760, -0.017449, -0.013168, -0.008683, 0.000160, 0.005428, 0.005835, 0.006719, 0.006656, 0.000337, -0.003758, -0.005224, -0.005641, -0.002718, -0.003779, -0.000346, 0.000583, 0.001534, 0.001919, -0.003148, -0.005116, -0.006284, -0.006206, -0.007130, -0.008385, -0.009138, -0.010611
#*# 	  -0.008227, 0.000189, -0.001404, -0.002313, -0.005346, 0.000368, 0.002464, 0.004993, 0.005562, 0.003425, 0.004868, 0.003515, 0.000579, 0.003079, 0.005404, 0.005065, 0.005056, 0.004060, 0.004968, 0.007864, 0.007192, 0.006920, 0.000552, -0.001511, -0.002370, -0.002948, -0.003788, -0.007325, -0.008778, -0.009548
#*# 	  -0.002630, 0.000874, 0.001692, -0.001662, -0.004052, -0.000190, 0.003764, 0.004232, 0.004130, 0.000127, 0.000219, 0.000147, -0.000932, 0.002511, 0.005094, 0.001587, 0.001155, -0.000931, 0.001174, 0.000520, 0.001539, 0.002526, 0.000249, -0.004468, -0.009357, -0.010724, -0.015186, -0.017762, -0.018754, -0.020089
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
