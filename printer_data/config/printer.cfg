[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR6
[stepper_z]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z1 Stepper - Rear Left on MOTOR7
[stepper_z1]
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PE5, PD12

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


# moved to printer_toolhead.cfg
# [fan_generic exhaust_fan]
# #	Exhaust fan - CNC_FAN3
# pin: PD13
# max_power: 1.0
# shutdown_speed: 0.0
# kick_start_time: 5.0

[output_pin BedFans]
pin: PA8
value: 0
shutdown_value: 0


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.090
#*#
#*# [scanner model default]
#*# model_coef = 1.6588647126678362,
#*# 	2.0004829515476654,
#*# 	0.7350795215058282,
#*# 	0.20380708510522336,
#*# 	0.3168381346012792,
#*# 	0.5607172180139202,
#*# 	-0.3143586853463206,
#*# 	-0.6269530557222125,
#*# 	0.25412227188693154,
#*# 	0.3139595203570721
#*# model_domain = 3.308654370421217e-07,3.352592039626041e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 32.884110
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.059412, -0.046896, -0.041208, -0.027590, -0.015731, -0.012829, -0.008327, -0.004462, -0.002658, 0.015566, 0.019579, 0.023634, 0.027517, 0.030564, 0.022674, 0.018355, 0.017382, 0.014781, 0.001521, -0.003695, -0.013244, -0.023026, -0.021263, -0.029292, -0.031616, -0.036878, -0.044584, -0.054356, -0.068296, -0.097875
#*# 	  -0.030247, -0.028016, -0.022997, -0.006802, 0.003943, 0.011968, 0.017910, 0.020770, 0.008708, 0.009530, 0.014633, 0.020172, 0.036848, 0.040808, 0.036995, 0.031411, 0.032345, 0.031432, 0.027304, 0.022337, -0.002360, -0.009693, -0.017561, -0.022386, -0.022743, -0.011651, -0.012046, -0.010773, -0.007689, -0.023844
#*# 	  -0.037016, -0.015909, -0.019784, -0.011074, -0.002576, 0.006207, 0.001571, 0.006170, 0.005550, 0.006632, 0.031240, 0.038095, 0.044440, 0.050699, 0.035478, 0.028674, 0.023644, 0.020791, 0.020840, 0.005551, -0.000885, -0.006016, -0.012876, 0.002329, 0.002296, 0.002076, 0.005953, -0.000065, 0.008465, 0.014055
#*# 	  -0.034492, -0.033391, -0.017513, -0.007696, -0.000773, 0.007496, 0.012191, -0.000472, -0.000693, -0.000001, 0.004507, 0.018476, 0.025356, 0.028200, 0.023286, 0.025330, 0.023539, 0.022341, 0.020673, 0.001601, -0.004455, -0.010145, -0.014172, -0.017642, -0.008067, -0.008292, -0.007285, -0.002216, 0.021202, 0.005437
#*# 	  -0.049126, -0.027198, -0.021594, -0.022413, -0.012480, -0.004827, -0.001034, -0.009835, -0.010286, -0.008540, -0.004609, 0.020251, 0.025287, 0.026662, 0.022976, 0.011723, 0.010367, 0.010614, 0.010960, 0.008540, -0.008145, -0.013040, -0.017649, -0.017592, 0.002144, 0.002144, 0.001604, 0.005597, 0.007817, 0.015023
#*# 	  -0.034585, -0.026953, -0.020652, -0.011192, -0.003122, 0.002424, -0.008434, -0.008052, -0.008202, -0.008240, 0.003118, 0.007633, 0.009479, 0.013258, 0.021858, 0.020604, 0.020924, 0.020982, 0.005983, 0.002847, 0.000556, -0.005376, -0.009577, -0.001314, 0.000718, 0.001200, 0.002388, 0.017955, 0.027724, 0.013583
#*# 	  -0.012247, -0.012765, -0.006264, 0.001378, -0.002513, 0.001870, 0.005344, 0.006440, -0.003269, -0.003551, 0.001191, 0.001927, 0.025921, 0.029384, 0.030137, 0.030258, 0.021087, 0.024556, 0.023556, 0.020127, 0.014012, 0.001527, 0.001284, 0.001522, 0.003931, 0.021954, 0.025330, 0.029890, 0.035967, 0.033034
#*# 	  -0.018083, -0.009244, -0.007447, -0.000824, 0.007121, -0.000889, 0.000923, 0.003766, 0.003996, 0.013123, 0.015064, 0.018843, 0.022513, 0.030751, 0.031238, 0.031580, 0.036960, 0.020877, 0.022998, 0.018547, 0.012684, 0.010330, 0.016155, 0.017458, 0.020019, 0.020789, 0.034859, 0.040258, 0.048958, 0.047883
#*# 	  -0.015525, -0.015356, -0.012258, -0.007753, -0.000572, -0.004044, -0.000644, 0.002205, 0.005685, 0.000209, 0.001528, 0.004096, 0.005966, 0.026238, 0.027125, 0.027400, 0.030138, 0.023123, 0.020697, 0.016928, 0.013881, 0.004592, 0.003918, 0.004036, 0.006299, 0.008711, 0.025330, 0.028013, 0.031691, 0.028000
#*# 	  -0.034143, -0.027214, -0.024877, -0.020067, -0.023997, -0.018230, -0.013302, -0.010157, -0.002358, 0.002543, 0.006883, 0.007696, 0.012265, 0.015840, 0.016983, 0.020602, 0.015517, 0.009372, 0.006341, 0.004726, 0.001608, 0.006666, 0.005403, 0.008167, 0.009467, 0.017316, 0.017614, 0.020606, 0.026023, 0.022639
#*# 	  -0.021735, -0.021726, -0.017823, -0.013017, -0.008103, -0.002670, -0.008173, -0.003119, -0.000104, 0.004103, -0.000548, -0.000780, -0.000161, 0.001532, 0.020504, 0.022488, 0.025318, 0.025498, 0.017218, 0.013537, 0.009024, 0.008447, 0.001529, 0.004826, 0.005927, 0.005965, 0.005554, 0.020564, 0.022089, 0.010661
#*# 	  -0.036375, -0.026896, -0.021745, -0.023690, -0.018271, -0.014586, -0.009892, -0.003246, 0.000119, 0.002882, 0.003483, 0.011081, 0.011652, 0.013450, 0.016344, 0.014044, 0.012684, 0.012563, 0.012296, 0.010441, 0.010661, 0.010328, 0.010653, 0.012025, 0.020692, 0.022387, 0.020966, 0.022270, 0.010079, 0.025163
#*# 	  -0.025215, -0.037672, -0.020120, -0.015374, -0.008494, -0.003355, -0.000333, -0.003386, -0.001967, 0.000681, 0.001926, -0.003263, -0.002464, 0.000995, 0.001732, 0.018008, 0.020895, 0.022339, 0.021377, 0.012026, 0.011481, 0.010325, 0.010524, 0.006007, 0.006301, 0.006371, 0.006301, 0.008843, 0.020580, 0.012927
#*# 	  -0.036992, -0.030122, -0.032973, -0.025143, -0.020085, -0.014662, -0.006840, -0.005333, -0.003270, -0.001014, 0.006159, 0.006494, 0.007320, 0.008083, 0.006926, 0.005406, 0.008834, 0.009827, 0.007676, 0.011418, 0.010916, 0.010378, 0.010594, 0.017231, 0.016341, 0.017535, 0.017526, 0.006300, 0.008687, 0.021757
#*# 	  -0.022487, -0.036988, -0.033986, -0.013763, -0.008165, -0.001769, 0.002197, 0.003519, 0.000785, 0.002475, 0.004476, 0.006147, 0.000883, 0.001191, 0.004707, 0.006156, 0.018113, 0.020952, 0.020964, 0.020755, 0.014793, 0.013402, 0.015020, 0.016078, 0.010949, 0.009994, 0.007552, 0.010405, 0.013955, 0.016532
#*# 	  -0.028825, -0.029332, -0.028003, -0.020414, -0.013447, -0.004033, -0.001000, 0.001464, 0.003925, 0.007192, 0.011150, 0.011075, 0.009880, 0.008644, 0.008696, 0.010379, 0.010317, 0.013752, 0.019077, 0.019225, 0.017725, 0.016627, 0.022511, 0.024138, 0.022710, 0.021185, 0.011127, 0.011107, 0.018189, 0.026828
#*# 	  -0.030965, -0.037299, -0.034186, -0.029442, -0.008509, -0.003272, 0.003169, 0.006261, 0.006922, 0.002952, 0.004508, 0.003930, 0.004566, 0.000345, 0.000256, 0.001558, 0.005696, 0.016818, 0.020896, 0.020888, 0.018226, 0.013386, 0.013790, 0.013885, 0.014101, 0.009975, 0.008737, 0.011079, 0.016024, 0.018870
#*# 	  -0.032152, -0.034213, -0.032680, -0.027444, -0.018507, -0.010556, -0.007318, -0.003364, -0.001016, 0.001643, 0.003211, 0.003122, 0.002324, -0.000629, 0.000768, 0.002534, 0.005579, 0.009390, 0.012718, 0.011895, 0.012245, 0.011491, 0.011771, 0.011799, 0.013282, 0.006073, 0.004204, 0.005493, 0.009955, 0.017830
#*# 	  -0.018218, -0.027699, -0.027451, -0.019809, -0.012789, 0.003455, 0.010516, 0.011373, 0.012815, 0.014547, 0.010815, 0.011080, 0.011868, 0.011153, 0.008778, 0.011066, 0.013628, 0.015219, 0.025405, 0.025335, 0.022363, 0.021228, 0.017496, 0.018038, 0.017435, 0.016223, 0.014144, 0.014052, 0.020444, 0.022917
#*# 	  -0.003433, -0.008071, -0.008156, -0.003879, 0.001942, 0.007942, 0.011923, 0.016625, 0.018226, 0.020639, 0.021621, 0.022956, 0.021556, 0.023621, 0.024684, 0.025219, 0.029890, 0.031638, 0.032356, 0.031679, 0.030510, 0.030359, 0.030211, 0.030824, 0.023754, 0.023971, 0.023744, 0.025325, 0.032179, 0.038016
#*# 	  -0.005532, -0.010986, -0.017649, -0.012542, -0.007453, 0.001535, 0.015740, 0.017300, 0.020575, 0.020971, 0.019426, 0.019908, 0.020186, 0.020490, 0.015702, 0.017646, 0.020562, 0.021818, 0.024577, 0.031152, 0.027181, 0.025522, 0.025483, 0.021327, 0.022001, 0.021962, 0.021173, 0.020673, 0.029160, 0.035576
#*# 	  -0.016792, -0.020834, -0.022122, -0.018233, -0.010352, -0.005351, -0.000867, 0.001571, 0.003655, 0.006938, 0.009275, 0.008830, 0.009794, 0.009092, 0.008699, 0.009299, 0.011545, 0.015035, 0.016291, 0.015980, 0.013405, 0.012757, 0.013436, 0.009372, 0.010559, 0.009642, 0.009515, 0.009674, 0.018570, 0.018789
#*# 	  -0.018478, -0.022571, -0.024822, -0.023986, -0.018822, -0.012766, -0.008371, 0.003834, 0.005588, 0.007089, 0.008302, 0.004450, 0.005603, 0.002372, 0.000336, -0.000775, 0.001229, 0.005471, 0.006261, 0.006141, 0.011114, 0.011057, 0.008611, 0.010849, 0.008071, 0.009798, 0.009370, 0.009311, 0.014083, 0.018199
#*# 	  -0.023689, -0.027393, -0.026696, -0.023084, -0.016210, -0.009620, -0.004759, -0.003087, -0.000422, 0.001537, 0.002874, 0.003070, 0.003229, 0.000596, -0.000010, 0.000356, 0.001858, 0.004597, 0.006920, 0.007051, 0.006320, 0.006306, 0.005326, 0.005335, 0.006206, 0.008689, 0.009292, 0.010473, 0.013432, 0.014597
#*# 	  -0.029123, -0.028773, -0.027010, -0.020688, -0.017590, -0.008842, -0.004838, -0.002957, 0.007952, 0.011070, 0.011410, 0.011968, 0.006164, 0.002362, -0.000046, 0.001007, 0.000893, 0.004613, 0.006133, 0.005965, 0.004457, 0.008297, 0.007839, 0.007438, 0.011085, 0.010908, 0.010898, 0.011791, 0.014643, 0.013752
#*# 	  -0.033184, -0.034284, -0.032624, -0.025171, -0.017571, -0.011131, -0.007191, -0.002824, 0.001509, 0.006225, 0.007505, 0.007521, 0.003916, 0.000739, -0.000664, -0.000289, 0.002347, 0.006087, 0.008689, 0.010302, 0.006371, 0.004453, 0.001529, 0.001486, 0.003920, 0.005411, 0.006049, 0.004162, 0.004532, 0.001419
#*# 	  -0.037776, -0.035985, -0.032568, -0.027451, -0.019815, -0.014852, -0.009559, -0.005628, -0.003936, 0.006300, 0.007291, 0.008313, 0.006452, -0.000860, -0.001975, -0.001356, 0.000662, 0.001747, 0.005851, 0.005887, 0.001527, 0.001080, 0.001612, -0.001018, 0.001519, 0.001605, -0.001265, -0.004159, -0.004945, -0.006853
#*# 	  -0.032146, -0.029414, -0.028357, -0.027039, -0.020420, -0.014658, -0.008051, -0.005114, 0.001639, 0.003871, 0.006318, 0.007049, 0.003640, 0.000833, 0.000642, 0.000851, 0.003256, 0.006543, 0.010971, 0.011224, 0.010990, 0.007680, 0.002797, 0.000930, 0.001359, 0.001199, -0.002861, -0.004983, -0.007378, -0.011413
#*# 	  -0.018007, -0.008133, -0.012161, -0.011829, -0.008441, -0.001970, -0.003211, 0.001547, 0.004472, 0.006612, 0.015833, 0.015949, 0.016204, 0.015835, 0.011335, 0.011075, 0.013460, 0.015500, 0.015981, 0.017625, 0.018402, 0.018205, 0.013471, 0.011224, 0.009285, 0.007895, 0.002722, -0.002893, -0.003684, -0.009822
#*# 	  -0.008675, -0.005737, -0.005860, -0.009647, -0.004646, -0.000576, 0.001547, 0.011227, 0.012663, 0.015808, 0.016426, 0.013875, 0.015807, 0.015068, 0.014023, 0.013459, 0.013475, 0.014996, 0.015823, 0.017066, 0.018390, 0.018958, 0.016513, 0.011247, 0.006595, 0.001481, -0.005017, -0.009008, -0.011035, -0.015256
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
