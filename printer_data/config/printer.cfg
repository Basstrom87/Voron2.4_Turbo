[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 300
max_accel: 10000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: zv
#shaper_type_x: 56
#shaper_type_y: mzv
#shaper_freq_y: 40.4

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.170
#*#
#*# [scanner model default]
#*# model_coef = 1.6515713098967568,
#*# 	1.9885357572322888,
#*# 	0.7187313893945685,
#*# 	0.19164399108706373,
#*# 	0.3659472061943571,
#*# 	0.7017235797535931,
#*# 	-0.3481099719192544,
#*# 	-0.8804481383950366,
#*# 	0.2631193459639314,
#*# 	0.45218815282783953
#*# model_domain = 3.3020111401827494e-07,3.3508802221553266e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 25.042367
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.034732, -0.037402, -0.037388, -0.034884, -0.034515, -0.033376, -0.033438, -0.032368, -0.034876, -0.035049, -0.034366, -0.033478, -0.023083, -0.030833, -0.030414, -0.038381, -0.042111, -0.021331, 0.003720, -0.002964, -0.038422, -0.042828, -0.042133, -0.042099, -0.042612, -0.040559, -0.034949, -0.029352, -0.021691, -0.023818
#*# 	  -0.038084, -0.038675, -0.038367, -0.036568, -0.036309, -0.034114, -0.033816, -0.033570, -0.034206, -0.035671, -0.034224, -0.029287, -0.022613, -0.017801, -0.021292, -0.032544, -0.033764, -0.005985, 0.004505, 0.004173, -0.027372, -0.039210, -0.037108, -0.037866, -0.038250, -0.036461, -0.033236, -0.025870, -0.018181, -0.019653
#*# 	  -0.038297, -0.043833, -0.046872, -0.040818, -0.040019, -0.038258, -0.037968, -0.036212, -0.034063, -0.037034, -0.038621, -0.031758, -0.027528, -0.019795, -0.026501, -0.034046, -0.032475, -0.001241, -0.001166, 0.002535, -0.021764, -0.038397, -0.038723, -0.039247, -0.037741, -0.036761, -0.031423, -0.025285, -0.017013, -0.019139
#*# 	  -0.044117, -0.046607, -0.045331, -0.042696, -0.040931, -0.038403, -0.036972, -0.037809, -0.038558, -0.039941, -0.038331, -0.034208, -0.033101, -0.030818, -0.032877, -0.037871, -0.033554, 0.001471, 0.006808, 0.003307, -0.012702, -0.038288, -0.038313, -0.037872, -0.036563, -0.034337, -0.029324, -0.023669, -0.016122, -0.017644
#*# 	  -0.045296, -0.049128, -0.045775, -0.041052, -0.040177, -0.037072, -0.036505, -0.032245, -0.038391, -0.042741, -0.039500, -0.036494, -0.037315, -0.038953, -0.040384, -0.042872, -0.031693, 0.004399, 0.003246, -0.000177, -0.009408, -0.037326, -0.039525, -0.036383, -0.035132, -0.032529, -0.026509, -0.021016, -0.014261, -0.014054
#*# 	  -0.042150, -0.043020, -0.042671, -0.038972, -0.038209, -0.034321, -0.034084, -0.036406, -0.038302, -0.038543, -0.038400, -0.037544, -0.038378, -0.041314, -0.042677, -0.042875, -0.027533, 0.008617, -0.003390, -0.008621, -0.006978, -0.034444, -0.038389, -0.033561, -0.031845, -0.029855, -0.023391, -0.015035, -0.008726, -0.008499
#*# 	  -0.044804, -0.042557, -0.040967, -0.038392, -0.035597, -0.034234, -0.029944, -0.036165, -0.042159, -0.038913, -0.037309, -0.035809, -0.039943, -0.040787, -0.041429, -0.043938, -0.024813, 0.007622, -0.009192, -0.017599, -0.008644, -0.032205, -0.033216, -0.033599, -0.030234, -0.025533, -0.018040, -0.008347, 0.000777, 0.001791
#*# 	  -0.042468, -0.042597, -0.041831, -0.039027, -0.038518, -0.037736, -0.038254, -0.037845, -0.038391, -0.038374, -0.036958, -0.033561, -0.037432, -0.040694, -0.042662, -0.042705, -0.024524, 0.010349, -0.010790, -0.020904, -0.009425, -0.024925, -0.031624, -0.029920, -0.025159, -0.020205, -0.010172, 0.001289, 0.005109, 0.005634
#*# 	  -0.042392, -0.043764, -0.040896, -0.040348, -0.040714, -0.037302, -0.038453, -0.042692, -0.038387, -0.036746, -0.035735, -0.035728, -0.037891, -0.039716, -0.039493, -0.038904, -0.013608, 0.013362, -0.009954, -0.020343, -0.006095, -0.015043, -0.021128, -0.021393, -0.018302, -0.018022, -0.015960, -0.010797, -0.002530, 0.006474
#*# 	  -0.040641, -0.040654, -0.040120, -0.039012, -0.038455, -0.038285, -0.038372, -0.036351, -0.036530, -0.034398, -0.033006, -0.031547, -0.035223, -0.035436, -0.035030, -0.031551, -0.002302, 0.016165, -0.015913, -0.015923, 0.008222, -0.010718, -0.023577, -0.026084, -0.021287, -0.012680, -0.006650, -0.004103, -0.000407, 0.004787
#*# 	  -0.035885, -0.037385, -0.035820, -0.034096, -0.029791, -0.032936, -0.035178, -0.032470, -0.030353, -0.028718, -0.028011, -0.027231, -0.025474, -0.031469, -0.030041, -0.020690, 0.007911, 0.023203, -0.012828, 0.001092, 0.014735, -0.000493, -0.010153, -0.013164, -0.011706, -0.007317, -0.001918, 0.004419, 0.008309, 0.007158
#*# 	  -0.032611, -0.033067, -0.031680, -0.031338, -0.029791, -0.028112, -0.027511, -0.026485, -0.027356, -0.025550, -0.025550, -0.025548, -0.027224, -0.026374, -0.020251, -0.010621, 0.011149, 0.030090, 0.016917, 0.014171, 0.000678, 0.000028, -0.006110, -0.005206, -0.003237, -0.000645, 0.003172, 0.008953, 0.012267, 0.008461
#*# 	  -0.029655, -0.031718, -0.031597, -0.028668, -0.027215, -0.024567, -0.024473, -0.024087, -0.020897, -0.024321, -0.025847, -0.021065, -0.026611, -0.025342, -0.011356, -0.006157, 0.015372, 0.037173, 0.019923, 0.005306, 0.002204, 0.001523, -0.000376, -0.001851, 0.000575, 0.000087, 0.003165, 0.004920, 0.008375, 0.004331
#*# 	  -0.029571, -0.030573, -0.029786, -0.026150, -0.025535, -0.022207, -0.021681, -0.021279, -0.020983, -0.020711, -0.017075, -0.015418, -0.021544, -0.017040, -0.004238, 0.005253, 0.024758, 0.042995, 0.028382, 0.016847, 0.014243, 0.004715, -0.002223, -0.004864, -0.008586, -0.010739, -0.008528, -0.000913, 0.005800, 0.005566
#*# 	  -0.026587, -0.025558, -0.024930, -0.024739, -0.017009, -0.016079, -0.017798, -0.012511, -0.014885, -0.013713, -0.006519, -0.009030, -0.008390, -0.006102, 0.007164, 0.013688, 0.038062, 0.048358, 0.037799, 0.023072, 0.006503, -0.006491, -0.005588, -0.004270, -0.001069, 0.003522, 0.008911, 0.013957, 0.017439, 0.013157
#*# 	  -0.021159, -0.021197, -0.019077, -0.017328, -0.015740, -0.012679, -0.011722, -0.011721, -0.012730, -0.008225, -0.004254, 0.012462, 0.003053, 0.008441, 0.012652, 0.012761, 0.044026, 0.046154, 0.049261, 0.022757, 0.014216, 0.014658, 0.015983, 0.018946, 0.020626, 0.019852, 0.021049, 0.022942, 0.023312, 0.016155
#*# 	  -0.022947, -0.022319, -0.019649, -0.020900, -0.014276, -0.011354, -0.008452, -0.010721, -0.013179, -0.008980, 0.000558, 0.011706, 0.010444, 0.006014, 0.016619, 0.016385, 0.030447, 0.037187, 0.046069, 0.034878, 0.027290, 0.021550, 0.022869, 0.024708, 0.021014, 0.020909, 0.021061, 0.021053, 0.020932, 0.016017
#*# 	  -0.020429, -0.021775, -0.016744, -0.015719, -0.012741, -0.008628, -0.008783, -0.007247, -0.010686, -0.008222, 0.000176, 0.005821, 0.012658, 0.010997, 0.014679, 0.036703, 0.044401, 0.048212, 0.043011, 0.046831, 0.035660, 0.025377, 0.020455, 0.021048, 0.021181, 0.021016, 0.020377, 0.019231, 0.020012, 0.015973
#*# 	  -0.019055, -0.018698, -0.012885, -0.014354, -0.012349, -0.004116, -0.006315, -0.009561, -0.010535, -0.009345, 0.004539, 0.030076, 0.012474, -0.001731, 0.041160, 0.010266, 0.038144, 0.056477, 0.043036, 0.059017, 0.045601, 0.029643, 0.016888, 0.016764, 0.018408, 0.017070, 0.016888, 0.012846, 0.013749, 0.015964
#*# 	  -0.016199, -0.014941, -0.016993, -0.008453, -0.006744, -0.004535, -0.001879, -0.004248, -0.002223, 0.002845, 0.024740, 0.031533, 0.041826, 0.020000, 0.046557, 0.043816, 0.036814, 0.065054, 0.041991, 0.053704, 0.058306, 0.025683, 0.007656, 0.004477, 0.008388, 0.007572, 0.008387, 0.012532, 0.021063, 0.019828
#*# 	  -0.012738, -0.007488, -0.010468, -0.008931, -0.000283, -0.001009, -0.000542, 0.001044, 0.002382, 0.025052, 0.008082, 0.025292, 0.041887, 0.040889, 0.043346, 0.047999, 0.022791, 0.055587, 0.058051, 0.025796, 0.053316, 0.026072, -0.000178, 0.002185, 0.003630, 0.004461, 0.007899, 0.012589, 0.016907, 0.016732
#*# 	  -0.006679, -0.006695, -0.005413, -0.003183, 0.002015, 0.005038, 0.003799, 0.006585, 0.006746, 0.023225, 0.050460, 0.057823, 0.039436, 0.034142, 0.021435, 0.047671, 0.032542, 0.045266, 0.069370, 0.047955, 0.025259, 0.036604, 0.010518, 0.003715, 0.004111, 0.005943, 0.006354, 0.010987, 0.016839, 0.016488
#*# 	  -0.003601, -0.003706, -0.004676, 0.003403, 0.002993, 0.004218, 0.010218, 0.009671, 0.012636, 0.024407, 0.059641, 0.056799, 0.027460, 0.031839, 0.018914, 0.016438, 0.021785, 0.015023, 0.043067, 0.064643, 0.045362, 0.046518, 0.030180, 0.004184, 0.004505, 0.004456, 0.003745, 0.008656, 0.015213, 0.013918
#*# 	  -0.005598, -0.004016, -0.000632, 0.001613, 0.005493, 0.013450, 0.010214, 0.006295, 0.009215, 0.013735, 0.056258, 0.052927, -0.000040, 0.014465, 0.018860, 0.008434, 0.006766, 0.007964, 0.015434, 0.042843, 0.053406, 0.034618, 0.012427, 0.002073, 0.000105, 0.000471, 0.004227, 0.004485, 0.012326, 0.010948
#*# 	  -0.004995, -0.004390, 0.001995, 0.006533, 0.009997, 0.013687, 0.014643, 0.018816, 0.014345, 0.013174, 0.046132, 0.058166, 0.017960, 0.005340, 0.005456, 0.009208, 0.007820, 0.007633, 0.010729, 0.013953, 0.013295, 0.006303, 0.003494, 0.004197, -0.002293, -0.004193, 0.002120, 0.003700, 0.016597, 0.008391
#*# 	  -0.004270, 0.003571, 0.007208, 0.014441, 0.014715, 0.018473, 0.022739, 0.019316, 0.016824, 0.019963, 0.042680, 0.066942, 0.035353, 0.008163, 0.010538, 0.010411, 0.010539, 0.015896, 0.017627, 0.018550, 0.012950, 0.010460, 0.008972, 0.004055, -0.000074, 0.002208, 0.011566, 0.004718, 0.016436, 0.013837
#*# 	  0.003159, 0.009136, 0.013745, 0.018427, 0.022082, 0.026768, 0.030676, 0.029227, 0.025250, 0.029331, 0.037567, 0.065132, 0.054432, 0.017913, 0.018937, 0.017908, 0.017039, 0.023360, 0.023518, 0.023597, 0.020940, 0.018818, 0.016947, 0.011429, 0.006177, 0.008037, 0.019408, 0.010603, 0.011768, 0.020678
#*# 	  0.006608, 0.007396, 0.014926, 0.018200, 0.025874, 0.029843, 0.027325, 0.035587, 0.030969, 0.028403, 0.032980, 0.054847, 0.060865, 0.029462, 0.020946, 0.025349, 0.025211, 0.024791, 0.030102, 0.029358, 0.029425, 0.023459, 0.016872, 0.017694, 0.013654, 0.008090, 0.017819, 0.016129, 0.008430, 0.014547
#*# 	  0.008728, 0.013259, 0.018440, 0.022081, 0.025420, 0.033638, 0.031552, 0.029221, 0.034041, 0.035590, 0.034906, 0.045321, 0.062268, 0.050559, 0.022765, 0.023150, 0.027483, 0.029368, 0.033619, 0.029495, 0.025191, 0.027342, 0.021704, 0.015012, 0.012119, 0.008521, 0.012625, 0.015763, 0.004283, 0.006286
#*# 	  0.008615, 0.009722, 0.009057, 0.021019, 0.021892, 0.024020, 0.029421, 0.032327, 0.037802, 0.033555, 0.029424, 0.036142, 0.051083, 0.049260, 0.027337, 0.024515, 0.029420, 0.027973, 0.025175, 0.030193, 0.025987, 0.023007, 0.020053, 0.015116, 0.009485, 0.002257, -0.001903, 0.004204, 0.001830, -0.000451
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
