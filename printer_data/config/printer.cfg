[include mainsail.cfg]
[include printer_toolhead.cfg]
[include printer_macros.cfg]
[include printer_cartographer.cfg]

#####################################################################
##                   Model and Acceleration
#####################################################################

[printer]
kinematics: corexy
max_velocity: 325
max_accel: 15000
minimum_cruise_ratio: 0.5
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 7.0


#####################################################################
##                      MCU Octopus
#####################################################################

[mcu]
canbus_uuid: 35494ee53508                # CAN bus unique identifier for Octopus MCU.
canbus_interface: can0                   # CAN bus interface.


#####################################################################
##                  Temperature Monitoring
#####################################################################

[temperature_sensor Octopus-Pro]
sensor_type: temperature_mcu             # MCU internal temperature sensor.

[temperature_sensor RPi_4]
sensor_type: temperature_host            # Host system internal temperature sensor.

#####################################################################
#                        B(X) ---------A(Y)
#                        |                |
#                        |                |
#                        |--------E-------|
#                        |                |
#                        |                |
#                        |                |
#####################################################################
##                   X-axis on MOTOR_2_1 (B Motor)
#####################################################################

[stepper_x]
step_pin: PF13                           # X-axis motor pulse pin setting
dir_pin: PF12                           # X-axis motor direction pin setting
enable_pin: !PF14                        # X-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: EBBCan:gpio24               #PG6 # Limit switch pin setting (X-)
position_min: 0                          # X-axis minimum travel - software limit
position_endstop: 302                    # Mechanical reset point coordinates for X-axis
position_max: 302                        # X-axis maximum travel - software limit
homing_speed: 100                       # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_x]
cs_pin: PC4                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)


#####################################################################
##                   Y-axis on MOTOR_0（A Motor）
#####################################################################

[stepper_y]
step_pin: PF11                           # Y-axis motor pulse pin setting
dir_pin: PG3                            # Y-axis motor direction pin setting
enable_pin: !PG5                         # Y-axis motor enable pin setting
microsteps: 32                           # Motor microsteps setting
rotation_distance: 40                    # Active pulley circumference in mm (2GT-20T pulley 40, 2GT-16T pulley 32)
full_steps_per_rotation: 200             # Number of pulses required for a single motor revolution (1.8 degree motor: 200, 0.9 degree motor: 400)
endstop_pin: PG11                        # Limit switch pin setting (Y-)
position_min: 0                          # Y-axis minimum travel - software limit
position_endstop: 313                    # Mechanical reset point coordinates for Y-axis
position_max: 313                        # Y-axis maximum travel - software limit
homing_speed: 100                        # Reset speed - maximum 100
homing_retract_dist: 5                   # Setback distance after the first trigger of the reset switch
homing_positive_dir: true                # Direction of reset (generally no change required)

[tmc2240 stepper_y]
cs_pin: PC6                              # Chip select pin for TMC2240 driver
spi_software_sclk_pin: PA5               # SPI software clock pin
spi_software_mosi_pin: PA7               # SPI software MOSI pin
spi_software_miso_pin: PA6               # SPI software MISO pin
driver_TPFD: 0                           # TMC2240 TPFD setting
run_current: 1.2                         # Motor running current value (A)

####################################################################################
#                          z1 -------------- z2
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                          |                 |
#                         z0---   display ---z3
#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left On MOTOR7
[stepper_z]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 # cartographer needs this to be set to 0
position_max: 280
position_min: -10

[tmc2209 stepper_z]
uart_pin: PD3
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear Left on MOTOR4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF2
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on MOTOR6
[stepper_z2]
step_pin: PE2
dir_pin: PE3
enable_pin: !PD4
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z2]
uart_pin: PE1
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - BED_OUT
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.8
min_temp: 0
max_temp: 120
control: pid
pid_kp: 41.677
pid_ki: 2.105
pid_kd: 206.303

[idle_timeout]
timeout: 1800


#####################################################################
# 	Fan Control
#####################################################################

[multi_pin my_controller_fan_pins]
pins: PD14, PD15

[controller_fan controller_fan]
pin: multi_pin:my_controller_fan_pins
shutdown_speed: 0.0
kick_start_time: 0.5 
fan_speed: 0.5


[fan_generic exhaust_fan]
#	Exhaust fan - CNC_FAN3
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 5.0

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE1 Connector (Optional)
#pin: PA3
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01


#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Use QUAD_GANTRY_LEVEL to level a gantry.
##	Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
gantry_corners:
	-60,-10
	360,370

#	Probe points
points:
	25,10
	25,260
	280,260
	280,10

#--------------------------------------------------------------------
speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

[input_shaper]
#shaper_freq_x: 2hump_ei
#shaper_type_x: 78.4
#shaper_type_y: mzv
#shaper_freq_y: 36.0

[exclude_object]

## 	Thermistor Types
##   "EPCOS 100K B57560G104F"
##   "ATC Semitec 104GT-2"
##   "NTC 100K beta 3950"
##   "Honeywell 100K 135-104LAG-J01"
##   "NTC 100K MGB18-104F39050L32" (Keenovo Heater Pad)
##   "AD595"
##   "PT100 INA826"

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1250
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.140
#*#
#*# [scanner model default]
#*# model_coef = 1.6515713098967568,
#*# 	1.9885357572322888,
#*# 	0.7187313893945685,
#*# 	0.19164399108706373,
#*# 	0.3659472061943571,
#*# 	0.7017235797535931,
#*# 	-0.3481099719192544,
#*# 	-0.8804481383950366,
#*# 	0.2631193459639314,
#*# 	0.45218815282783953
#*# model_domain = 3.3020111401827494e-07,3.3508802221553266e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 25.042367
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 55.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.016841, 0.016928, 0.017127, 0.020497, 0.017381, 0.017780, 0.018750, 0.020525, 0.046224, 0.041828, 0.031231, 0.010008, 0.011501, 0.012952, 0.009638, 0.015144, 0.000340, 0.001252, 0.005168, 0.006429, 0.007657, 0.007686, 0.008570, 0.008603, 0.008299, 0.008567, 0.009044, 0.012719, 0.017101, 0.014258
#*# 	  0.008181, 0.008622, 0.011031, 0.012716, 0.011693, 0.011667, 0.013883, 0.020927, 0.047639, 0.035710, 0.036634, 0.012877, 0.014780, 0.021023, 0.019923, 0.008783, -0.002861, -0.002377, 0.002342, 0.004406, 0.004810, 0.006392, 0.006494, 0.006395, 0.004794, 0.004791, 0.006100, 0.008940, 0.016381, 0.013886
#*# 	  -0.001774, -0.000555, 0.002856, 0.005440, 0.005492, 0.006409, 0.008478, 0.020976, 0.041424, 0.029259, 0.036539, 0.009137, 0.010287, 0.014582, 0.010987, 0.000230, -0.007881, -0.006417, -0.002945, -0.001862, -0.001698, -0.000636, -0.000130, 0.000626, 0.000928, -0.000597, 0.000130, 0.002633, 0.008932, 0.008799
#*# 	  -0.006972, -0.005137, -0.002098, 0.000510, 0.003096, 0.003744, 0.005377, 0.022214, 0.034975, 0.029515, 0.037372, 0.005178, 0.001673, 0.004193, 0.002295, -0.006329, -0.011355, -0.008492, -0.004155, -0.003556, -0.003287, -0.000409, -0.002915, -0.001850, -0.000767, -0.003470, -0.003613, 0.002921, 0.008685, 0.008559
#*# 	  -0.010132, -0.008169, -0.006021, -0.002426, -0.000914, -0.000784, 0.002400, 0.020168, 0.026084, 0.026701, 0.037296, 0.004345, -0.006678, -0.008327, -0.010084, -0.013896, -0.014297, -0.010402, -0.005687, -0.005832, -0.005190, -0.005893, -0.004612, -0.004518, -0.003357, -0.004157, -0.003943, -0.000164, 0.006307, 0.007885
#*# 	  -0.008633, -0.008139, -0.005778, -0.003901, -0.001343, -0.000574, 0.000233, 0.015124, 0.016977, 0.016853, 0.036837, 0.007571, -0.012244, -0.013349, -0.012669, -0.016368, -0.014586, -0.013238, -0.007981, -0.007712, -0.006151, -0.004871, -0.004216, -0.003517, -0.001988, -0.003781, -0.002415, 0.001280, 0.009459, 0.009552
#*# 	  -0.003784, -0.005588, -0.004013, -0.002069, -0.001823, -0.002123, -0.004692, 0.009039, 0.004468, 0.009873, 0.035226, 0.005900, -0.014396, -0.016528, -0.017184, -0.015938, -0.012444, -0.015237, -0.014358, -0.010243, -0.009097, -0.006056, -0.004741, -0.003974, 0.000205, -0.001870, -0.000649, 0.003312, 0.009051, 0.010621
#*# 	  0.000211, -0.000358, -0.003416, -0.002973, -0.001317, -0.003912, -0.007749, -0.000274, -0.005168, 0.009497, 0.033274, 0.003716, -0.016884, -0.020327, -0.019259, -0.018050, -0.017742, -0.019818, -0.016317, -0.015443, -0.011872, -0.010725, -0.008139, -0.003706, -0.001866, -0.000794, 0.001055, 0.002788, 0.011676, 0.008760
#*# 	  -0.020750, -0.015588, -0.007880, -0.003416, 0.000496, 0.001553, -0.008780, -0.008467, -0.012327, 0.004125, 0.029637, 0.006134, -0.018617, -0.022696, -0.025028, -0.023246, -0.024812, -0.022775, -0.018651, -0.016559, -0.012031, -0.011852, -0.010204, -0.004979, -0.001984, 0.001714, 0.001274, 0.004420, 0.009621, 0.008166
#*# 	  -0.020411, -0.016529, -0.012514, -0.012201, -0.008900, -0.005773, -0.011919, -0.008235, -0.014687, -0.003808, 0.026846, 0.010990, -0.018421, -0.023890, -0.024256, -0.024959, -0.024943, -0.021689, -0.017151, -0.015594, -0.012340, -0.010362, -0.007770, -0.004599, 0.000215, 0.000500, 0.002862, 0.005488, 0.011693, 0.007725
#*# 	  -0.018353, -0.012846, -0.010613, -0.003972, -0.001298, 0.000089, 0.001800, -0.002019, 0.004660, -0.003843, 0.029200, 0.018006, -0.014313, -0.022398, -0.022809, -0.025374, -0.024453, -0.019747, -0.013363, -0.011852, -0.010184, -0.007937, -0.004560, -0.001801, 0.000461, 0.002596, 0.004977, 0.008929, 0.012847, 0.009362
#*# 	  -0.015502, -0.012204, -0.006636, -0.002589, 0.001254, 0.004267, 0.004001, 0.000170, 0.008598, 0.022548, 0.037548, 0.020516, -0.004191, -0.017521, -0.022624, -0.024153, -0.022477, -0.016754, -0.010300, -0.008037, -0.008080, -0.004389, -0.002989, 0.000150, 0.000637, 0.002294, 0.004650, 0.008968, 0.014655, 0.009435
#*# 	  -0.021132, -0.018107, -0.009313, -0.003792, -0.000841, 0.000465, 0.003380, 0.002286, -0.004542, 0.011618, 0.033378, 0.015238, -0.001014, -0.013039, -0.020968, -0.024811, -0.022722, -0.016517, -0.008207, -0.005120, -0.003973, -0.003877, -0.003507, -0.001348, 0.000315, 0.000245, 0.003392, 0.007339, 0.012606, 0.008749
#*# 	  -0.021744, -0.022683, -0.019817, -0.014452, -0.008337, -0.004427, 0.001119, 0.010033, 0.000817, 0.013456, 0.035116, 0.022389, 0.008127, -0.004017, -0.016250, -0.020321, -0.018475, -0.012329, -0.008038, -0.003947, -0.003329, -0.000294, -0.000362, 0.000222, 0.000454, 0.000366, 0.000812, 0.005202, 0.011675, 0.008865
#*# 	  -0.013288, -0.010352, -0.007665, -0.008507, -0.007692, -0.007137, -0.006037, -0.003731, 0.005235, 0.023704, 0.037819, 0.035445, 0.012881, 0.007471, -0.002920, -0.012360, -0.010721, -0.004114, -0.003751, -0.000346, 0.000632, 0.003465, 0.004384, 0.004436, 0.004365, 0.003501, 0.003990, 0.006476, 0.012855, 0.012189
#*# 	  -0.008541, -0.007897, -0.000014, 0.003468, 0.004860, 0.007914, 0.008640, 0.008658, 0.005440, 0.029018, 0.036449, 0.037844, 0.010977, 0.010370, 0.007508, 0.002029, 0.009864, -0.003961, 0.000009, 0.002511, 0.004380, 0.005681, 0.005960, 0.006159, 0.006374, 0.004386, 0.004381, 0.006599, 0.012585, 0.011251
#*# 	  -0.008674, -0.007227, -0.001350, 0.004428, 0.010925, 0.016249, 0.016860, 0.013236, 0.019449, 0.030039, 0.036495, 0.029356, 0.016198, 0.008624, 0.008053, 0.007990, 0.004782, 0.004405, 0.000928, 0.002279, 0.002874, 0.004577, 0.005099, 0.004386, 0.004386, 0.000980, 0.001430, 0.004425, 0.008756, 0.006373
#*# 	  -0.011653, -0.008778, -0.003956, 0.005162, 0.008621, 0.013849, 0.018847, 0.017201, 0.025394, 0.036349, 0.041593, 0.042227, 0.033207, 0.014560, 0.011617, 0.008927, 0.004922, 0.003409, 0.002453, 0.001743, 0.003573, 0.004197, 0.003745, 0.003474, 0.002293, 0.000167, -0.000700, 0.001209, 0.006990, 0.006489
#*# 	  -0.012810, -0.012099, -0.005026, 0.000704, 0.008691, 0.017405, 0.019216, 0.018567, 0.031482, 0.033563, 0.045821, 0.039676, 0.005723, 0.037640, -0.000052, 0.014946, 0.027344, 0.010575, 0.001258, 0.004042, 0.004425, 0.002332, 0.002003, 0.000879, 0.002257, -0.001843, -0.000728, 0.000307, 0.006347, 0.005776
#*# 	  -0.006800, -0.004990, -0.005774, -0.003989, 0.003862, 0.010004, 0.016157, 0.027330, 0.029302, 0.031238, 0.058515, 0.033016, 0.035349, 0.038090, 0.018219, 0.028088, 0.027242, 0.029311, 0.011085, 0.004455, 0.008459, 0.004621, 0.003608, 0.004173, 0.004375, 0.002345, 0.000704, 0.004327, 0.008560, 0.008255
#*# 	  -0.007635, -0.007730, -0.004245, -0.001559, 0.004146, 0.008508, 0.016842, 0.033835, 0.009093, 0.041866, 0.051807, 0.023425, 0.037617, 0.036447, 0.028526, 0.037488, 0.019083, 0.004501, 0.029065, 0.011313, 0.007514, 0.007377, 0.007553, 0.007292, 0.005376, 0.004527, 0.003949, 0.004911, 0.011582, 0.008704
#*# 	  -0.004985, -0.003833, -0.001580, 0.001889, 0.006450, 0.014376, 0.027229, 0.016160, 0.034201, 0.055788, 0.051118, 0.034477, 0.041301, 0.027385, 0.027929, 0.033051, 0.042021, 0.038136, 0.029812, 0.014786, 0.012686, 0.013082, 0.014727, 0.012767, 0.013559, 0.012005, 0.009278, 0.011554, 0.015870, 0.011989
#*# 	  -0.002320, -0.001668, 0.001200, 0.004365, 0.008559, 0.026490, 0.039601, 0.037649, 0.050060, 0.041117, 0.026457, 0.033022, 0.028453, 0.020780, 0.027401, 0.029397, 0.041417, 0.048838, 0.030457, 0.020509, 0.017012, 0.018937, 0.019504, 0.016878, 0.015962, 0.014414, 0.014155, 0.014457, 0.018551, 0.012814
#*# 	  -0.001760, -0.002168, 0.002312, 0.006097, 0.010731, 0.017724, 0.032521, 0.043630, 0.033287, 0.023346, 0.025238, 0.026206, 0.027943, 0.031729, 0.029826, 0.016006, 0.035563, 0.042505, 0.023099, 0.021397, 0.021296, 0.020934, 0.021129, 0.017373, 0.016568, 0.013942, 0.012668, 0.014708, 0.016860, 0.011118
#*# 	  -0.004357, -0.000864, 0.003506, 0.009077, 0.013026, 0.016613, 0.021005, 0.021341, 0.023168, 0.024123, 0.028928, 0.033404, 0.029174, 0.024428, 0.023100, 0.021872, 0.039823, 0.039539, 0.025416, 0.025343, 0.022943, 0.023096, 0.021631, 0.019437, 0.016631, 0.012686, 0.011996, 0.013076, 0.016813, 0.011820
#*# 	  0.002044, 0.004216, 0.011273, 0.014795, 0.016890, 0.023496, 0.027718, 0.030079, 0.030920, 0.030114, 0.038514, 0.039737, 0.036549, 0.035149, 0.032279, 0.036938, 0.045783, 0.037520, 0.032447, 0.032392, 0.029273, 0.028905, 0.026106, 0.023099, 0.020643, 0.016132, 0.014926, 0.016788, 0.020476, 0.014732
#*# 	  0.008604, 0.015963, 0.016828, 0.022336, 0.027515, 0.033150, 0.037477, 0.040659, 0.043060, 0.045295, 0.049874, 0.051822, 0.049628, 0.046544, 0.042014, 0.049518, 0.051935, 0.045585, 0.040785, 0.041637, 0.039768, 0.038711, 0.034451, 0.031376, 0.026773, 0.022564, 0.021595, 0.024200, 0.026863, 0.022500
#*# 	  0.018543, 0.022633, 0.025762, 0.033016, 0.033568, 0.037497, 0.045990, 0.048698, 0.050064, 0.051339, 0.055953, 0.061914, 0.057571, 0.052985, 0.052824, 0.059807, 0.055216, 0.047822, 0.045770, 0.049959, 0.045513, 0.042191, 0.041950, 0.036819, 0.033439, 0.029651, 0.028903, 0.030326, 0.033423, 0.028524
#*# 	  0.030078, 0.033702, 0.035941, 0.037543, 0.043851, 0.049693, 0.055792, 0.059962, 0.059224, 0.063147, 0.064102, 0.062289, 0.066091, 0.063925, 0.063151, 0.068244, 0.057784, 0.054976, 0.053792, 0.053876, 0.053504, 0.050350, 0.049861, 0.044744, 0.041161, 0.036017, 0.035624, 0.037532, 0.040916, 0.035568
#*# 	  0.033426, 0.033709, 0.041729, 0.046644, 0.053552, 0.056009, 0.058082, 0.063882, 0.063834, 0.064354, 0.064297, 0.068429, 0.070339, 0.068055, 0.068292, 0.065983, 0.057900, 0.055997, 0.053613, 0.053507, 0.051680, 0.049943, 0.045766, 0.043498, 0.039720, 0.037531, 0.036485, 0.037462, 0.039882, 0.037010
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 280.0
#*# min_y = 30.0
#*# max_y = 280.0
